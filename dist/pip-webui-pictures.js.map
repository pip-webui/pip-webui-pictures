{"version":3,"sources":["pictures.js","pip-webui-pictures-html.js","add_image/add_image.js","avatar_edit/avatar_edit.js","avatar/avatar.js","camera_dialog/camera_dialog.js","collage/collage.js","gallery_search_dialog/gallery_search_dialog.js","picture/picture.js","picture_edit/picture_edit.js","picture_list_edit/picture_list_edit.js","picture_url_dialog/picture_url_dialog.js","utilities/picture_paste.js","utilities/picture_utils.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpLA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC7IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzTA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3aA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"pip-webui-pictures.js","sourcesContent":["/**\n * @file Registration of pictures WebUI controls\n * @copyright Digital Living Software Corp. 2014-2015\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    angular.module('pipPictures', [        \n        'pipAddImage',\n        'pipAvatar',\n        'pipAvatarEdit',\n        'pipPicture',\n        'pipPictureEdit',\n        'pipCollage',\n        'pipPictureListEdit',        \n        'pipCameraDialog',        \n        'pipPictureUrlDialog'\n    ]);\n    \n})();\n\n\n","(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('add_image/add_image.html',\n    ' <!--\\n' +\n    '@file Add image directive content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2015\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-menu>\\n' +\n    '        <ng-transclude class=\"pip-add-image-open-button\" ng-click=\"ngDisabled() ? \\'\\' : $mdOpenMenu()\"></ng-transclude>\\n' +\n    '        <md-menu-content width=\"4\">\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" accept=\"image/*\"\\n' +\n    '                           ng-keydown=\"onKeyDown($event)\" ng-multiple=\"isMulti()\"\\n' +\n    '                           ng-file-select ng-file-change=\"onFileChange($files)\" ng-click=\"hideMenu()\" ng-file-drop>\\n' +\n    '\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:folder\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-folder text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'FILE\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onWebLinkClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:weblink\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-weblink text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'WEB_LINK\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onCameraClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:camera\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-camera text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'CAMERA\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onGalleryClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:images\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-images text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'IMAGE_GALLERY\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '        </md-menu-content>\\n' +\n    '    </md-menu>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('camera_dialog/camera_dialog.html',\n    '<!--\\n' +\n    '@file Camera dialog content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2015\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-dialog class=\"pip-dialog pip-picture-dialog pip-camera-dialog layout-column\" md-theme=\"{{theme}}\"\\n' +\n    '           ng-show=\"browser != \\'android\\'\"\\n' +\n    '        ng-class=\"{\\'pip-android-dialog\\': browser == \\'android\\' || !browser}\">\\n' +\n    '    <div class=\"pip-header\" class=\"layout-row layout-align-start-center\">\\n' +\n    '        <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button\"\\n' +\n    '                    aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '            <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '        </md-button>\\n' +\n    '        <h3 class=\"m0 text-title\">{{ ::\\'TAKE_PICTURE\\' | translate }}</h3>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '    <div class=\"pip-body\">\\n' +\n    '        <div class=\"camera-stream\" ng-hide=\"webCamError || browser == \\'android\\'\"></div>\\n' +\n    '        <div class=\"camera-error\"\\n' +\n    '             ng-show=\"webCamError || browser == \\'android\\'\"\\n' +\n    '             class=\"layout-row layout-align-center-center\">\\n' +\n    '            <span>{{ ::\\'WEB_CAM_ERROR\\' | translate }}</span>\\n' +\n    '        </div>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button ng-click=\"onResetPicture()\"\\n' +\n    '                       ng-hide=\"!$freeze || webCamError\"\\n' +\n    '                       class=\"md-icon-button\"\\n' +\n    '                       ng-disabled=\"transaction.busy()\"\\n' +\n    '                       aria-label=\"{{ ::\\'REMOVE_PICTURE\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:refresh\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '        </div>\\n' +\n    '        <div class=\"flex\"></div>\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button ng-click=\"onTakePictureClick()\"\\n' +\n    '                       ng-hide=\"webCamError\"\\n' +\n    '                       class=\"md-icon-button\"\\n' +\n    '                       aria-label=\"{{ ::\\'TAKE_PICTURE\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey icon-button\" md-svg-icon=\"icons:{{$freeze ? \\'check\\' : \\'camera\\'}}\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '\\n' +\n    '        </div>\\n' +\n    '        <div class=\"flex\"></div>\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button\"\\n' +\n    '                        aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '        </div>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '</md-dialog>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('gallery_search_dialog/gallery_search_dialog.html',\n    '<md-dialog class=\"pip-dialog pip-gallery-search-dialog pip-picture-dialog layout-column\"\\n' +\n    '           md-theme=\"{{theme}}\">\\n' +\n    '    <md-progress-linear\\n' +\n    '            ng-show=\"transaction.busy()\" md-mode=\"indeterminate\">\\n' +\n    '    </md-progress-linear>\\n' +\n    '\\n' +\n    '    <md-dialog-content class=\"pip-body lp0 rp0 tp0 pip-scroll flex layout-row\">\\n' +\n    '        <div class=\"layout-column layout-align-start-start flex\">\\n' +\n    '            <div class=\"pip-header w-stretch layout-column layout-align-start-start\">\\n' +\n    '                <h3 class=\"w-stretch text-title m0 bp8\">\\n' +\n    '                    <md-button  class=\"md-icon-button m0\"\\n' +\n    '                                ng-click=\"onCancelClick()\"\\n' +\n    '                                aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                        <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '                    </md-button>\\n' +\n    '                    {{::\\'IMAGE_GALLERY\\' | translate}}\\n' +\n    '                </h3>\\n' +\n    '                <div class=\"w-stretch divider-bottom layout-row layout-start-center\">\\n' +\n    '                    <input class=\"no-divider rm8 text-subhead1 flex\"\\n' +\n    '                           ng-disabled=\"transaction.busy()\"\\n' +\n    '                           ng-model=\"$search\" ng-keypress=\"onKeyPress($event)\"\\n' +\n    '                           placeholder=\"{{::\\'SEARCH_PICTURES\\' | translate}}\"\\n' +\n    '                           type=\"text\" tabindex=\"1\">\\n' +\n    '\\n' +\n    '                    <md-button class=\"md-icon-button md-icon-button-square p0 pip-search-button md-primary\"\\n' +\n    '                               ng-click=\"onSearchClick()\"\\n' +\n    '                               ng-hide=\"optionDefault\"\\n' +\n    '                               tabindex=\"-1\" aria-label=\"SEARCH\">\\n' +\n    '                        <md-icon class=\"text-opacity md-primary\" md-svg-icon=\"icons:search-square \"></md-icon>\\n' +\n    '                    </md-button>\\n' +\n    '                </div>\\n' +\n    '            </div>\\n' +\n    '            <div class=\"pip-content flex\"\\n' +\n    '                 ng-show=\"$images.length > 0\">\\n' +\n    '                <div class=\"pip-image-container\"\\n' +\n    '                     ng-click=\"onImageClick(image)\"\\n' +\n    '                     ng-repeat=\"image in $images track by $index\"\\n' +\n    '                     ng-class=\"{\\'checked\\': image.checked}\"\\n' +\n    '                     tabindex=\"{{ $index + 2 }}\">\\n' +\n    '\\n' +\n    '                    <pip-picture pip-src=\"image.thumbnail\"\\n' +\n    '                                 pip-default-icon=\"icon-images\"\\n' +\n    '                                 pip-rebind=\"true\">\\n' +\n    '                    </pip-picture>\\n' +\n    '                    <div class=\"pip-checked-cover\"></div>\\n' +\n    '                    <div class=\"pip-checkbox-backdrop\">\\n' +\n    '                        <md-checkbox md-no-ink\\n' +\n    '                                     ng-model=\"image.checked\"\\n' +\n    '                                     ng-click=\"image.checked = !image.checked\"\\n' +\n    '                                     aria-label=\"CHECKED\">\\n' +\n    '                        </md-checkbox>\\n' +\n    '                    </div>\\n' +\n    '                </div>\\n' +\n    '            </div>\\n' +\n    '            <div class=\"pip-no-images w-stretch layout-column layout-align-center-center flex\"\\n' +\n    '                 ng-show=\"$images.length == 0\">\\n' +\n    '                <img src=\"images/add_from_image_library.svg\" width=\"200\" height=\"200\">\\n' +\n    '                <p class=\"text-secondary opacity-secondary text-center\">{{\\'IMAGE_START_SEARCH\\' | translate}}</p>\\n' +\n    '                <!--<md-icon class=\"text-grey\" md-svg-icon=\"icons:images\"></md-icon> -->\\n' +\n    '            </div>\\n' +\n    '        </div>\\n' +\n    '    </md-dialog-content>\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <md-button  ng-click=\"onCancelClick()\"\\n' +\n    '                    ng-hide=\"transaction.busy()\"\\n' +\n    '                    aria-label=\"{{ ::\\'CANCEL\\' | translate }}\"\\n' +\n    '                    tabindex=\"{{ $images.length + 3 }}\">\\n' +\n    '                <span class=\"text-grey\">\\n' +\n    '                    {{ ::\\'CANCEL\\' | translate }}\\n' +\n    '                </span>\\n' +\n    '        </md-button>\\n' +\n    '        <md-button ng-if=\"transaction.busy()\" ng-click=\"onStopSearchClick()\" class=\"md-raised md-warn m0\"\\n' +\n    '                   tabindex=\"5\" aria-label=\"ABORT\"\\n' +\n    '                   pip-test=\"button-cancel\">\\n' +\n    '            {{::\\'CANCEL\\' | translate}}\\n' +\n    '        </md-button>\\n' +\n    '        <md-button  class=\"md-accent\"\\n' +\n    '                    ng-hide=\"transaction.busy()\"\\n' +\n    '                    ng-disabled=\"addButtonDisabled()\"\\n' +\n    '                    ng-click=\"onAddClick()\"\\n' +\n    '                    aria-label=\"{{ ::\\'ADD\\' | translate }}\"\\n' +\n    '                    tabindex=\"{{ $images.length + 4 }}\">\\n' +\n    '\\n' +\n    '            {{ ::\\'ADD\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '    </div>\\n' +\n    '</md-dialog>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_edit/picture_edit.html',\n    '<div class=\"pip-picture-upload pip-picture-drop md-focused\"\\n' +\n    '\t ng-keydown=\"onKeyDown($event)\"\\n' +\n    ' \t tabindex=\"{{ ngDisabled() || control.uploading ? -1 : 0 }}\"\\n' +\n    '\t pip-changed=\"readItemLocally(url, file)\"\\n' +\n    '\t ng-disabled=\"ngDisabled()\"\\n' +\n    '\t pip-multi=\"false\"\\n' +\n    '\t ng-focus=\"onFocus()\"\\n' +\n    '\t ng-blur=\"onBlur()\"\\n' +\n    '\t pip-add-image>\\n' +\n    '\\n' +\n    '\t<div class=\"pip-default-icon\" ng-show=\"empty()\">\\n' +\n    '\t\t<md-icon  class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t</div>\\n' +\n    '\t<div class=\"pip-default-text\" ng-show=\"empty()\">\\n' +\n    '\t\t<span>{{text | translate}}</span>\\n' +\n    '\t</div>\\n' +\n    '\\n' +\n    '\t<img class=\"pip-picture-image\"\\n' +\n    '\t\t ng-src=\"{{control.url}}\"\\n' +\n    '\t\t ng-show=\"!empty()\"\\n' +\n    '\t\t ng-class=\"{ \\'pip-image-new\\': isUpdated(), \\'cursor-default\\' : ngDisabled() || control.uploading }\"\\n' +\n    ' \t\t ui-event=\"{ error: \\'onImageError($event)\\', load: \\'onImageLoad($event)\\' }\">\\n' +\n    '\\n' +\n    '\t<md-button class=\"md-icon-button\"\\n' +\n    '\t\t\t   ng-click=\"onDeleteClick($event)\"\\n' +\n    '\t\t\t   tabindex=\"-1\" aria-label=\"delete\"\\n' +\n    '\t\t\t   ng-hide=\"empty() || ngDisabled()\"\\n' +\n    '\t\t\t   ng-disabled=\"ngDisabled() || control.uploading\">\\n' +\n    '\t\t<md-icon  md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '\t</md-button>\\n' +\n    '\\n' +\n    '\t<md-progress-linear ng-show=\"control.uploading\"\\n' +\n    '\t\t\t\t\t\tng-value=\"control.progress\">\\n' +\n    '\t</md-progress-linear>\\n' +\n    '</div>\\n' +\n    '');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_list_edit/picture_list_edit.html',\n    '<div pip-focused>\\n' +\n    '\t<div class=\"pip-picture-upload pointer pip-focusable\"\\n' +\n    '\t\t ng-class=\"{\\'pip-picture-error\\': item.error}\"\\n' +\n    '\t\t ng-keydown=\"onKeyDown($event, item)\"\\n' +\n    '\t\t tabindex=\"{{ ngDisabled() ? -1 : 0 }}\"\\n' +\n    '\t\t ng-repeat=\"item in control.items | filter: filterItem\">\\n' +\n    '\\n' +\n    '\t\t<div class=\"pip-default-icon\" ng-hide=\"item.loaded || item.error\">\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<div class=\"pip-default-text\" ng-show=\"item.error\">\\n' +\n    '\t\t\t<!--span style=\"color: red\">{{ \\'ERROR_IMAGE_PRELOADING\\' | translate}}</span-->\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" md-svg-icon=\"icons:warn-circle\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<img ng-src=\"{{::item.url}}\"\\n' +\n    '\t\t\t pip-cancel-drag=\"true\"\\n' +\n    '\t\t\t ng-hide=\"item.error\"\\n' +\n    '\t\t\t ng-class=\"{ \\'pip-image-new\\': item.state == \\'added\\' }\"\\n' +\n    '\t\t\t ui-event=\"{ error: \\'onImageError($event, item)\\', load: \\'onImageLoad($event, item)\\' }\">\\n' +\n    '\\n' +\n    '\t\t<md-button ng-click=\"onDeleteClick(item)\"\\n' +\n    '\t\t\t\t   ng-disabled=\"ngDisabled() || control.uploading\" tabindex=\"-1\"\\n' +\n    '\t\t\t\t   aria-label=\"delete\"\\n' +\n    '\t\t\t\t   class=\"md-icon-button\">\\n' +\n    '\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '\t\t</md-button>\\n' +\n    '\t\t<md-progress-linear md-mode=\"indeterminate\" ng-show=\"item.uploading\" value=\"{{ item.progress }}\">\\n' +\n    '\t\t</md-progress-linear>\\n' +\n    '\t</div>\\n' +\n    '\\n' +\n    '\t<button class=\"pip-picture-upload pip-picture-drop pip-focusable\"\\n' +\n    '\t\t\tpip-add-image\\n' +\n    '\t\t    ng-focus=\"onFocus()\"\\n' +\n    '\t        ng-blur=\"onBlur()\"\\n' +\n    '\t\t\tpip-changed=\"readItemLocally(url, file)\"\\n' +\n    '\t\t\tng-disabled=\"ngDisabled() || control.uploading\">\\n' +\n    '\\n' +\n    '\t\t<div class=\"pip-default-icon\">\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<div class=\"pip-default-text\">\\n' +\n    '\t\t\t<span>{{text | translate}}</span>\\n' +\n    '\t\t</div>\\n' +\n    '\t</button>\\n' +\n    '\t<div class=\"clearfix\"></div>\\n' +\n    '</div>\\n' +\n    '');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_url_dialog/picture_url_dialog.html',\n    '<!--\\n' +\n    '@file Picture URL dialog content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2016\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-dialog class=\"pip-dialog pip-picture-url-dialog pip-picture-dialog layout-column\"\\n' +\n    '           md-theme=\"{{theme}}\">\\n' +\n    '\\n' +\n    '    <md-dialog-content class=\"pip-body lp0 rp0 tp0 pip-scroll\">\\n' +\n    '        <div class=\"pip-header bm16 layout-row layout-align-start-center\">\\n' +\n    '            <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button lm0\"\\n' +\n    '                        aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '            <h3 class=\"text-title m0\">\\n' +\n    '                {{ ::\\'PICTURE_FROM_WEBLINK\\' | translate}}\\n' +\n    '            </h3>\\n' +\n    '        </div>\\n' +\n    '\\n' +\n    '        <div class=\"pip-content\">\\n' +\n    '            <md-input-container md-no-float class=\"w-stretch text-subhead1\">\\n' +\n    '                <input type=\"text\" ng-model=\"url\" ng-change=\"checkUrl()\" placeholder=\"{{:: \\'LINK_PICTURE\\' | translate}}\"/>\\n' +\n    '            </md-input-container>\\n' +\n    '\\n' +\n    '            <div class=\"w-stretch layout-row layout-align-center-center\"\\n' +\n    '                 ng-hide=\"invalid\">\\n' +\n    '                <img id=\"url_image\"/>\\n' +\n    '            </div>\\n' +\n    '\\n' +\n    '            <div class=\"pip-no-images layout-row layout-align-center-center\" ng-show=\"invalid\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:images\"></md-icon>\\n' +\n    '            </div>\\n' +\n    '\\n' +\n    '        </div>\\n' +\n    '    </md-dialog-content>\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <md-button ng-click=\"onCancelClick()\" aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '            {{ ::\\'CANCEL\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '\\n' +\n    '        <md-button class=\"md-accent\" ng-click=\"onAddClick()\" ng-disabled=\"invalid\"\\n' +\n    '                   aria-label=\"{{ ::\\'ADD\\' | translate }}\">\\n' +\n    '            {{ ::\\'ADD\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '    </div>\\n' +\n    '</md-dialog>');\n}]);\n})();\n","/**\n * @file Add image control\n * @copyright Digital Living Software Corp. 2014-2015\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipAddImage\", ['pipCameraDialog', 'pipPictureUrlDialog', 'pipGallerySearchDialog', 'pipCore']);\n\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'FILE' : 'Upload pictures',\n            'WEB_LINK' : 'Use web link',\n            'CAMERA' : 'Take photo',\n            'IMAGE_GALLERY': 'Use image library',\n        });\n        pipTranslateProvider.translations('ru', {\n            'FILE' : 'Загрузить картинку',\n            'WEB_LINK' : 'Вставить веб ссылка',\n            'CAMERA' : 'Использовать камеру',\n            'IMAGE_GALLERY': 'Открыть галерею изображений'\n        });\n    }]);\n\n    thisModule.directive('pipAddImage', \n        function() {\n            return {\n                restrict: 'AC',\n                scope: {\n                    $images: '=pipImages',\n                    onChange: '&pipChanged',\n                    multi: '&pipMulti',\n                    ngDisabled: '&'\n                },\n                transclude: true,\n                templateUrl: 'add_image/add_image.html',\n                controller: 'pipAddImageController'\n            }\n        }\n    );\n\n    thisModule.controller('pipAddImageController',\n        ['$scope', '$element', '$mdMenu', '$timeout', 'pipCameraDialog', 'pipPictureUrlDialog', 'pipGallerySearchDialog', 'pipUtils', function ($scope, $element, $mdMenu, $timeout, pipCameraDialog, pipPictureUrlDialog, pipGallerySearchDialog, pipUtils) {\n\n            $scope.hideMenu = hideMenu;\n            $scope.onFileChange = onFileChange;\n            $scope.onWebLinkClick = onWebLinkClick;\n            $scope.onCameraClick = onCameraClick;\n            $scope.onGalleryClick = onGalleryClick;\n            $scope.isMulti = isMulti;\n\n            $element.click(function () {\n                if (!$scope.ngDisabled()) openMenu();\n            });\n\n            return;\n\n            function openMenu() {\n                $($element).find('.pip-add-image-open-button').scope().$mdOpenMenu();\n            }\n\n            function isMulti() {\n                if ($scope.multi() !== undefined)\n                    return  pipUtils.toBoolean($scope.multi());\n                else return true;\n            }\n\n            function hideMenu () {\n                $mdMenu.hide();\n            }\n\n            function dataURItoBlob(dataURI) {\n                var byteString;\n                \n                if (dataURI.split(',')[0].indexOf('base64') >= 0)\n                    byteString = atob(dataURI.split(',')[1]);\n                else\n                    byteString = unescape(dataURI.split(',')[1]);\n\n                var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\n\n                var ia = new Uint8Array(byteString.length);\n                for (var i = 0; i < byteString.length; i++) {\n                    ia[i] = byteString.charCodeAt(i);\n                }\n\n                return new Blob([ia], {type:mimeString});\n            }\n\n            function addImages(images) {\n\n                if (images === undefined) return;\n\n                if (Array.isArray(images)) {\n                    images.forEach(function (img) {\n                        if ($scope.onChange)\n                            $scope.onChange({url: img.url, file: img.file});\n                    });\n                } else {\n                    if ($scope.onChange)\n                        $scope.onChange({url: images.url, file: images.file});\n                }\n\n                if ($scope.$images === undefined || !Array.isArray($scope.$images))\n                    return;\n\n                if (Array.isArray(images)) {\n                    images.forEach(function (img) {\n                        $scope.$images.push(img.url);\n                    });\n                } else {\n                    $scope.$images.push(images.url);\n                }\n            }\n\n            // Process user actions\n\n            function onFileChange ($files) {\n                if ($files == null || $files.length == 0)\n                    return;\n\n                $files.forEach(function (file) {\n                    if (file.type.indexOf('image') > -1) {\n                        $timeout(function() {\n                            var fileReader = new FileReader();\n                            fileReader.readAsDataURL(file);\n                            fileReader.onload = function(e) {\n                                $timeout(function() {\n                                    addImages({url: e.target.result, file: file});\n                                });\n                            }\n                        });\n                    }\n                });\n\n            }\n\n            function onWebLinkClick () {\n                pipPictureUrlDialog.show(function (result) {\n                    var blob = null;\n                    if (result.substring(0, 10) == 'data:image') {\n                        blob = dataURItoBlob(result);\n                        blob.name = result.slice(result.lastIndexOf('/') + 1, result.length).split('?')[0];\n                    }\n                    addImages({url: result, file: blob});\n                });\n            }\n\n            function onCameraClick () {\n                pipCameraDialog.show(function (result) {\n                  var blob = dataURItoBlob(result);\n\n                    blob.name = 'camera';\n                    addImages({url: result, file: blob});\n                });\n            }\n\n            function onGalleryClick () {\n                pipGallerySearchDialog.show(function (result) {\n                    var imgs = [];\n                    result.forEach(function (url) {\n                        imgs.push({url: url, file: null});\n                    });\n                    addImages(imgs);\n                }, $scope.isMulti());\n            }\n    }]);\n\n})();\n\n\n","/**\n * @file Avatar control\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Improve samples in sampler app\n * - Replace placeholder with default image generated on server\n * - Generate file url based on entity type, do not set it as full url via pipSrc\n */\n \n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipAvatarEdit\", ['ui.event', 'angularFileUpload', 'pipPicturePaste', 'pipData',\n        'pipImageUtils', 'pipPictures.Templates']);\n\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'PICTURE_EDIT_TEXT': 'Click here to upload a picture'\n        });\n        pipTranslateProvider.translations('ru', {\n            'PICTURE_EDIT_TEXT': 'Нажмите сюда для загрузки картинки'\n        });\n    }]);\n\n    thisModule.directive('pipAvatarEdit',\n        function() {\n            return {\n                restrict: 'EA',\n                scope: {\n                    ngDisabled: '&',\n                    pipPartyId: '&',\n                    pipEntityType: '&',\n                    pipId: '&',\n                    pipCreated: '&',\n                    pipChanged: '&',\n                    pipReset: '&'\n                },\n                templateUrl: 'picture_edit/picture_edit.html',\n                controller: 'pipAvatarEditController' \n            };\n        }\n    );\n\n    thisModule.controller('pipAvatarEditController',\n        ['$scope', '$element', '$attrs', '$http', '$upload', '$rootScope', 'pipPicturePaste', 'pipDataAvatar', 'pipImageUtils', function($scope, $element, $attrs, $http, $upload, $rootScope, pipPicturePaste, pipDataAvatar, pipImageUtils) {\n            var \n                $control = $element.children('.pip-picture-upload'),\n                $input = $control.children('input[type=file]'),\n                entityTypes = pipDataAvatar.getEntityTypes();\n                // serverUrl = pipRest.serverUrl();\n            \n            $scope.text = $attrs.pipDefaultText || 'PICTURE_EDIT_TEXT'; \n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\n            $scope.control = {\n                url: '',\n                progress: 0,\n                uploaded: false,\n                uploading: false,\n                loaded: false,\n\n                file: null,\n                state: 'original'\n            };\n\n            $scope.control.reset = reset;\n            $scope.control.save = save;\n            $scope.empty = empty;\n            $scope.isUpdated = isUpdated;\n            $scope.readItemLocally = readItemLocally;\n            $scope.onDeleteClick = onDeleteClick;\n            $scope.onKeyDown = onKeyDown;\n            $scope.onImageError = onImageError;\n            $scope.onImageLoad = onImageLoad;\n            $scope.onChange = onChange;\n\n            // Watching for changes\n            $scope.$watch($scope.pipId, function(newValue) {\n                if ($scope.pipReset() !== false)\n                    $scope.control.reset();\n            });\n\n            $scope.$watch($scope.pipPartyId, function(newValue) {\n                if ($scope.pipReset() !== false)\n                    $scope.control.reset();\n            });\n\n            $scope.$watch($scope.ngDisabled, function(newValue) {\n                $input.attr('disabled', $scope.control.disabled);\n            });\n\n            // Add paste listener\n            $element.children('.pip-picture-upload').focus(function () {\n                pipPicturePaste.addPasteListener(function (item) {\n                    $scope.readItemLocally(item.url, item.file);\n                });\n            });\n\n            $element.children('.pip-picture-upload').blur(function () {\n                pipPicturePaste.removePasteListener();\n            });\n\n            // Add class\n            $element.addClass('pip-picture-edit');\n\n            // Execute callback\n            if ($scope.pipCreated) {\n                $scope.pipCreated({\n                    $event: { sender: $scope.control },\n                    $control: $scope.control\n                });\n            }\n\n            // Initialize control\n            $scope.control.reset();\n\n            return;\n\n            // --------------------------------\n\n            // Utility functions\n\n            function reset(afterDeleting) {\n                $scope.control.progress = 0;\n                $scope.control.uploading = false;\n                $scope.control.uploaded = false;\n\n                $scope.control.file = null;\n                $scope.control.state = 'original';\n                $scope.control.url = '';\n\n                if (!afterDeleting) {\n                    var url = pipDataAvatar.getAvatarUrl({\n                        partyId: $scope.pipPartyId(), \n                        partyName: '',\n                        id: $scope.pipId(), \n                        type: $scope.pipEntityType(), \n                        noRedirect: false, \n                        noDefault: true\n                    });\n\n                    if (!url) return;\n\n                    //pipImageUtils.addHttpHeaders();\n                    $scope.control.progress = 0;\n\n                    $scope.control.url = url;\n                    $scope.control.uploaded = $scope.control.url != '';\n                    $scope.onChange();\n\n                } else $scope.onChange();\n            };\n\n            function getParams() {\n                return {\n                        entityType:  $scope.pipEntityType(),\n                        id: $scope.pipId(),\n                        partyId: $scope.pipPartyId()\n                    };\n            }\n\n            function saveItemUrl() {\n                var url = $scope.control.url,\n                    name = url.slice(url.lastIndexOf('/') + 1, url.length).split('?')[0],\n                    filter = name + '&url=' + url;\n\n                return pipDataAvatar.getAvatarPostUrl(getParams(), filter);  \n            };\n\n            function savePicture(successCallback, errorCallback) {\n                var\n                    control = $scope.control,\n                    file = control.file;\n\n                if ($scope.control.file !== null) {\n                    var \n                        fileReader = new FileReader();\n                        // FILE_URL = generateUrl();\n                        \n                    fileReader.onload = function (e) {\n                        control.uploading = true;\n\n                        var upload = pipDataAvatar.createAvatar({\n                                name: file.name,\n                                params: getParams(),\n                                type: file.type,\n                                data: e.target.result\n                            },\n                            function (response) {\n                                control.reset();\n                                if (successCallback) successCallback(response);\n                            },\n                            function (error) {\n                                control.uploading = false;\n                                control.upload = false;\n                                control.progress = 0;\n\n                                if (errorCallback) errorCallback(error);\n                                else console.error(error);\n                            },\n                            function (e) {\n                                control.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\n                            }\n                        );\n                    };\n\n                    fileReader.readAsArrayBuffer(file);\n                } else {\n                     control.uploading = true;\n\n                     pipDataAvatar.createAvatarByUrl(\n                         saveItemUrl(),\n                         function (response) {\n                             control.reset();\n \n                             if (successCallback) successCallback(response);\n                         },\n                         function (error) {\n                             control.uploading = false;\n                             control.upload = false;\n\n                             if (errorCallback) errorCallback(error);\n                             else console.error(error);\n                         }\n                     );\n                }\n            };\n\n            function deletePicture(successCallback, errorCallback) {\n                var control = $scope.control;\n\n                pipDataAvatar.deleteDocument(\n                    getParams(), \n                    function (data) {\n                        control.reset(true);\n\n                        if (successCallback) successCallback();\n                    },\n                    function (error) {\n                        control.uploading = false;\n                        control.upload = false;\n                        control.progress = 0;\n\n                        if (errorCallback) errorCallback(error);\n                        else console.error(error);\n                    }\n                );\n            };\n\n            function save(successCallback, errorCallback) {\n                // Process changes of the image\n                if ($scope.control.state == 'changed') {\n                    savePicture(successCallback, errorCallback);\n                } \n                // Process deletion of the image\n                else if ($scope.control.state == 'deleted') {\n                    deletePicture(successCallback, errorCallback);\n                }\n                // Process if no changes were made \n                else {\n                    if (successCallback) successCallback();                            \n                }\n            };\n\n\n            // Visual functions\n            function empty() {\n                return $scope.control.url == '' && !$scope.control.uploading;\n            };\n\n            function isUpdated() {\n                return $scope.control.state != 'original';\n            };\n\n            // Process user events\n\n            function readItemLocally(url, file) {\n                $scope.control.file = file;\n                $scope.control.url = url;\n                $scope.control.state = 'changed';\n                $scope.onChange();\n            };\n\n            function onDeleteClick($event) {\n                $event.stopPropagation();\n\n                $control.focus();\n\n                $scope.control.file = null;\n                $scope.control.url = '';\n                $scope.control.state = 'deleted';\n\n                $scope.onChange();\n            };\n\n            function onKeyDown($event) {\n                if ($event.keyCode == 13 || $event.keyCode == 32) {\n                    setTimeout(function() {\n                        $control.trigger('click');\n                    }, 0);\n                } else if ($event.keyCode == 46 || $event.keyCode == 8) {\n                    $scope.control.file = null;\n                    $scope.control.url = '';\n\n                    $scope.control.state = 'deleted';\n\n                    $scope.onChange();\n                } else if ($event.keyCode == 27) {\n                    $scope.control.reset();\n                }\n            };\n\n            // Clean up url to remove broken icon\n            function onImageError($event) {\n                $scope.$apply(function() {\n                    $scope.control.url = '';\n                    var image = $($event.target);\n\n                    pipImageUtils.setErrorImageCSS(image, {width: 'auto', height: '100%'});\n                });\n            };\n\n            // When image is loaded resize/reposition it\n            function onImageLoad($event) {\n                var image = $($event.target);\n                pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\n                $scope.control.uploading = false;\n            };\n\n            // On change event\n            function onChange() {\n                if ($scope.pipChanged) {\n                    $scope.pipChanged({\n                        $event: { sender: $scope.control },\n                        $control: $scope.control\n                    });\n                }\n            };\n        }]        \n    );\n    \n})();\n\n","/**\n * @file Avatar control\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Improve samples in sampler app\n * - Replace placeholder with default image generated on server\n * - Fix resizing problem\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipAvatar\", ['pipCore', 'pipData', 'pipImageUtils']);\n\n    thisModule.directive('pipAvatar',\n        function () {\n            return {\n                restrict: 'EA',\n                scope: false,\n                template: '<md-icon></md-icon><img/>'\n                + '<div><md-icon class=\"default_icon\" id=\"icon-film\" md-svg-icon=\"icons:film\"></md-icon>'\n                + '<md-icon class=\"default_icon\" id=\"icon-task\" md-svg-icon=\"icons:task\"></md-icon>'\n                + '<md-icon class=\"default_icon\" id=\"icon-folder\" md-svg-icon=\"icons:folder\"></md-icon></div>',\n                controller: 'pipAvatarController'\n            }\n        }\n    );\n\n    thisModule.controller('pipAvatarController',\n        ['$scope', '$rootScope', '$element', '$attrs', '$parse', 'pipUtils', 'pipDataAvatar', 'pipStrings', '$http', 'pipImageUtils', function ($scope, $rootScope, $element, $attrs, $parse, pipUtils, pipDataAvatar, pipStrings, $http, pipImageUtils) {\n            var\n                $svg = $element.children('md-icon'),\n                $image = $element.children('img'),\n                $defaultBlock = $element.children('div'),\n                $iconFilm = $element.find('#icon-film'),\n                $iconTask = $element.find('#icon-task'),\n                $iconFolder = $element.find('#icon-folder'),\n                image = null,\n\n                partyIdGetter = $parse($attrs.pipPartyId),\n                partyNameGetter = $parse($attrs.pipPartyName),\n                typeGetter = $parse($attrs.pipEntityType),\n                idGetter = $parse($attrs.pipId),\n                urlGetter = $parse($attrs.pipImageUrl),\n\n                colors = pipDataAvatar.getAvatarColors(),\n                colorClasses = pipDataAvatar.getColorClasses(),\n                entityTypes = pipDataAvatar.getEntityTypes();\n\n            // When image is loaded resize/reposition it\n            $image.load(function ($event) {\n                image = $($event.target);\n                pipImageUtils.setImageMarginCSS($element, image);\n            });\n\n            // Add class\n            $element.addClass('pip-avatar flex-fixed');\n\n            if ($attrs.ngClass) {\n                $scope.$watch($attrs.ngClass, function () {\n                    setTimeout(function () {\n                        pipImageUtils.setImageMarginCSS($element, image);\n                    }, 50);\n                });\n            }\n\n            // Optimization to avoid binding\n            bindControl();\n\n            if (pipUtils.toBoolean($attrs.pipRebindAvatar)) {\n                $rootScope.$on('pipPartyAvatarUpdated', refreshAvatar);\n            }\n\n            // Also optimization to avoid watch if it is unnecessary\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\n                $scope.$watch(partyIdGetter, function (newValue, oldValue) {\n                    if (oldValue !== newValue)\n                        bindControl();\n                });\n\n                $scope.$watch(idGetter, function (newValue, oldValue) {\n                    if (oldValue !== newValue)\n                        bindControl();\n                });\n\n                $scope.$watch(urlGetter, function (newValue, oldValue) {\n                    if (oldValue !== newValue)\n                        bindControl();\n                });\n            }\n\n            return;\n\n            function refreshAvatar() {\n                $iconTask.css('display', 'none');\n                $iconFilm.css('display', 'none');\n                $iconFolder.css('display', 'none');\n                $defaultBlock.css('display', 'none');\n                $image.attr('src', '');\n                $svg.css('display', 'none');\n                $image.css('display', 'inline-block');\n                bindControl();\n            };\n\n            function bindControl() {\n                var\n                    partyName = partyNameGetter($scope),\n                    partyId = partyIdGetter($scope),\n                    id = idGetter($scope),\n                    type = typeGetter($scope),\n                    transUrl = urlGetter($scope);\n\n                $iconTask.css('display', 'none');\n                $iconFilm.css('display', 'none');\n                $iconFolder.css('display', 'none');\n                $defaultBlock.css('display', 'none');\n\n                // Timestamp to avoid caching images for too long\n                var params = {\n                    partyId: partyId, \n                    partyName: partyName, \n                    id: id, \n                    type: type, \n                    noRedirect: false, \n                    noDefault: false\n                },\n                    url = transUrl || pipDataAvatar.getAvatarUrl(params);\n\n// todo abstract this code!!!\n                if ((type && id && partyId) || (partyId && partyName) || transUrl) {\n                    if (type && id && partyId) {\n                        if (type == 'category') return;\n\n                        if (entityTypes[type] == 'goals' || entityTypes[type] == 'areas' ) {\n                            $image.attr('src', url);\n                            $svg.css('display', 'none');\n                            $image.css('display', 'inline-block');\n                        } else {\n                            $defaultBlock.css('display', 'block');\n                            var colorClassIndex = pipStrings.hashCode(id) % colors.length;\n                            $element.addClass(colorClasses[colorClassIndex]);\n                            switch(type) {\n                                case 'vision':\n                                    $svg.css('display', 'none');\n                                    $iconFilm.css('display', 'inline-block');\n                                    $iconTask.css('display', 'none');\n                                    $iconFolder.css('display', 'none');\n                                    $image.css('display', 'none');\n                                    break;\n                                case 'event':\n                                    $svg.css('display', 'none');\n                                    $iconTask.css('display', 'inline-block');\n                                    $iconFilm.css('display', 'none');\n                                    $iconFolder.css('display', 'none');\n                                    $image.css('display', 'none');\n                                    break;\n                                case 'note':\n                                    $svg.css('display', 'none');\n                                    $iconFolder.css('display', 'inline-block');\n                                    $iconTask.css('display', 'none');\n                                    $iconFilm.css('display', 'none');\n                                    $image.css('display', 'none');\n                                    break;\n                            }\n                        }\n                    } else {\n                        $image.attr('src', url);\n                        $svg.css('display', 'none');\n                        $image.css('display', 'inline-block');\n                    }\n                }\n            };\n\n        }]\n    );\n\n})();\n\n","/**\n * @file Camera dialog\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Add sample to sampler app\n */\n\n/* global angular, Webcam */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipCameraDialog',\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates']);\n\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'TAKE_PICTURE': 'Take a picture',\n            'WEB_CAM_ERROR': 'Webcam is missing or was not found'\n        });\n        pipTranslateProvider.translations('ru', {\n            'TAKE_PICTURE': 'Сделать фото',\n            'WEB_CAM_ERROR': 'Web-камера отсутствует или не найдена'\n        });\n    }]);\n\n    thisModule.factory('pipCameraDialog',\n        ['$mdDialog', function ($mdDialog) {\n            return {\n                show: function (successCallback) {\n                    $mdDialog.show({\n                        templateUrl: 'camera_dialog/camera_dialog.html',\n                        clickOutsideToClose: true,\n                        controller: 'pipCameraController'\n                    }).then(function (result) {\n                        Webcam.reset();\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                    }, function () {\n                        Webcam.reset();\n                    });\n                }\n            };\n        }]);\n\n    thisModule.controller('pipCameraController',\n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', 'pipUtils', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, pipUtils) { // $cordovaCamera\n            $scope.browser = pipUtils.getBrowser().os;\n            $scope.theme = $rootScope.$theme;\n\n            if ($scope.browser !== 'android') {\n                Webcam.init();\n\n                setTimeout(function () {\n                    Webcam.attach('.camera-stream');\n                }, 0);\n\n                Webcam.on('error', function (err) {\n                    $scope.webCamError = true;\n                    console.error(err);\n                });\n\n                Webcam.set({\n                    width: 400,\n                    height: 300,\n\n                    dest_width: 400,\n                    dest_height: 300,\n\n                    crop_width: 400,\n                    crop_height: 300,\n\n                    image_format: 'jpeg',\n                    jpeg_quality: 90\n                });\n\n                //Webcam.setSWFLocation('../../../dist/webcam.swf');\n                Webcam.setSWFLocation('webcam.swf');\n\n            } else {\n                document.addEventListener(\"deviceready\",onDeviceReady,false);\n\n            }\n            // todo add logic in callbacks\n            function onDeviceReady() {\n                navigator.camera.getPicture(onSuccess, onFail,\n                    {\n                        sourceType: Camera.PictureSourceType.CAMERA,\n                        correctOrientation: true,\n                        quality: 75,\n                        targetWidth: 200,\n                        destinationType: Camera.DestinationType.DATA_URL\n                    });\n            }\n\n\n            function onSuccess(imageData) {\n                var picture = imageData;\n                var picture = 'data:image/jpeg;base64,' + imageData;\n                $mdDialog.hide(picture);\n            }\n\n            function onFail(message) {\n                alert('Failed because: ' + message);\n                $mdDialog.hide();\n            }\n\n            $scope.$freeze = false;\n\n            $scope.onTakePictureClick = onTakePictureClick;\n            $scope.onResetPicture = onResetPicture;\n            $scope.onCancelClick = onCancelClick;\n\n            return;\n\n            function onTakePictureClick() {\n                if (Webcam) {\n                    if ($scope.$freeze) {\n                        Webcam.snap(function (dataUri) {\n                            $scope.$freeze = false;\n                            $mdDialog.hide(dataUri);\n                        });\n                    } else {\n                        $scope.$freeze = true;\n                        Webcam.freeze();\n                    }\n                }\n            };\n\n            function onResetPicture() {\n                $scope.$freeze = false;\n                Webcam.unfreeze();\n            };\n\n            function onCancelClick() {\n                $mdDialog.cancel();\n            };\n        }]\n    );\n\n})();","/**\n * @file Collage control\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Improve samples in sampler app\n * - Replace placeholder with default image generated on server\n * - Fix resizing problem\n */\n \n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipCollage\", ['pipCore', 'pipData']);\n\n    thisModule.directive('pipCollage',\n        function () {\n            return {\n                restrict: 'EA',\n                scope: false,\n                controller: 'pipCollageController' \n            }\n        }\n    );\n\n    thisModule.controller('pipCollageController',\n        ['$scope', '$element', '$attrs', '$parse', '$rootScope', 'pipUtils', 'pipStrings', 'pipImageUtils', 'pipDataPicture', function ($scope, $element, $attrs, $parse, $rootScope, pipUtils, pipStrings, pipImageUtils, pipDataPicture) {\n            var                         \n                pictureIdsGetter = $attrs.pipPictureIds ? $parse($attrs.pipPictureIds) : null,\n                srcsGetter = $attrs.pipSrcs ? $parse($attrs.pipSrcs) : null,\n                uniqueCodeGetter = $attrs.pipUniqueCode ? $parse($attrs.pipUniqueCode) : null,\n                multipleGetter = $attrs.pipMultiple ? $parse($attrs.pipMultiple) : null,\n                allowOpen = pipUtils.toBoolean($attrs.pipOpen),\n                collageSchemes = pipImageUtils.getCollageSchemes(),\n                resized = 0,\n                $svgData = '<?xml version=\"1.0\" encoding=\"utf-8\"?>'+\n                    '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">'+\n                    '<svg version=\"1.1\"'+\n                    'xmlns=\"http://www.w3.org/2000/svg\"'+\n                    'xmlns:xlink=\"http://www.w3.org/1999/xlink\"'+\n                    'x=\"0px\" y=\"0px\"'+\n                    'viewBox=\"0 0 510 510\"'+\n                    'style=\"enable-background:new 0 0 515 515;\"'+\n                    'xml:space=\"preserve\">'+\n                    '<defs>'+\n                    '<style type=\"text/css\"><![CDATA['+\n                    '#symbol-picture-no-border {'+\n                    '        transform-origin: 50% 50%;'+\n                    '        transform: scale(0.6, -0.6);'+\n                    '    }'+\n                    '        ]]></style>'+\n                    '        </defs>'+\n                    '<rect x=\"0\" width=\"515\" height=\"515\"/>'+\n                    '<path id=\"symbol-picture-no-border\" d=\"M120 325l136-102 69 33 136-82 0-54-410 0 0 136z m341 15c0-28-23-51-51-51-29 0-52 23-52 51 0 29 23 52 52 52 28 0 51-23 51-52z\" />'+\n                    '</svg>';\n\n            // Add class\n            $element.addClass('pip-collage');\n\n            // Also optimization to avoid watch if it is unnecessary\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\n                if (srcsGetter) {\n                    $scope.$watch(srcsGetter, function (newValue) {\n                        //getImageUrls();\n                        generateContent();\n                    });\n                    $scope.$watchCollection(srcsGetter, function (newValue) {\n                        //getImageUrls();\n                        generateContent();\n                    });\n                }\n                else if (pictureIdsGetter) {\n                    $scope.$watch(pictureIdsGetter, function (newValue) {\n                        //getImageUrls();\n                        generateContent();\n                    });\n                }\n            }\n\n            $scope.getElementDimensions = getElementDimensions;\n\n            var update = _.debounce(calculateResize, 50);\n\n            function calculateResize() {\n                var ims = $element.find('img');\n                var i = 0;\n                for ( i; i < ims.length; i++ ) {\n                    var container = angular.element(ims[i].parentElement),\n                        image = angular.element(ims[i]);\n\n                    if (image.css('display') != 'none')\n                        pipImageUtils.setImageMarginCSS(container, image);\n                }\n\n                var icns = $element.find('md-icon');\n\n                var i = 0;\n                for ( i; i < icns.length; i++ ) {\n                    var container = angular.element(icns[i].parentElement),\n                        icn = angular.element(icns[i]);\n                    if (container.css('display') != 'none') {\n                        pipImageUtils.setIconMarginCSS(container[0], icn);\n                    }\n\n                }\n            };\n\n            $scope.$watch($scope.getElementDimensions, function (newValue, oldValue) {\n                if (newValue && oldValue && oldValue.h == newValue.h && oldValue.w == newValue.w) return;\n                calculateResize();\n            }, true);\n\n            generateContent();\n            //getImageUrls();\n\n            return;\n\n            function getElementDimensions() {\n                var dimension = {\n                    'h': $element.height(),\n                    'w': $element.width()\n                };\n\n                return dimension;\n            };\n\n            // Clean up url to remove broken icon\n            function onImageError(event) {\n                var \n                    image = $(event.target),\n                    container = image.parent(),\n                    defaultBlock = container.children('div'),\n                    defaultIcon = image.parent().find('md-icon');\n\n                defaultBlock.css('display', 'block');\n                image.css('display', 'none');\n                pipImageUtils.setIconMarginCSS(container[0], defaultIcon);\n                defaultIcon.empty().append($svgData);\n            };\n\n            // When image is loaded resize/reposition it\n            function onImageLoad($event) {\n                var image = $($event.target),\n                    container =  image.parent(),\n                    defaultBlock = container.children('div');\n\n                pipImageUtils.setImageMarginCSS(container, image);\n\n                defaultBlock.css('display', 'none');\n            };\n\n            function getScheme(count) {\n                var schemes = collageSchemes[count - 1];\n\n                // If nothing to choose from then return\n                if (schemes.length == 1) return schemes[0];\n\n                // Calculate unique had code\n                var uniqueCode = uniqueCodeGetter ? '' + uniqueCodeGetter($scope) : '';\n                var hash = pipStrings.hashCode(uniqueCode);\n\n                // Return reproducable scheme by hashcode\n                return schemes[hash % schemes.length];\n            };\n\n            function getImageUrls() {\n                // Simply return sources\n                if (srcsGetter) {\n                    var srcs = srcsGetter($scope);\n                    //generateContent();\n                    return _.clone(srcs);\n                }\n\n                // Calculate urls if picture ids are specified\n                if (pictureIdsGetter) {\n                    var\n                        ids = pictureIdsGetter($scope) || [],\n                        result = [];\n\n                    for (var i = 0; i < ids.length; i++) {\n                        result.push(pipDataPicture.getPictureContentUrl(ids[i]));\n                    }\n\n                    return result;\n                }\n\n                // Return an empty array otherwise\n                return [];\n            };\n\n            function generatePicture(urls, scheme) {\n                var \n                    url = urls[0],\n                    containerClasses = '',\n                    pictureClasses = '';\n\n                urls.splice(0, 1);\n\n                containerClasses += scheme.fullWidth ? ' pip-full-width' : '';\n                containerClasses += scheme.fullHeight ? ' pip-full-height' : '';\n                containerClasses += ' flex-' + scheme.flex;\n\n                pictureClasses += scheme.leftPadding ? ' pip-left' : '';\n                pictureClasses += scheme.rightPadding ? ' pip-right' : '';\n                pictureClasses += scheme.topPadding ? ' pip-top' : '';\n                pictureClasses += scheme.bottomPadding ? ' pip-bottom' : '';\n\n                if (allowOpen) {\n                    return '<a class=\"pip-picture-container' + containerClasses + '\" flex=\"' + scheme.flex + '\" '\n                        + 'href=\"' + url + '\"  target=\"_blank\">'\n                        + '<div class=\"pip-picture' + pictureClasses + '\"><img src=\"' + url + '\"/>'\n                        + '<div><md-icon></md-icon></div></div></a>';\n                }\n\n                return '<div class=\"pip-picture-container' + containerClasses + '\" flex=\"' + scheme.flex + '\">'\n                    + '<div class=\"pip-picture' + pictureClasses + '\"><img src=\"' + url + '\"/>'\n                    + '<div><md-icon></md-icon></div></div></div>';\n            };\n\n            function generatePictureGroup(urls, scheme) {\n                var classes = '', result;\n\n                classes += scheme.fullWidth ? ' pip-full-width' : '';\n                classes += scheme.fullHeight ? ' pip-full-height' : '';\n                classes += ' flex-' + scheme.flex;\n                classes += ' layout-' + scheme.layout;\n\n                result = '<div class=\"pip-picture-group layout' + classes + '\" flex=\"'\n                    + scheme.flex + '\" layout=\"' + scheme.layout + '\">';\n\n                // Generate content for children recursively\n                for (var i = 0; i < scheme.children.length; i++) {\n                    result += generate(urls, scheme.children[i]);\n                }\n\n                result += '</div>';\n                return result;\n            };\n\n            function generate(urls, scheme) {\n                if (scheme.group)\n                    return generatePictureGroup(urls, scheme);\n                return generatePicture(urls, scheme);\n            };\n\n            function generateContent(urls) {\n                // Unbind previously defined actions handlers\n                $element.find('img')\n                    .unbind('error')\n                    .unbind('load');\n\n                // Clean up content\n                $element.empty();\n\n                // Calculate list of image urls\n                var urls = getImageUrls();\n\n                // And exit if nothing to show\n                if (urls.length == 0) {\n                    $element.hide();\n                    return;\n                }\n\n                // Limit collage only to one element if not specified otherwise\n                if (urls.length > 8) {\n                    var multiple = multipleGetter ? multipleGetter($scope) : false;\n\n                    if (!multiple) {\n                        urls.length = 8;\n                    }\n                }\n\n                if (urls.length <= 8) {\n                    // Get scheme for visualization\n                    var scheme = getScheme(urls.length);\n\n                    // Generate and add content\n                    var html = '<div class=\"pip-collage-section\">' + generate(urls, scheme) + '</div>';\n                    html += '<div class=\"clearfix\"></div>';\n                    $element.html(html);\n                } else {\n                    var html = '';\n\n                    while (urls.length > 0) {\n                        var partialUrls = urls.splice(0, 8);\n\n                        // Get scheme for visualization\n                        var scheme = getScheme(partialUrls.length);\n\n                        // Generate and add content\n                        html += '<div class=\"pip-collage-section\">' + generate(partialUrls, scheme) + '</div>';\n                    }\n\n                    html += '<div class=\"clearfix\"></div>';\n                    $element.html(html);\n                }\n\n                // Bind events to images...\n                $element.find('img')\n                    .bind('error', onImageError)\n                    .bind('load', onImageLoad);\n\n                // Show the new element\n                $element.show();\n            };\n\n        }]\n\n    );\n\n})();\n\n","/**\n * @file Camera dialog\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Add sample to sampler app\n */\n\n/* global angular, Webcam */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipGallerySearchDialog',\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates', 'pipRest']);\n\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'IMAGE_GALLERY': 'Add from image gallery',\n            'SEARCH_PICTURES': 'Search for pictures...',\n            'IMAGE_START_SEARCH': 'Images will appear here once you start searching'\n        });\n        pipTranslateProvider.translations('ru', {\n            'IMAGE_GALLERY': 'Добавить из галереи изображений',\n            'SEARCH_PICTURES': 'Поиск изображений...',\n            'IMAGE_START_SEARCH': 'Картинки появятся после начала поиска'\n        });\n    }]);\n\n    thisModule.factory('pipGallerySearchDialog',\n        ['$mdDialog', function ($mdDialog) {\n            return {\n                show: function (successCallback, multiple) {\n                    $mdDialog.show({\n                        templateUrl: 'gallery_search_dialog/gallery_search_dialog.html',\n                        clickOutsideToClose: true,\n                        controller: 'pipGallerySearchController',\n                        locals: {\n                            multiple: multiple\n                        }\n                    }).then(function (result) {\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                    }, function () {\n\n                    });\n                }\n            };\n        }]);\n\n    thisModule.controller('pipGallerySearchController',\n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', '$http', 'pipRest', 'multiple', 'pipTransaction', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, $http, pipRest, multiple, pipTransaction) {\n\n            var prevSearch = '',\n                url = pipRest.serverUrl() + '/api/images/search',\n                images = [];\n\n            $scope.theme = $rootScope.$theme;\n            $scope.$serverUrl = pipRest.serverUrl();\n            $scope.$search = '';\n            $scope.$images = [];\n            $scope.transaction = pipTransaction('search', $scope);\n\n            $scope.onSearchClick = onSearchClick;\n            $scope.onKeyPress = onKeyPress;\n            $scope.onImageClick = onImageClick;\n            $scope.onAddClick = onAddClick;\n            $scope.onCancelClick = onCancelClick;\n            $scope.addButtonDisabled = addButtonDisabled;\n            $scope.onStopSearchClick = onStopSearchClick;\n\n            focusSearchText();\n\n            return;\n\n            function onSearchClick() {\n                if ($scope.transaction.busy()) return;\n\n                if ($scope.$search == '' || $scope.$search == prevSearch) return;\n\n                prevSearch = $scope.$search;\n                $scope.$images = [];\n                $scope.stop = null;\n                var requestUrl = url + '?q=' + $scope.$search;\n\n                var transactionId = $scope.transaction.begin('ENTERING');\n                if (!transactionId) return;\n\n                $http['get'](requestUrl)\n                    .success(function (results) {\n                        if ($scope.transaction.aborted(transactionId))return;\n\n\n                        for (var i = 0; i < results.length; i++) {\n                            $scope.$images.push({\n                                checked: false,\n                                url: results[i].link,\n                                thumbnail: results[i].thumbnail\n                            });\n                        }\n                        $scope.transaction.end();\n\n\n                    }).\n                    error(function (error) {\n                        console.error(error)\n                    });\n            }\n\n            function onStopSearchClick() {\n                $scope.transaction.abort();\n                prevSearch = '';\n            }\n\n            function onKeyPress($event) {\n                if ($event.keyCode === 13)\n                    $scope.onSearchClick();\n            }\n\n            function onImageClick(image) {\n                if ($scope.transaction.busy()) return;\n\n                image.checked = !image.checked;\n\n                if (multiple) {\n                    if (image.checked) {\n                        images.push(image);\n                    } else {\n                        _.remove(images, {url: image.url});\n                    }\n                } else {\n                    if (image.checked) {\n                        if (images.length > 0) {\n                            images[0].checked = false;\n                            images[0] = image;\n                        } else {\n                            images.push(image);\n                        }\n                    } else {\n                        images = [];\n                    }\n                }\n            }\n\n            function onAddClick() {\n                if ($scope.transaction.busy()) return;\n\n                var result = [];\n                images.forEach(function (image) {\n                    if (image.checked)\n                        result.push(image.url);\n                });\n                $mdDialog.hide(result);\n            }\n\n            function onCancelClick() {\n                $mdDialog.cancel();\n            }\n\n            function addButtonDisabled() {\n                return images.length == 0 || $scope.transaction.busy();\n            }\n\n            function focusSearchText() {\n                setTimeout(function () {\n                    var element = $('.pip-gallery-search-dialog .search-images');\n                    if (element.length > 0)\n                        element.focus();\n                }, 0);\n            }\n\n        }]\n    );\n\n})();","/**\n * @file Picture control\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Improve samples in sampler app\n * - Replace placeholder with default image generated on server\n * - Fix resizing problem\n */\n \n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipPicture\", ['pipCore', 'pipData']);\n\n    thisModule.directive('pipPicture', \n        function() {\n            return {\n                restrict: 'EA',\n                scope: {\n                    src: '&pipSrc',\n                    pictureId: '=pipPictureId',\n                    defaultIcon: '=pipDefaultIcon'\n                },\n                template: '<img ui-event=\"{ error: \\'onImageError($event)\\', load: \\'onImageLoad($event)\\' }\"/>'\n                          + '<div><span></span></div>',\n                controller: 'pipPictureController' \n            }\n        }\n    );\n\n    thisModule.controller('pipPictureController',\n        ['$scope', '$element', '$attrs', '$rootScope', 'pipUtils', 'pipImageUtils', 'pipDataPicture', function ($scope, $element, $attrs, $rootScope, pipUtils, pipImageUtils, pipDataPicture) {\n            var \n                image = $element.children('img'),\n                defaultBlock = $element.children('div');\n\n            $scope.onImageError = onImageError;\n            $scope.onImageLoad = onImageLoad;\n\n            // Add class\n            $element.addClass('pip-picture');\n\n            bindControl();\n\n            // Also optimization to avoid watch if it is unnecessary\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\n                $scope.$watch($scope.pictureId, function(newValue) {\n                    if ($scope.pictureId != newValue) bindControl();\n                });\n            }\n\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\n                $scope.$watch($scope.src, function(newValue) {\n                    if ($scope.src != newValue)\n                      bindControl();\n                });\n            }\n\n            return;\n\n            // Clean up url to remove broken icon\n            function onImageError($event) {\n                $scope.$apply(function() {\n                    var image = $($event.target);\n\n                    pipImageUtils.setErrorImageCSS(image);\n                    defaultBlock.css('display', 'block');\n                });\n            };\n\n            // When image is loaded resize/reposition it\n            function onImageLoad($event) {\n                var image = $($event.target);\n                pipImageUtils.setImageMarginCSS($element, image);\n                defaultBlock.css('display', 'none');\n            };\n\n            function bindControl() {\n                if ($scope.pictureId) {\n                    var url = pipDatPicture.getPictureContentUrl($scope.pictureId); \n                    // serverUrl = pipRest.serverUrl(),\n                    //     userId = ($rootScope.$user || {}).id,\n                    //     partyId = ($rootScope.$party || {}).id || userId,\n                    //     url = serverUrl + '/api/parties/' + partyId + '/files/' + $scope.pictureId + '/content';\n                        \n\n                    image.attr('src', url);\n                } else {\n                    if ($scope.src) image.attr('src', $scope.src());\n                    else image.attr('src', '');\n                }\n            };\n        }]        \n    ); \n\n})();\n\n","/**\n * @file Picture control\n * @copyright Digital Living Software Corp. 2014-2015\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipPictureEdit', ['ui.event', 'angularFileUpload', 'pipData', 'pipPicturePaste',\n        'pipTranslate', 'pipPictures.Templates']);\n\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            ERROR_WRONG_IMAGE_FILE: 'Incorrect image file. Please, choose another one',\n            PICTURE_EDIT_TEXT: 'Click here to upload a picture'\n        });\n        pipTranslateProvider.translations('ru', {\n            ERROR_WRONG_IMAGE_FILE: 'Неправильный файл с изображением. Выберете другой файл',\n            PICTURE_EDIT_TEXT: 'Нажмите сюда для загрузки картинки'\n        });\n    }]);\n\n    thisModule.directive('pipPictureEdit',\n        function () {\n            return {\n                restrict: 'EA',\n                scope: {\n                    ngDisabled: '&',\n                    pipCreated: '&',\n                    pipChanged: '&',\n                    pipReset: '&',\n                    pipPictureId: '=',\n                    pipPartyId: '=',\n                    pipAddedPicture: '='\n                },\n                templateUrl: 'picture_edit/picture_edit.html',\n                controller: 'pipPictureEditController'\n            };\n        }\n    );\n\n    thisModule.controller('pipPictureEditController',\n        ['$scope', '$element', '$attrs', '$http', '$upload', '$timeout', '$rootScope', '$parse', 'pipDataPicture', 'pipPicturePaste', 'pipImageUtils', 'pipUtils', 'pipDataAvatar', function ($scope, $element, $attrs, $http, $upload, $timeout, $rootScope, $parse, pipDataPicture, pipPicturePaste,\n                  pipImageUtils, pipUtils, pipDataAvatar) {\n            var\n                $control = $element.children('.pip-picture-upload'),\n                $input = $control.children('input[type=file]');\n\n            $scope.text = $attrs.pipDefaultText || 'PICTURE_EDIT_TEXT';\n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\n            $scope.pictureStartState = pipUtils.toBoolean($scope.pipAddedPicture) ? 'copied' : 'original';\n\n            $scope.control = {\n                url: '',\n                progress: 0,\n                uploaded: false,\n                uploading: false,\n                loaded: false,\n                file: null,\n                state: $scope.pictureStartState //'original'\n            };\n\n            $scope.control.reset = resetImage;\n            $scope.control.save = saveImage;\n            $scope.empty = empty;\n            $scope.isUpdated = isUpdated;\n            $scope.readItemLocally = readItemLocally;\n            $scope.onDeleteClick = onDeleteClick;\n            $scope.onKeyDown = onKeyDown;\n            $scope.onImageError = onImageError;\n            $scope.onImageLoad = onImageLoad;\n            $scope.onChange = onChange;\n            $scope.onBlur = onBlur;\n            $scope.onFocus = onFocus;\n\n            // Also optimization to avoid watch if it is unnecessary\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\n                $scope.$watch('pipPictureId', function (newValue) {\n                    $scope.control.reset();\n                });\n            }\n\n            $scope.$watch($scope.ngDisabled, function (newValue) {\n                $input.attr('disabled', $scope.control.disabled);\n            });\n\n            // Add class\n            $element.addClass('pip-picture-edit');\n\n            // Initialize control\n            $scope.control.reset();\n\n            // Execute callback\n            if ($scope.pipCreated) {\n                $scope.pipCreated({\n                    $event: {sender: $scope.control},\n                    $control: $scope.control\n                });\n            }\n\n            return;\n\n            function resetImage(afterDeleting) {\n                $scope.control.progress = 0;\n                $scope.control.uploading = false;\n                $scope.control.uploaded = false;\n                $scope.control.file = null;\n                $scope.control.state = $scope.pictureStartState; //'original';\n                $scope.control.url = '';\n                var url = '';\n\n                if (!afterDeleting) {\n                    if ($rootScope.$party && $rootScope.$party.id && $scope.pipPictureId) {\n                        url = pipDataPicture.getPictureContentUrl($scope.pipPictureId);\n                    }\n                    if (!url) return;\n\n                    $scope.control.url = url;\n                    $scope.control.uploaded = true;\n                    $scope.onChange();\n                } else $scope.onChange();\n            };\n\n            function onFocus() {\n                pipPicturePaste.addPasteListener(function (item) {\n                    $scope.readItemLocally(item.url, item.file);\n                });\n            };\n\n            function onBlur() {\n                pipPicturePaste.removePasteListener();\n            };\n\n            function savePicture(successCallback, errorCallback) {\n                var\n                    control = $scope.control,\n                    file = control.file;\n\n                if ($scope.control.file !== null) {\n                    var fileReader = new FileReader();\n\n                    fileReader.onload = function (e) {\n                        control.uploading = true;\n\n                        var upload = pipDataPicture.createPicture(\n                            {\n                                name: file.name,\n                                type: file.type,\n                                data: e.target.result\n                            }, \n                            function (response) {\n                                    $scope.pipPictureId = response.data.id;\n                                    control.reset();\n                                    if (successCallback) successCallback(response);\n                            },\n                            function () {\n                                    control.uploading = false;\n                                    control.upload = false;\n                                    control.progress = 0;\n\n                                    if (errorCallback) errorCallback(error);\n                                    else console.error(error);\n                            },\n                            function (e) {\n                                // Math.min is to fix IE which reports 200% sometimes\n                                item.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\n                            }\n                        );\n                    };\n\n                    fileReader.readAsArrayBuffer(file);\n                } else {\n                    var name = $scope.control.url.slice(item.url.lastIndexOf('/') + 1, $scope.control.url.length).split('?')[0],\n                        filter = name + '&url=' + $scope.control.url;\n                    \n                    control.uploading = true;\n                 \n                     pipDataAvatar.createAvatarByUrl(\n                         pipDatPicture.getPicturePostUrl(filter),\n                         function (response) {\n                            $scope.pipPictureId = response.id;\n                            control.reset();\n\n                            if (successCallback) successCallback(response);\n                         },\n                         function (error) {\n                            control.uploading = false;\n                            control.upload = false;\n\n                            if (errorCallback) errorCallback(error);\n                            else console.error(error);\n                         }\n                     );\n                }\n\n            };\n\n            function deletePicture(successCallback, errorCallback) {\n                var control = $scope.control;\n\n                pipDataPicture.deletePicture(\n                    $scope.pipPictureId, \n                    function () {\n                        $scope.pipPictureId = null;\n                        control.reset(true);\n\n                        if (successCallback) successCallback();\n                    }, \n                    function (error) {\n                        control.uploading = false;\n                        control.upload = false;\n                        control.progress = 0;\n\n                        if (errorCallback) errorCallback(error);\n                        else console.error(error);\n                    });\n            };\n\n            function saveImage(successCallback, errorCallback) {\n                // Process changes of the image\n                if ($scope.control.state == 'changed') {\n                    savePicture(successCallback, errorCallback);\n                }\n                // Process deletion of the image\n                else if ($scope.control.state == 'deleted') {\n                    deletePicture(successCallback, errorCallback);\n                }\n                // Process if no changes were made\n                else {\n                    if (successCallback) successCallback();\n                }\n            };\n\n            // Visual functions\n            function empty() {\n                return $scope.control.url == '' && !$scope.control.uploading;\n            };\n\n            function isUpdated() {\n                return $scope.control.state != 'original';\n            };\n\n            // Process user events\n            function readItemLocally(url, file) {\n                $scope.control.file = file;\n                $scope.control.url = url;\n                $scope.control.state = 'changed';\n                $scope.onChange();\n            };\n\n            function onDeleteClick($event) {\n                $event.stopPropagation();\n\n                $control.focus();\n\n                $scope.control.file = null;\n                $scope.control.url = '';\n                if ($scope.control.state != 'copied') $scope.control.state = 'deleted';\n\n                $scope.onChange();\n            };\n\n            function onKeyDown($event) {\n                if ($event.keyCode == 13 || $event.keyCode == 32) {\n                    // !! Avoid clash with $apply()\n                    setTimeout(function () {\n                        $control.trigger('click');\n                    }, 0);\n                } else if ($event.keyCode == 46 || $event.keyCode == 8) {\n                    $scope.control.file = null;\n                    $scope.control.url = '';\n\n                    $scope.control.state = 'deleted';\n\n                    $scope.onChange();\n                } else if ($event.keyCode == 27) {\n                    $scope.control.reset();\n                }\n            };\n\n            // Clean up url to remove broken icon\n            function onImageError($event) {\n                $scope.$apply(function () {\n                    $scope.control.url = '';\n\n                    var image = $($event.target);\n\n                    pipImageUtils.setErrorImageCSS(image, {width: 'auto', height: '100%'});\n                });\n            };\n\n            // When image is loaded resize/reposition it\n            function onImageLoad($event) {\n                var image = $($event.target);\n                pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\n                $scope.control.uploading = false;\n            };\n\n            // On change event\n            function onChange() {\n                if ($scope.pipChanged) {\n                    $scope.pipChanged({\n                        $event: {sender: $scope.control},\n                        $control: $scope.control\n                    });\n                }\n            };\n\n        }]\n    );\n\n})();\n\n","/**\n * @file Picture list edit control\n * @copyright Digital Living Software Corp. 2014-2015\n * @todo\n * - Improve samples in sampler app\n * - Add animations to add/remove pictures\n * - ?? Replace placeholder with default image generated on server?\n */\n \n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module(\"pipPictureListEdit\", \n        ['ui.event', 'angularFileUpload', 'pipCore', 'pipFocused', 'pipData', 'pipPicturePaste']);\n\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'PICTURE_LIST_EDIT_TEXT': 'Click here to add a picture',\n            'ERROR_TRANSACTION_IN_PROGRESS': 'Transaction is in progress. Please, wait until it is finished or abort',\n            'ERROR_IMAGE_PRELOADING': 'Image loading error. The picture can not be saved'\n        });\n        pipTranslateProvider.translations('ru', {\n            'PICTURE_LIST_EDIT_TEXT': 'Нажмите сюда чтобы добавить картинку',\n            'ERROR_TRANSACTION_IN_PROGRESS': 'Транзакция еще не завершена. Подождите окончания или прервите её',\n            'ERROR_IMAGE_PRELOADING': 'Ошибка при загрузки картинки. Картинка не сохранена.'\n        });\n    }]);\n\n    thisModule.directive('pipPictureListEdit', \n        function() {\n            return {\n                restrict: 'EA',\n                scope: {\n                    pipPictureIds: '=',\n                    pipAddedPicture: '=',\n                    ngDisabled: '&',\n                    pipCreated: '&',\n                    pipChanged: '&'\n                },\n                templateUrl: 'picture_list_edit/picture_list_edit.html',\n                controller: 'pipPictureListEditController' \n            };\n        }\n    );\n\n    thisModule.controller('pipPictureListEditController',\n        ['$scope', '$rootScope', '$element', '$attrs', '$parse', '$http', '$upload', '$timeout', 'pipUtils', 'pipDataPicture', 'pipPicturePaste', 'pipImageUtils', 'pipDataAvatar', function($scope, $rootScope, $element, $attrs, $parse, $http, $upload, $timeout, pipUtils,\n                 pipDataPicture, pipPicturePaste, pipImageUtils, pipDataAvatar) {\n                \n            var\n                $control = $element.children('.pip-picture-drop'),\n                itemPin = 0;\n\n            $scope.text = $attrs.pipDefaultText || 'PICTURE_LIST_EDIT_TEXT';\n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\n            $scope.pipRebind = pipUtils.toBoolean($attrs.pipRebind);\n            $scope.pictureStartState = pipUtils.toBoolean($scope.pipAddedPicture) ? 'copied' : 'original';\n\n            $scope.control = {\n                uploading: 0,\n                items: []\n            };\n\n            $scope.control.reset = reset;\n            $scope.control.save = save;\n            $scope.control.abort = abort;\n            $scope.filterItem = function(item) {\n                return item.state != 'deleted';\n            };\n            $scope.readItemLocally = readItemLocally;\n            $scope.onSelectClick = onSelectClick;\n            $scope.onDeleteClick = onDeleteClick;\n            $scope.onKeyDown = onKeyDown;\n            $scope.onImageError = onImageError;\n            $scope.onImageLoad = onImageLoad;\n            $scope.onChange = onChange;\n            $scope.onBlur = onBlur;\n            $scope.onFocus = onFocus;\n            \n            // Watch for changes\n            if ($scope.pipRebind) {\n                $scope.$watch(\n                    function () {\n                        // Todo: Optimize change tracking\n                        return $scope.pipPictureIds;\n                    },\n                    function (newValue) {\n                        $scope.control.reset();\n                    }\n                );\n            }\n\n            // Add class\n            $element.addClass('pip-picture-list-edit');\n\n            // Initialize control\n            $scope.control.reset();\n\n            // Execute callback\n            if ($scope.pipCreated) {\n                $scope.pipCreated({\n                    $event: { sender: $scope.control },\n                    $control: $scope.control\n                });\n            }\n\n            return;\n\n            function contentUrl(id) {\n                return pipDataPicture.getPictureContentUrl(id); \n            }\n\n            function onImageError($event, item) {\n                item.error = true;\n            };\n            \n            function onFocus(a) {\n                pipPicturePaste.addPasteListener(function (item) {\n                    $scope.readItemLocally(item.url, item.file);\n                });\n            };\n\n            function onBlur () {\n                pipPicturePaste.removePasteListener();\n            };\n\n            function getItems() {\n                var\n                    pictureIds = $scope.pipPictureIds,\n                    items = [];\n\n                if (pictureIds == null || pictureIds.length == 0)\n                    return items;\n\n                for (var i = 0; i < pictureIds.length; i++) {\n                    items.push({\n                        pin: itemPin++,\n                        id: pictureIds[i],\n                        uploading: false,\n                        uploaded: false,\n                        progress: 0,\n                        file: null,\n                        url: contentUrl(pictureIds[i]),\n                        state: $scope.pictureStartState //'original'\n                    });\n                }\n\n                return items;\n            }\n\n            function setItems() {\n                // Clean the array\n                if ($scope.pipPictureIds && $scope.pipPictureIds.length > 0)\n                    $scope.pipPictureIds.splice(0, $scope.pipPictureIds.length);\n\n                for (var i = 0; i < $scope.control.items.length; i++) {\n                    var item = $scope.control.items[i];\n                    if (item.id)\n                        $scope.pipPictureIds.push(item.id);\n                }\n            }\n\n            function reset() {\n                $scope.control.uploading = 0;\n                $scope.control.items = getItems();\n\n            }\n\n            function addItem(item, callback) {\n                if (item.file !== null) {\n                    var file = item.file;\n\n                    var fileReader = new FileReader();\n                    fileReader.onload = function (e) {\n                        if (item.uploading) return;\n                        item.uploading = true;\n\n                        item.upload = pipDataPicture.createPicture(\n                            {\n                                name: item.file.name,\n                                type: item.file.type,\n                                data: e.target.result\n                            }, \n                            function (response) {\n                                    item.id = response.data ? response.data.id : null;\n                                    item.uploaded = true;\n                                    item.uploading = false;\n                                    item.progress = 0;\n                                    item.upload = null;\n                                    item.file = null;\n                                    item.url = contentUrl(item.id);\n                                    item.state = 'original';\n                                    callback();\n                            },\n                            function () {\n                                    item.uploaded = false;\n                                    item.uploading = false;\n                                    item.progress = 0;\n                                    item.upload = null;\n                                    callback(error);\n                            },\n                            function (e) {\n                                // Math.min is to fix IE which reports 200% sometimes\n                                item.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\n                            }\n                        );\n                    };\n\n                    fileReader.readAsArrayBuffer(file);\n                } else {\n                    var name = item.url.slice(item.url.lastIndexOf('/') + 1, item.url.length).split('?')[0],\n                        filter = name + '&url=' + item.url;\n                    \n                    item.uploading = true;\n                 \n                     pipDataAvatar.createAvatarByUrl(\n                         pipDataPicture.getPicturePostUrl(filter),\n                         function (response) {\n                            item.id = response.data ? response.data.id : response.id || null;\n                            item.uploaded = true;\n                            item.uploading = false;\n                            item.progress = 0;\n                            item.upload = null;\n                            item.file = null;\n                            item.url = contentUrl(item.id);\n                            item.state = 'original';\n                            callback();\n                         },\n                         function (error) {\n                            item.uploaded = false;\n                            item.uploading = false;\n                            item.progress = 0;\n                            item.upload = null;\n                            callback();\n                         }\n                     );\n\n                }\n            }\n\n            function deleteItem(item, callback) {\n                var control = $scope.control;\n\n                // Avoid double transactions\n                if (item.upload) {\n                    item.upload.abort();\n                    item.upload = null;\n                }\n\n                if (item.state != 'deleted')\n                    return;\n\n                pipDataPicture.deletePicture(\n                    item.id, \n                    function () {\n                        _.remove(control.items, {pin: item.pin});\n                        callback();\n                    }, \n                    function (data) {\n                        // Todo: perform a better processing\n                        if (data == null) {\n                            _.remove(control.items, {pin: item.pin});\n                        } else {\n                            item.uploaded = false;\n                            item.uploading = false;\n                            item.progress = 0;\n                            item.upload = null;\n                        }\n                        callback(data);\n                    });\n            }\n\n            function save(successCallback, errorCallback) {\n                var control = $scope.control;\n\n                if (control.uploading) {\n                    if (errorCallback) errorCallback('ERROR_TRANSACTION_IN_PROGRESS');\n                    return;\n                }\n\n                control.error = null;\n                control.uploading = 0;\n\n                var onItemCallback = function(error) {\n                    // Storing only the first error\n                    if (error && !control.error) {\n                        control.error = error;\n                    }\n\n                    control.uploading--;\n\n                    // Finished uploading\n                    if (control.uploading == 0) {\n                        if (control.error) {\n                            if (errorCallback) errorCallback(control.error);\n                            else console.error(control.error);\n                        } else {\n                            setItems();\n                            if (successCallback) successCallback();\n                        }\n                    }\n                };\n\n                for (var i = 0; i < control.items.length; i++) {\n                    var item = control.items[i];\n                    if (item.state == 'added' && !item.error) {\n                        control.uploading++;\n                        addItem(item, onItemCallback);\n                    } else if (item.state == 'deleted') {\n                        control.uploading++;\n                        deleteItem(item, onItemCallback);\n                    }\n                }\n\n                // Nothing was uploaded\n                if (control.uploading == 0) {\n                    if (successCallback) successCallback();\n                }\n            }\n\n            function abort() {\n                var control = $scope.control;\n\n                for (var i = 0; i < control.items.length; i++) {\n                    var item = control.items[i];\n\n                    if (item.uploading) {\n                        if (item.upload) item.upload.abort();\n\n                        item.uploaded = false;\n                        item.uploading = false;\n                        item.progress = 0;\n                        item.upload = null;\n                    }\n                }\n\n                // Abort transaction\n                control.uploading = 0;\n            }\n\n            function readItemLocally(url, file) {\n                $scope.control.items.push({\n                    pin: itemPin++,\n                    id: null,\n                    uploading: false,\n                    uploaded: false,\n                    progress: 0,\n                    file: file,\n                    url: url,\n                    state: 'added'\n                });\n\n                $scope.onChange();\n            }\n\n            function onSelectClick($files) {\n                $control.focus();\n\n                if ($files == null || $files.length == 0)\n                    return;\n                for (var i = 0; i < $files.length; i++) {\n                    var file = $files[i];\n\n                    if (file.type.indexOf('image') > -1) {\n                        readItemLocally(file);\n                    }\n                }\n            }\n\n            function onDeleteClick(item) {\n                if (item.state == 'added' || item.state == 'copied') {\n                    _.remove($scope.control.items, {pin: item.pin});\n                } else {\n                    item.state = 'deleted';\n                }\n\n                $scope.onChange();\n            }\n\n            function onKeyDown($event, item) {\n                if (item) {\n                    if ($event.keyCode == 46 || $event.keyCode == 8) {\n                        if (item.state == 'added') {\n                            _.remove($scope.control.items, {pin: item.pin});\n                        } else {\n                            item.state = 'deleted';\n                        }\n\n                        $scope.onChange();\n                    }\n                } else {\n                    if ($event.keyCode == 13 || $event.keyCode == 32) {\n                        // !! Avoid clash with $apply()\n                        setTimeout(function() {\n                            $control.trigger('click');\n                        }, 0);\n                    }\n                }\n            }\n\n            function onImageLoad($event, item) {\n                item.error = false;\n                setTimeout(function () {\n                    var image = $($event.target);\n                    pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\n                }, 250);\n\n                item.loaded = true;\n            }\n\n            // On change event\n            function onChange() {\n                if ($scope.pipChanged) {\n                    $scope.pipChanged({\n                        $event: { sender: $scope.control },\n                        $control: $scope.control\n                    });\n                }\n            }\n        }]\n        \n    ); \n\n})();\n\n","/**\n * @file Picture URL dialog\n * @copyright Digital Living Software Corp. 2014-2016\n * @todo\n * - Add sample to sampler app\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipPictureUrlDialog',\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates']);\n\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\n        pipTranslateProvider.translations('en', {\n            'PICTURE_FROM_WEBLINK': 'Add from web link',\n            'LINK_PICTURE': 'Link to the picture...'\n        });\n        pipTranslateProvider.translations('ru', {\n            'PICTURE_FROM_WEBLINK': 'Добавить из веб ссылки',\n            'LINK_PICTURE': 'Ссылка на изображение...'\n        });\n    }]);\n\n    thisModule.factory('pipPictureUrlDialog',\n        ['$mdDialog', function ($mdDialog) {\n            return {\n                show: function (successCallback) {\n                    $mdDialog.show({\n                        templateUrl: 'picture_url_dialog/picture_url_dialog.html',\n                        clickOutsideToClose: true,\n                        controller: 'pipPictureUrlDialogController'\n                    }).then(function (result) {\n                        if (successCallback) {\n                            successCallback(result);\n                        }\n                    });\n                }\n            };\n    }]);\n\n    thisModule.controller('pipPictureUrlDialogController', \n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', 'pipImageUtils', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, pipImageUtils) {\n            $scope.url = '';\n            $scope.invalid = true;\n            $scope.theme = $rootScope.$theme;\n            $scope.checkUrl = checkUrl;\n            $scope.onCancelClick = onCancelClick;\n            $scope.onAddClick = onAddClick;\n\n            return;\n\n            function setImageSize(img) {\n                var imageWidth = img.width(),\n                    imageHeight = img.height();\n\n                var cssParams = {};\n\n                if ((imageWidth) > (imageHeight)) {\n                    cssParams['width'] = '250px';\n                    cssParams['height'] = 'auto';\n                } else {\n                    cssParams['width'] = 'auto';\n                    cssParams['height'] = '250px';\n                }\n\n                img.css(cssParams);\n            }\n\n            function checkUrl() {\n                var img = $(\"img#url_image\")\n                    .on('error', function () {\n                        $scope.invalid = true;\n                        $scope.$apply();\n                    })\n                    .on('load', function () {\n                        $scope.invalid = false;\n                        setImageSize(img);\n                        $scope.$apply();\n                    })\n                    .attr(\"src\", $scope.url);\n            };\n            \n            function onCancelClick() {\n                $mdDialog.cancel();\n            };\n            \n            function onAddClick() {\n                $mdDialog.hide($scope.url);\n            };\n        }]\n    );\n\n})();","/**\n * @file Picture paste service\n * @copyright Digital Living Software Corp. 2014-2015\n */\n\n/* global $, angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipPicturePaste', []);\n\n    thisModule.factory('pipPicturePaste', ['$timeout', function ($timeout) {\n        var paste = {};\n        var pasteCatcher = null;\n\n        paste.addPasteListener = function (onPaste) {\n            if (!window.Clipboard) {\n                if (pasteCatcher !== null) this.removePasteElement();\n\n                pasteCatcher = document.createElement(\"div\");\n\n                // Firefox allows images to be pasted into contenteditable elements\n                pasteCatcher.setAttribute(\"contenteditable\", \"true\");\n\n                // We can hide the element and append it to the body,\n                //pasteCatcher.style.opacity = 0;\n                $(pasteCatcher).css({\n                    \"position\": \"absolute\",\n                    \"left\": \"-999\",\n                    width: \"0\",\n                    height: \"0\",\n                    \"overflow\": \"hidden\",\n                    outline: 0\n                });\n\n                document.body.appendChild(pasteCatcher);\n            }\n\n            $(document).on('paste', function (event) {\n                if (event.clipboardData == null && event.originalEvent) {\n                    event = event.originalEvent;\n                }\n\n                // Paste for chrome\n                if (event.clipboardData) {\n                    var items = event.clipboardData.items;\n\n                    _.each(items, function (item) {\n                        if (item.type.indexOf(\"image\") != -1) {\n                            var file = item.getAsFile();\n\n                            var fileReader = new FileReader();\n                            fileReader.onload = function (e) {\n                                $timeout(function () {\n                                    onPaste({url: e.target.result, file: file});\n                                });\n                            };\n                            fileReader.readAsDataURL(file);\n                        }\n                    });\n                }\n                // Paste for IE\n                else if (window.clipboardData && window.clipboardData.files) {\n                    _.each(window.clipboardData.files, function (file) {\n                        var fileReader = new FileReader();\n                        fileReader.onload = function (e) {\n                            $timeout(function () {\n                                onPaste({url: e.target.result, file: file});\n                            });\n                        };\n                        fileReader.readAsDataURL(file);\n                    });\n                }\n            });\n        };\n\n        paste.removePasteListener = function () {\n            if (!window.Clipboard) {\n                if (pasteCatcher !== null) {\n                    document.body.removeChild(pasteCatcher);\n                    pasteCatcher = null;\n                }\n            }\n            $(document).off('paste');\n        };\n\n        return paste;\n    }]);\n\n})();\n","/**\n * @file Areas data cache\n * @copyright Digital Living Software Corp. 2014-2015\n */\n\n/* global angular */\n\n(function () {\n    'use strict';\n\n    var thisModule = angular.module('pipImageUtils', []);\n\n    thisModule.service('pipImageUtils',\n        ['$http', 'pipStrings', '$rootScope', 'pipRest', function($http, pipStrings, $rootScope, pipRest) {\n\n// todo to data_avatar\n            var\n//                 colorClasses = [\n//                     'pip-avatar-color-0', 'pip-avatar-color-1', 'pip-avatar-color-2', 'pip-avatar-color-3',\n//                     'pip-avatar-color-4', 'pip-avatar-color-5', 'pip-avatar-color-6', 'pip-avatar-color-7',\n//                     'pip-avatar-color-8', 'pip-avatar-color-9', 'pip-avatar-color-10', 'pip-avatar-color-11',\n//                     'pip-avatar-color-12', 'pip-avatar-color-13', 'pip-avatar-color-14', 'pip-avatar-color-15'\n//                 ],\n// // todo to data_avatar\n//                 colors = [\n//                     'rgba(239,83,80,1)', 'rgba(236,64,122,1)', 'rgba(171,71,188,1)',\n//                     'rgba(126,87,194,1)', 'rgba(92,107,192,1)', 'rgba(3,169,244,1)',\n//                     'rgba(0,188,212,1)', 'rgba(0,150,136,1)', 'rgba(76,175,80,1)',\n//                     'rgba(139,195,74,1)', 'rgba(205,220,57,1)', 'rgba(255,193,7,1)',\n//                     'rgba(255,152,0,1)', 'rgba(255,87,34,1)', 'rgba(121,85,72,1)',\n//                     'rgba(96,125,139,1)'\n//                 ],\n// // todo to data_avatar\n//                 entityTypes = {\n//                     goal: 'goals',\n//                     objective: 'goals',\n//                     dream: 'goals',\n//                     accomplishment: 'goals',\n//                     area: 'areas',\n//                     overall: 'visions',\n//                     vision: 'visions',\n//                     event: 'events',\n//                     instance: 'events'\n//                 },\n\n                collageSchemes = [\n                    // 1\n                    [\n                        { flex: 100, fullWidth: true, fullHeight: true }\n                    ],\n                    // 2\n                    [\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 50, fullHeight: true, rightPadding: true },\n                                { flex: 50, fullHeight: true, leftPadding: true }\n                            ]\n                        }\n                    ],\n                    // 3\n                    [\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 33, fullHeight: true, rightPadding: true },\n                                { flex: 33, fullHeight: true, leftPadding: true, rightPadding: true },\n                                { flex: 33, fullHeight: true, leftPadding: true }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 50, fullHeight: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, leftPadding: true, bottomPadding: true },\n                                        { flex: 50, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 70, fullHeight: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 30,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, leftPadding: true, bottomPadding: true },\n                                        { flex: 50, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 50, fullWidth: true, bottomPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, rightPadding: true, topPadding: true },\n                                        { flex: 50, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        }\n                    ],\n                    // 4\n                    [\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 50, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 30, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 70,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 100, fullWidth: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        }\n                    ],\n                    // 5\n                    [\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 50, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                            ]\n                                        },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 33, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 67,\n                                    fullHeight: true,\n                                    children: [\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                            ]\n                                        },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 100, fullWidth: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        }\n                    ],\n                    // 6\n                    [\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 33, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 33, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 67,\n                                    fullHeight: true,\n                                    children: [\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                            ]\n                                        },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        }\n                    ],\n                    // 7\n                    [\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 33, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullHeight: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        },\n                        {\n                            group: true,\n                            layout: 'row',\n                            flex: 100,\n                            fullHeight: true,\n                            children: [\n                                { flex: 25, fullWidth: true, rightPadding: true },\n                                {\n                                    group: true,\n                                    layout: 'column',\n                                    flex: 75,\n                                    fullHeight: true,\n                                    children: [\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                            ]\n                                        },\n                                        {\n                                            group: true,\n                                            layout: 'row',\n                                            flex: 50,\n                                            fullHeight: true,\n                                            children: [\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                                { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\n                                            ]\n                                        }\n                                    ]\n                                }\n                            ]\n                        }\n                    ],\n                    // 8\n                    [\n                        {\n                            group: true,\n                            layout: 'column',\n                            flex: 100,\n                            fullHeight: true,\n                            fullWidth: true,\n                            children: [\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullWidth: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\n                                    ]\n                                },\n                                {\n                                    group: true,\n                                    layout: 'row',\n                                    flex: 50,\n                                    fullWidth: true,\n                                    children: [\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\n                                    ]\n                                }\n                            ]\n                        }\n                    ]\n                ];\n\n\n            return {\n                // getColorClasses: getColorClasses,\n                // getAvatarColors: getAvatarColors, // todo to data_avatar\n                // getEntityTypes: getEntityTypes,\n                setErrorImageCSS: setErrorImageCSS,\n                setImageMarginCSS: setImageMarginCSS,\n                setIconMarginCSS: setIconMarginCSS,\n                // getAvatarUrl: getAvatarUrl,\n                getCollageSchemes: getCollageSchemes\n            };\n// // todo to data_avatar\n//             function getEntityTypes() {\n//                 return entityTypes;\n//             };\n// // todo to data_avatar\n//             function getColorClasses() {\n//                 return colorClasses;\n//             };\n// // todo to data_avatar\n//             function getAvatarColors() {\n//                 return colors;\n//             };\n\n            function getCollageSchemes() {\n                return collageSchemes;\n            };\n\n// todo to data_avatar\n            // function getAvatarUrl(partyId, partyName, id, type, noRedirect, noDefault) {\n            //     var\n            //         timestamp = Math.floor(new Date().getTime() / 1000) * 1000,\n            //         colorClassIndex = pipStrings.hashCode(id) % colors.length,\n            //         chr = null,\n            //         url = null, default_template = '',\n            //         serverUrl = pipRest.serverUrl();\n\n            //     noRedirect = noRedirect && noRedirect === true ? '&no_redirect=true' : '';\n            //     if ((type && id && partyId) || (partyId)) {\n            //         if (type && id && partyId) {\n            //             if (type == 'category') return;\n            //             if (!noDefault) default_template = 'default_template='\n            //             + type + '&bg=' + colors[colorClassIndex]\n            //             + '&fg=white&';\n            //             if (entityTypes[type] == 'goals' || entityTypes[type] == 'areas' ) {\n            //                 url = serverUrl + '/api/parties/' + partyId + '/' + entityTypes[type]\n            //                 + '/' + id + '/avatar?' + default_template + 'timestamp=' + timestamp\n            //                 + '&obj_id=' + id + noRedirect;\n            //             }\n            //         } else if (partyId && partyName) {\n            //             colorClassIndex = pipStrings.hashCode(partyId) % colors.length;\n            //             chr = (partyName[0] || '?').toUpperCase();\n            //             if (!noDefault) default_template = 'default_template=letter&bg=' + colors[colorClassIndex]\n            //             + '&fg=white&chr=' + chr + '&';\n            //             url = serverUrl + '/api/parties/' + partyId\n            //             + '/avatar?' + default_template + 'timestamp=' + timestamp + '&obj_id=' + partyId + noRedirect;\n            //         } else if (partyId && (!type && !id)) {\n            //             url = serverUrl + '/api/parties/' + partyId\n            //             + '/avatar?timestamp=' + timestamp + '&obj_id=' + partyId + noRedirect;\n            //         }\n            //     }\n\n            //     return url;\n            // };\n\n            function setErrorImageCSS(image, params) {\n                var cssParams = {\n                    'width': '',\n                    'margin-left': '',\n                    'height': '',\n                    'margin-top': ''\n                };\n\n                if (params) cssParams = _.assign(cssParams, params);\n\n                if (image)  image.css(cssParams);\n            };\n\n            function setImageMarginCSS($element, image, params) {\n                var\n                    containerWidth = $element.width ? $element.width() : $element.clientWidth, // || 80,\n                    //containerWidth = $element.clientWidth ? $element.clientWidth : $element.width, // || 80,\n                    //containerHeight = $element.clientHeight ? $element.clientHeight : $element.height, // || 80,\n                    containerHeight = $element.height ? $element.height() : $element.clientHeight, // || 80,\n                    imageWidth = image[0].naturalWidth || image.width,\n                    imageHeight = image[0].naturalHeight || image.height,\n                    margin = 0;\n                var cssParams = {};\n\n                if ((imageWidth / containerWidth) > (imageHeight / containerHeight)) {\n                    margin = -((imageWidth / imageHeight * containerHeight - containerWidth) / 2);\n                    cssParams['margin-left'] = '' + margin + 'px';\n                    cssParams['height'] = '' + containerHeight + 'px';//'100%';\n                    cssParams['width'] = '' + imageWidth * containerHeight/imageHeight + 'px';//'100%';\n                    cssParams['margin-top'] = '';\n                } else {\n                    margin = -((imageHeight / imageWidth * containerWidth - containerHeight) / 2);\n                    cssParams['margin-top'] = '' + margin + 'px';\n                    cssParams['height'] = '' + imageHeight * containerWidth/imageWidth + 'px';//'100%';\n                    cssParams['width'] = '' + containerWidth + 'px';//'100%';\n                    cssParams['margin-left'] = '';\n                }\n\n                if (params) cssParams = _.assign(cssParams, params);\n\n                image.css(cssParams);\n            };\n\n            function setIconMarginCSS(container, icon) {\n                var\n                    containerWidth = container.clientWidth ? container.clientWidth : container.width,\n                    containerHeight = container.clientHeight ? container.clientHeight : container.height,\n                    margin = 0,\n                    iconSize = containerWidth > containerHeight ? containerHeight : containerWidth;\n\n                var cssParams = {\n                    'width': '' + iconSize + 'px',\n                    'margin-left': '',\n                    'height': '' + iconSize + 'px',\n                    'margin-top': ''\n                };\n\n                if ((containerWidth) > (containerHeight)) {\n                    margin = ((containerWidth - containerHeight) / 2);\n                    cssParams['margin-left'] = '' + margin + 'px';\n                } else {\n                    margin = ((containerHeight - containerWidth) / 2);\n                    cssParams['margin-top'] = '' + margin + 'px';\n                }\n\n                icon.css(cssParams);\n            };\n\n        }]\n    );\n\n})();\n\n"]}