{"version":3,"sources":["pictures.js","pip-webui-pictures-html.js","avatar/avatar.js","add_image/add_image.js","avatar_edit/avatar_edit.js","camera_dialog/camera_dialog.js","collage/collage.js","gallery_search_dialog/gallery_search_dialog.js","picture/picture.js","picture_edit/picture_edit.js","picture_list_edit/picture_list_edit.js","picture_url_dialog/picture_url_dialog.js","utilities/picture_paste.js","utilities/picture_utils.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1XA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACvVA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9TA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9KA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3UA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjdA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC3FA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"pip-webui-pictures.js","sourcesContent":["/**\r\n * @file Registration of pictures WebUI controls\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    angular.module('pipPictures', [        \r\n        'pipAddImage',\r\n        'pipAvatar',\r\n        'pipAvatarEdit',\r\n        'pipPicture',\r\n        'pipPictureEdit',\r\n        'pipCollage',\r\n        'pipPictureListEdit',        \r\n        'pipCameraDialog',        \r\n        'pipPictureUrlDialog'\r\n    ]);\r\n    \r\n})();\r\n\r\n\r\n","(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('add_image/add_image.html',\n    ' <!--\\n' +\n    '@file Add image directive content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2015\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-menu>\\n' +\n    '        <ng-transclude class=\"pip-add-image-open-button\" ng-click=\"ngDisabled() ? \\'\\' : $mdOpenMenu()\"></ng-transclude>\\n' +\n    '        <md-menu-content width=\"4\">\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" accept=\"image/*\"\\n' +\n    '                           ng-keydown=\"onKeyDown($event)\" ng-multiple=\"isMulti()\"\\n' +\n    '                           ng-file-select ng-file-change=\"onFileChange($files)\" ng-click=\"hideMenu()\" ng-file-drop>\\n' +\n    '\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:folder\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-folder text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'FILE\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onWebLinkClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:weblink\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-weblink text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'WEB_LINK\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onCameraClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:camera\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-camera text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'CAMERA\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '            <md-menu-item>\\n' +\n    '                <md-button class=\"layout-row layout-align-start-center\" ng-click=\"onGalleryClick()\">\\n' +\n    '                    <md-icon class=\"text-headline text-grey rm24-flex\" md-svg-icon=\"icons:images\"></md-icon>\\n' +\n    '                    <!--<span class=\"icon-images text-headline text-grey tp8 rm24-flex\"></span>-->\\n' +\n    '                    <span class=\"text-grey\">{{::\\'IMAGE_GALLERY\\' | translate}}</span>\\n' +\n    '                </md-button>\\n' +\n    '            </md-menu-item>\\n' +\n    '        </md-menu-content>\\n' +\n    '    </md-menu>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('camera_dialog/camera_dialog.html',\n    '<!--\\n' +\n    '@file Camera dialog content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2015\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-dialog class=\"pip-dialog pip-picture-dialog pip-camera-dialog layout-column\" md-theme=\"{{theme}}\"\\n' +\n    '           ng-show=\"browser != \\'android\\'\"\\n' +\n    '        ng-class=\"{\\'pip-android-dialog\\': browser == \\'android\\' || !browser}\">\\n' +\n    '    <div class=\"pip-header\" class=\"layout-row layout-align-start-center\">\\n' +\n    '        <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button\"\\n' +\n    '                    aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '            <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '        </md-button>\\n' +\n    '        <h3 class=\"m0 text-title\">{{ ::\\'TAKE_PICTURE\\' | translate }}</h3>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '    <div class=\"pip-body\">\\n' +\n    '        <div class=\"camera-stream\" ng-hide=\"webCamError || browser == \\'android\\'\"></div>\\n' +\n    '        <div class=\"camera-error\"\\n' +\n    '             ng-show=\"webCamError || browser == \\'android\\'\"\\n' +\n    '             class=\"layout-row layout-align-center-center\">\\n' +\n    '            <span>{{ ::\\'WEB_CAM_ERROR\\' | translate }}</span>\\n' +\n    '        </div>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button ng-click=\"onResetPicture()\"\\n' +\n    '                       ng-hide=\"!$freeze || webCamError\"\\n' +\n    '                       class=\"md-icon-button\"\\n' +\n    '                       ng-disabled=\"transaction.busy()\"\\n' +\n    '                       aria-label=\"{{ ::\\'REMOVE_PICTURE\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:refresh\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '        </div>\\n' +\n    '        <div class=\"flex\"></div>\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button ng-click=\"onTakePictureClick()\"\\n' +\n    '                       ng-hide=\"webCamError\"\\n' +\n    '                       class=\"md-icon-button\"\\n' +\n    '                       aria-label=\"{{ ::\\'TAKE_PICTURE\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey icon-button\" md-svg-icon=\"icons:{{$freeze ? \\'check\\' : \\'camera\\'}}\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '\\n' +\n    '        </div>\\n' +\n    '        <div class=\"flex\"></div>\\n' +\n    '        <div class=\"w48\">\\n' +\n    '            <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button\"\\n' +\n    '                        aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '        </div>\\n' +\n    '    </div>\\n' +\n    '\\n' +\n    '</md-dialog>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('gallery_search_dialog/gallery_search_dialog.html',\n    '<md-dialog class=\"pip-dialog pip-gallery-search-dialog pip-picture-dialog layout-column\"\\n' +\n    '           md-theme=\"{{theme}}\">\\n' +\n    '    <md-progress-linear\\n' +\n    '            ng-show=\"transaction.busy()\" md-mode=\"indeterminate\">\\n' +\n    '    </md-progress-linear>\\n' +\n    '\\n' +\n    '    <md-dialog-content class=\"pip-body lp0 rp0 tp0 pip-scroll flex layout-row\">\\n' +\n    '        <div class=\"layout-column layout-align-start-start flex\">\\n' +\n    '            <div class=\"pip-header w-stretch layout-column layout-align-start-start\">\\n' +\n    '                <h3 class=\"w-stretch text-title m0 bp8\">\\n' +\n    '                    <md-button  class=\"md-icon-button m0\"\\n' +\n    '                                ng-click=\"onCancelClick()\"\\n' +\n    '                                aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                        <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '                    </md-button>\\n' +\n    '                    {{::\\'IMAGE_GALLERY\\' | translate}}\\n' +\n    '                </h3>\\n' +\n    '                <div class=\"w-stretch divider-bottom layout-row layout-start-center\">\\n' +\n    '                    <input class=\"no-divider rm8 text-subhead1 flex\"\\n' +\n    '                           ng-disabled=\"transaction.busy()\"\\n' +\n    '                           ng-model=\"$search\" ng-keypress=\"onKeyPress($event)\"\\n' +\n    '                           placeholder=\"{{::\\'SEARCH_PICTURES\\' | translate}}\"\\n' +\n    '                           type=\"text\" tabindex=\"1\">\\n' +\n    '\\n' +\n    '                    <md-button class=\"md-icon-button md-icon-button-square p0 pip-search-button md-primary\"\\n' +\n    '                               ng-click=\"onSearchClick()\"\\n' +\n    '                               ng-hide=\"optionDefault\"\\n' +\n    '                               tabindex=\"-1\" aria-label=\"SEARCH\">\\n' +\n    '                        <md-icon class=\"text-opacity md-primary\" md-svg-icon=\"icons:search-square \"></md-icon>\\n' +\n    '                    </md-button>\\n' +\n    '                </div>\\n' +\n    '            </div>\\n' +\n    '            <div class=\"pip-content flex\"\\n' +\n    '                 ng-show=\"$images.length > 0\">\\n' +\n    '                <div class=\"pip-image-container\"\\n' +\n    '                     ng-click=\"onImageClick(image)\"\\n' +\n    '                     ng-repeat=\"image in $images track by $index\"\\n' +\n    '                     ng-class=\"{\\'checked\\': image.checked}\"\\n' +\n    '                     tabindex=\"{{ $index + 2 }}\">\\n' +\n    '\\n' +\n    '                    <pip-picture pip-src=\"image.thumbnail\"\\n' +\n    '                                 pip-default-icon=\"icon-images\"\\n' +\n    '                                 pip-rebind=\"true\">\\n' +\n    '                    </pip-picture>\\n' +\n    '                    <div class=\"pip-checked-cover\"></div>\\n' +\n    '                    <div class=\"pip-checkbox-backdrop\">\\n' +\n    '                        <md-checkbox md-no-ink\\n' +\n    '                                     ng-model=\"image.checked\"\\n' +\n    '                                     ng-click=\"image.checked = !image.checked\"\\n' +\n    '                                     aria-label=\"CHECKED\">\\n' +\n    '                        </md-checkbox>\\n' +\n    '                    </div>\\n' +\n    '                </div>\\n' +\n    '            </div>\\n' +\n    '            <div class=\"pip-no-images w-stretch layout-column layout-align-center-center flex\"\\n' +\n    '                 ng-show=\"$images.length == 0\">\\n' +\n    '                <img src=\"images/add_from_image_library.svg\" width=\"200\" height=\"200\">\\n' +\n    '                <p class=\"text-secondary opacity-secondary text-center\">{{\\'IMAGE_START_SEARCH\\' | translate}}</p>\\n' +\n    '                <!--<md-icon class=\"text-grey\" md-svg-icon=\"icons:images\"></md-icon> -->\\n' +\n    '            </div>\\n' +\n    '        </div>\\n' +\n    '    </md-dialog-content>\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <md-button  ng-click=\"onCancelClick()\"\\n' +\n    '                    ng-hide=\"transaction.busy()\"\\n' +\n    '                    aria-label=\"{{ ::\\'CANCEL\\' | translate }}\"\\n' +\n    '                    tabindex=\"{{ $images.length + 3 }}\">\\n' +\n    '                <span class=\"text-grey\">\\n' +\n    '                    {{ ::\\'CANCEL\\' | translate }}\\n' +\n    '                </span>\\n' +\n    '        </md-button>\\n' +\n    '        <md-button ng-if=\"transaction.busy()\" ng-click=\"onStopSearchClick()\" class=\"md-raised md-warn m0\"\\n' +\n    '                   tabindex=\"5\" aria-label=\"ABORT\"\\n' +\n    '                   pip-test=\"button-cancel\">\\n' +\n    '            {{::\\'CANCEL\\' | translate}}\\n' +\n    '        </md-button>\\n' +\n    '        <md-button  class=\"md-accent\"\\n' +\n    '                    ng-hide=\"transaction.busy()\"\\n' +\n    '                    ng-disabled=\"addButtonDisabled()\"\\n' +\n    '                    ng-click=\"onAddClick()\"\\n' +\n    '                    aria-label=\"{{ ::\\'ADD\\' | translate }}\"\\n' +\n    '                    tabindex=\"{{ $images.length + 4 }}\">\\n' +\n    '\\n' +\n    '            {{ ::\\'ADD\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '    </div>\\n' +\n    '</md-dialog>');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_edit/picture_edit.html',\n    '<div class=\"pip-picture-upload pip-picture-drop md-focused\"\\n' +\n    '\t ng-keydown=\"onKeyDown($event)\"\\n' +\n    ' \t tabindex=\"{{ ngDisabled() || control.uploading ? -1 : 0 }}\"\\n' +\n    '\t pip-changed=\"readItemLocally(url, file)\"\\n' +\n    '\t ng-disabled=\"ngDisabled()\"\\n' +\n    '\t pip-multi=\"false\"\\n' +\n    '\t ng-focus=\"onFocus()\"\\n' +\n    '\t ng-blur=\"onBlur()\"\\n' +\n    '\t pip-add-image>\\n' +\n    '\\n' +\n    '\t<div class=\"pip-default-icon\" ng-show=\"empty()\">\\n' +\n    '\t\t<md-icon  class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t</div>\\n' +\n    '\t<div class=\"pip-default-text\" ng-show=\"empty()\">\\n' +\n    '\t\t<span>{{text | translate}}</span>\\n' +\n    '\t</div>\\n' +\n    '\\n' +\n    '\t<img class=\"pip-picture-image\"\\n' +\n    '\t\t ng-src=\"{{control.url}}\"\\n' +\n    '\t\t ng-show=\"!empty()\"\\n' +\n    '\t\t ng-class=\"{ \\'pip-image-new\\': isUpdated(), \\'cursor-default\\' : ngDisabled() || control.uploading }\"\\n' +\n    ' \t\t ui-event=\"{ error: \\'onImageError($event)\\', load: \\'onImageLoad($event)\\' }\">\\n' +\n    '\\n' +\n    '\t<md-button class=\"md-icon-button\"\\n' +\n    '\t\t\t   ng-click=\"onDeleteClick($event)\"\\n' +\n    '\t\t\t   tabindex=\"-1\" aria-label=\"delete\"\\n' +\n    '\t\t\t   ng-hide=\"empty() || ngDisabled()\"\\n' +\n    '\t\t\t   ng-disabled=\"ngDisabled() || control.uploading\">\\n' +\n    '\t\t<md-icon  md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '\t</md-button>\\n' +\n    '\\n' +\n    '\t<md-progress-linear ng-show=\"control.uploading\"\\n' +\n    '\t\t\t\t\t\tng-value=\"control.progress\">\\n' +\n    '\t</md-progress-linear>\\n' +\n    '</div>\\n' +\n    '');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_list_edit/picture_list_edit.html',\n    '<div pip-focused>\\n' +\n    '\t<div class=\"pip-picture-upload pointer pip-focusable\"\\n' +\n    '\t\t ng-class=\"{\\'pip-picture-error\\': item.error}\"\\n' +\n    '\t\t ng-keydown=\"onKeyDown($event, item)\"\\n' +\n    '\t\t tabindex=\"{{ ngDisabled() ? -1 : 0 }}\"\\n' +\n    '\t\t ng-repeat=\"item in control.items | filter: filterItem\">\\n' +\n    '\\n' +\n    '\t\t<div class=\"pip-default-icon\" ng-hide=\"item.loaded || item.error\">\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<div class=\"pip-default-text\" ng-show=\"item.error\">\\n' +\n    '\t\t\t<!--span style=\"color: red\">{{ \\'ERROR_IMAGE_PRELOADING\\' | translate}}</span-->\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" md-svg-icon=\"icons:warn-circle\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<img ng-src=\"{{::item.url}}\"\\n' +\n    '\t\t\t pip-cancel-drag=\"true\"\\n' +\n    '\t\t\t ng-hide=\"item.error\"\\n' +\n    '\t\t\t ng-class=\"{ \\'pip-image-new\\': item.state == \\'added\\' }\"\\n' +\n    '\t\t\t ui-event=\"{ error: \\'onImageError($event, item)\\', load: \\'onImageLoad($event, item)\\' }\">\\n' +\n    '\\n' +\n    '\t\t<md-button ng-click=\"onDeleteClick(item)\"\\n' +\n    '\t\t\t\t   ng-disabled=\"ngDisabled() || control.uploading\" tabindex=\"-1\"\\n' +\n    '\t\t\t\t   aria-label=\"delete\"\\n' +\n    '\t\t\t\t   class=\"md-icon-button\">\\n' +\n    '\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" md-svg-icon=\"icons:cross\"></md-icon>\\n' +\n    '\t\t</md-button>\\n' +\n    '\t\t<md-progress-linear md-mode=\"indeterminate\" ng-show=\"item.uploading\" value=\"{{ item.progress }}\">\\n' +\n    '\t\t</md-progress-linear>\\n' +\n    '\t</div>\\n' +\n    '\\n' +\n    '\t<button class=\"pip-picture-upload pip-picture-drop pip-focusable\"\\n' +\n    '\t\t\tpip-add-image\\n' +\n    '\t\t    ng-focus=\"onFocus()\"\\n' +\n    '\t        ng-blur=\"onBlur()\"\\n' +\n    '\t\t\tpip-changed=\"readItemLocally(url, file)\"\\n' +\n    '\t\t\tng-disabled=\"ngDisabled() || control.uploading\">\\n' +\n    '\\n' +\n    '\t\t<div class=\"pip-default-icon\">\\n' +\n    '\t\t\t<md-icon  pip-cancel-drag=\"true\" class=\"pip-picture-icon\" md-svg-icon=\"icons:{{icon}}\"></md-icon>\\n' +\n    '\t\t</div>\\n' +\n    '\t\t<div class=\"pip-default-text\">\\n' +\n    '\t\t\t<span>{{text | translate}}</span>\\n' +\n    '\t\t</div>\\n' +\n    '\t</button>\\n' +\n    '\t<div class=\"clearfix\"></div>\\n' +\n    '</div>\\n' +\n    '');\n}]);\n})();\n\n(function(module) {\ntry {\n  module = angular.module('pipPictures.Templates');\n} catch (e) {\n  module = angular.module('pipPictures.Templates', []);\n}\nmodule.run(['$templateCache', function($templateCache) {\n  $templateCache.put('picture_url_dialog/picture_url_dialog.html',\n    '<!--\\n' +\n    '@file Picture URL dialog content\\n' +\n    '@copyright Digital Living Software Corp. 2014-2016\\n' +\n    '-->\\n' +\n    '\\n' +\n    '<md-dialog class=\"pip-dialog pip-picture-url-dialog pip-picture-dialog layout-column\"\\n' +\n    '           md-theme=\"{{theme}}\">\\n' +\n    '\\n' +\n    '    <md-dialog-content class=\"pip-body lp0 rp0 tp0 pip-scroll\">\\n' +\n    '        <div class=\"pip-header bm16 layout-row layout-align-start-center\">\\n' +\n    '            <md-button  ng-click=\"onCancelClick()\" class=\"md-icon-button lm0\"\\n' +\n    '                        aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:arrow-left\"></md-icon>\\n' +\n    '            </md-button>\\n' +\n    '            <h3 class=\"text-title m0\">\\n' +\n    '                {{ ::\\'PICTURE_FROM_WEBLINK\\' | translate}}\\n' +\n    '            </h3>\\n' +\n    '        </div>\\n' +\n    '\\n' +\n    '        <div class=\"pip-content\">\\n' +\n    '            <md-input-container md-no-float class=\"w-stretch text-subhead1\">\\n' +\n    '                <input type=\"text\" ng-model=\"url\" ng-change=\"checkUrl()\" placeholder=\"{{:: \\'LINK_PICTURE\\' | translate}}\"/>\\n' +\n    '            </md-input-container>\\n' +\n    '\\n' +\n    '            <div class=\"w-stretch layout-row layout-align-center-center\"\\n' +\n    '                 ng-hide=\"invalid\">\\n' +\n    '                <img id=\"url_image\"/>\\n' +\n    '            </div>\\n' +\n    '\\n' +\n    '            <div class=\"pip-no-images layout-row layout-align-center-center\" ng-show=\"invalid\">\\n' +\n    '                <md-icon class=\"text-grey\" md-svg-icon=\"icons:images\"></md-icon>\\n' +\n    '            </div>\\n' +\n    '\\n' +\n    '        </div>\\n' +\n    '    </md-dialog-content>\\n' +\n    '    <div class=\"pip-footer\">\\n' +\n    '        <md-button ng-click=\"onCancelClick()\" aria-label=\"{{ ::\\'CANCEL\\' | translate }}\">\\n' +\n    '            {{ ::\\'CANCEL\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '\\n' +\n    '        <md-button class=\"md-accent\" ng-click=\"onAddClick()\" ng-disabled=\"invalid\"\\n' +\n    '                   aria-label=\"{{ ::\\'ADD\\' | translate }}\">\\n' +\n    '            {{ ::\\'ADD\\' | translate }}\\n' +\n    '        </md-button>\\n' +\n    '    </div>\\n' +\n    '</md-dialog>');\n}]);\n})();\n","/**\r\n * @file Avatar control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Improve samples in sampler app\r\n * - Replace placeholder with default image generated on server\r\n * - Fix resizing problem\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipAvatar\", ['pipCore', 'pipRest', 'pipImageUtils']);\r\n\r\n    thisModule.directive('pipAvatar',\r\n        function () {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: false,\r\n                template: '<md-icon></md-icon><img/>'\r\n                + '<div><md-icon class=\"default_icon\" id=\"icon-film\" md-svg-icon=\"icons:film\"></md-icon>'\r\n                + '<md-icon class=\"default_icon\" id=\"icon-task\" md-svg-icon=\"icons:task\"></md-icon>'\r\n                + '<md-icon class=\"default_icon\" id=\"icon-folder\" md-svg-icon=\"icons:folder\"></md-icon></div>',\r\n                controller: 'pipAvatarController'\r\n            }\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipAvatarController',\r\n        ['$scope', '$rootScope', '$element', '$attrs', '$parse', 'pipUtils', 'pipStrings', 'pipRest', '$http', 'pipImageUtils', function ($scope, $rootScope, $element, $attrs, $parse, pipUtils, pipStrings, pipRest, $http, pipImageUtils) {\r\n            var\r\n                $svg = $element.children('md-icon'),\r\n                $image = $element.children('img'),\r\n                $defaultBlock = $element.children('div'),\r\n                $iconFilm = $element.find('#icon-film'),\r\n                $iconTask = $element.find('#icon-task'),\r\n                $iconFolder = $element.find('#icon-folder'),\r\n                image = null,\r\n\r\n                partyIdGetter = $parse($attrs.pipPartyId),\r\n                partyNameGetter = $parse($attrs.pipPartyName),\r\n                typeGetter = $parse($attrs.pipEntityType),\r\n                idGetter = $parse($attrs.pipId),\r\n                urlGetter = $parse($attrs.pipImageUrl),\r\n\r\n                colors = pipImageUtils.getAvatarColors(),\r\n                colorClasses = pipImageUtils.getColorClasses(),\r\n                entityTypes = pipImageUtils.getEntityTypes();\r\n\r\n            // When image is loaded resize/reposition it\r\n            $image.load(function ($event) {\r\n                image = $($event.target);\r\n                pipImageUtils.setImageMarginCSS($element, image);\r\n            });\r\n\r\n            // Add class\r\n            $element.addClass('pip-avatar flex-fixed');\r\n\r\n            if ($attrs.ngClass) {\r\n                $scope.$watch($attrs.ngClass, function () {\r\n                    setTimeout(function () {\r\n                        pipImageUtils.setImageMarginCSS($element, image);\r\n                    }, 50);\r\n                });\r\n            }\r\n\r\n            // Optimization to avoid binding\r\n            bindControl();\r\n\r\n            if (pipUtils.toBoolean($attrs.pipRebindAvatar)) {\r\n                $rootScope.$on('pipPartyAvatarUpdated', refreshAvatar);\r\n            }\r\n\r\n            // Also optimization to avoid watch if it is unnecessary\r\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\r\n                $scope.$watch(partyIdGetter, function (newValue, oldValue) {\r\n                    if (oldValue !== newValue)\r\n                        bindControl();\r\n                });\r\n\r\n                $scope.$watch(idGetter, function (newValue, oldValue) {\r\n                    if (oldValue !== newValue)\r\n                        bindControl();\r\n                });\r\n\r\n                $scope.$watch(urlGetter, function (newValue, oldValue) {\r\n                    if (oldValue !== newValue)\r\n                        bindControl();\r\n                });\r\n            }\r\n\r\n            return;\r\n\r\n            function refreshAvatar() {\r\n                $iconTask.css('display', 'none');\r\n                $iconFilm.css('display', 'none');\r\n                $iconFolder.css('display', 'none');\r\n                $defaultBlock.css('display', 'none');\r\n                $image.attr('src', '');\r\n                $svg.css('display', 'none');\r\n                $image.css('display', 'inline-block');\r\n                bindControl();\r\n            };\r\n\r\n            function bindControl() {\r\n                var\r\n                    partyName = partyNameGetter($scope),\r\n                    partyId = partyIdGetter($scope),\r\n                    id = idGetter($scope),\r\n                    type = typeGetter($scope),\r\n                    transUrl = urlGetter($scope);\r\n\r\n                $iconTask.css('display', 'none');\r\n                $iconFilm.css('display', 'none');\r\n                $iconFolder.css('display', 'none');\r\n                $defaultBlock.css('display', 'none');\r\n\r\n                // Timestamp to avoid caching images for too long\r\n                var url = transUrl || pipImageUtils.getAvatarUrl(partyId, partyName, id, type, false, false);\r\n\r\n                if ((type && id && partyId) || (partyId && partyName) || transUrl) {\r\n                    if (type && id && partyId) {\r\n                        if (type == 'category') return;\r\n\r\n                        if (entityTypes[type] == 'goals' || entityTypes[type] == 'areas' ) {\r\n                            $image.attr('src', url);\r\n                            $svg.css('display', 'none');\r\n                            $image.css('display', 'inline-block');\r\n                        } else {\r\n                            $defaultBlock.css('display', 'block');\r\n                            var colorClassIndex = pipStrings.hashCode(id) % colors.length;\r\n                            $element.addClass(colorClasses[colorClassIndex]);\r\n                            switch(type) {\r\n                                case 'vision':\r\n                                    $svg.css('display', 'none');\r\n                                    $iconFilm.css('display', 'inline-block');\r\n                                    $iconTask.css('display', 'none');\r\n                                    $iconFolder.css('display', 'none');\r\n                                    $image.css('display', 'none');\r\n                                    break;\r\n                                case 'event':\r\n                                    $svg.css('display', 'none');\r\n                                    $iconTask.css('display', 'inline-block');\r\n                                    $iconFilm.css('display', 'none');\r\n                                    $iconFolder.css('display', 'none');\r\n                                    $image.css('display', 'none');\r\n                                    break;\r\n                                case 'note':\r\n                                    $svg.css('display', 'none');\r\n                                    $iconFolder.css('display', 'inline-block');\r\n                                    $iconTask.css('display', 'none');\r\n                                    $iconFilm.css('display', 'none');\r\n                                    $image.css('display', 'none');\r\n                                    break;\r\n                            }\r\n                        }\r\n                    } else {\r\n                        $image.attr('src', url);\r\n                        $svg.css('display', 'none');\r\n                        $image.css('display', 'inline-block');\r\n                    }\r\n                }\r\n            };\r\n\r\n        }]\r\n    );\r\n\r\n})();\r\n\r\n","/**\r\n * @file Add image control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipAddImage\", ['pipCameraDialog', 'pipPictureUrlDialog', 'pipGallerySearchDialog', 'pipCore']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'FILE' : 'Upload pictures',\r\n            'WEB_LINK' : 'Use web link',\r\n            'CAMERA' : 'Take photo',\r\n            'IMAGE_GALLERY': 'Use image library',\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'FILE' : 'Загрузить картинку',\r\n            'WEB_LINK' : 'Вставить веб ссылка',\r\n            'CAMERA' : 'Использовать камеру',\r\n            'IMAGE_GALLERY': 'Открыть галерею изображений'\r\n        });\r\n    }]);\r\n\r\n    thisModule.directive('pipAddImage', \r\n        function() {\r\n            return {\r\n                restrict: 'AC',\r\n                scope: {\r\n                    $images: '=pipImages',\r\n                    onChange: '&pipChanged',\r\n                    multi: '&pipMulti',\r\n                    ngDisabled: '&'\r\n                },\r\n                transclude: true,\r\n                templateUrl: 'add_image/add_image.html',\r\n                controller: 'pipAddImageController'\r\n            }\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipAddImageController',\r\n        ['$scope', '$element', '$mdMenu', '$timeout', 'pipCameraDialog', 'pipPictureUrlDialog', 'pipGallerySearchDialog', 'pipUtils', function ($scope, $element, $mdMenu, $timeout, pipCameraDialog, pipPictureUrlDialog, pipGallerySearchDialog, pipUtils) {\r\n\r\n            $scope.hideMenu = hideMenu;\r\n            $scope.onFileChange = onFileChange;\r\n            $scope.onWebLinkClick = onWebLinkClick;\r\n            $scope.onCameraClick = onCameraClick;\r\n            $scope.onGalleryClick = onGalleryClick;\r\n            $scope.isMulti = isMulti;\r\n\r\n            $element.click(function () {\r\n                if (!$scope.ngDisabled()) openMenu();\r\n            });\r\n\r\n            return;\r\n\r\n            function openMenu() {\r\n                $($element).find('.pip-add-image-open-button').scope().$mdOpenMenu();\r\n            }\r\n\r\n            function isMulti() {\r\n                if ($scope.multi() !== undefined)\r\n                    return  pipUtils.toBoolean($scope.multi());\r\n                else return true;\r\n            }\r\n\r\n            function hideMenu () {\r\n                $mdMenu.hide();\r\n            }\r\n\r\n            function dataURItoBlob(dataURI) {\r\n                var byteString;\r\n                \r\n                if (dataURI.split(',')[0].indexOf('base64') >= 0)\r\n                    byteString = atob(dataURI.split(',')[1]);\r\n                else\r\n                    byteString = unescape(dataURI.split(',')[1]);\r\n\r\n                var mimeString = dataURI.split(',')[0].split(':')[1].split(';')[0];\r\n\r\n                var ia = new Uint8Array(byteString.length);\r\n                for (var i = 0; i < byteString.length; i++) {\r\n                    ia[i] = byteString.charCodeAt(i);\r\n                }\r\n\r\n                return new Blob([ia], {type:mimeString});\r\n            }\r\n\r\n            function addImages(images) {\r\n\r\n                if (images === undefined) return;\r\n\r\n                if (Array.isArray(images)) {\r\n                    images.forEach(function (img) {\r\n                        if ($scope.onChange)\r\n                            $scope.onChange({url: img.url, file: img.file});\r\n                    });\r\n                } else {\r\n                    if ($scope.onChange)\r\n                        $scope.onChange({url: images.url, file: images.file});\r\n                }\r\n\r\n                if ($scope.$images === undefined || !Array.isArray($scope.$images))\r\n                    return;\r\n\r\n                if (Array.isArray(images)) {\r\n                    images.forEach(function (img) {\r\n                        $scope.$images.push(img.url);\r\n                    });\r\n                } else {\r\n                    $scope.$images.push(images.url);\r\n                }\r\n            }\r\n\r\n            // Process user actions\r\n\r\n            function onFileChange ($files) {\r\n                if ($files == null || $files.length == 0)\r\n                    return;\r\n\r\n                $files.forEach(function (file) {\r\n                    if (file.type.indexOf('image') > -1) {\r\n                        $timeout(function() {\r\n                            var fileReader = new FileReader();\r\n                            fileReader.readAsDataURL(file);\r\n                            fileReader.onload = function(e) {\r\n                                $timeout(function() {\r\n                                    addImages({url: e.target.result, file: file});\r\n                                });\r\n                            }\r\n                        });\r\n                    }\r\n                });\r\n\r\n            }\r\n\r\n            function onWebLinkClick () {\r\n                pipPictureUrlDialog.show(function (result) {\r\n                    var blob = null;\r\n                    if (result.substring(0, 10) == 'data:image') {\r\n                        blob = dataURItoBlob(result);\r\n                        blob.name = result.slice(result.lastIndexOf('/') + 1, result.length).split('?')[0];\r\n                    }\r\n                    addImages({url: result, file: blob});\r\n                });\r\n            }\r\n\r\n            function onCameraClick () {\r\n                pipCameraDialog.show(function (result) {\r\n                  var blob = dataURItoBlob(result);\r\n\r\n                    blob.name = 'camera';\r\n                    addImages({url: result, file: blob});\r\n                });\r\n            }\r\n\r\n            function onGalleryClick () {\r\n                pipGallerySearchDialog.show(function (result) {\r\n                    var imgs = [];\r\n                    result.forEach(function (url) {\r\n                        imgs.push({url: url, file: null});\r\n                    });\r\n                    addImages(imgs);\r\n                }, $scope.isMulti());\r\n            }\r\n    }]);\r\n\r\n})();\r\n\r\n\r\n","/**\r\n * @file Avatar control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Improve samples in sampler app\r\n * - Replace placeholder with default image generated on server\r\n * - Generate file url based on entity type, do not set it as full url via pipSrc\r\n */\r\n \r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipAvatarEdit\", ['ui.event', 'angularFileUpload', 'pipPicturePaste', 'pipRest',\r\n        'pipImageUtils', 'pipPictures.Templates']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'PICTURE_EDIT_TEXT': 'Click here to upload a picture'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'PICTURE_EDIT_TEXT': 'Нажмите сюда для загрузки картинки'\r\n        });\r\n    }]);\r\n\r\n    thisModule.directive('pipAvatarEdit',\r\n        function() {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: {\r\n                    ngDisabled: '&',\r\n                    pipPartyId: '&',\r\n                    pipEntityType: '&',\r\n                    pipId: '&',\r\n                    pipCreated: '&',\r\n                    pipChanged: '&',\r\n                    pipReset: '&'\r\n                },\r\n                templateUrl: 'picture_edit/picture_edit.html',\r\n                controller: 'pipAvatarEditController' \r\n            };\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipAvatarEditController',\r\n        ['$scope', '$element', '$attrs', '$http', '$upload', '$rootScope', 'pipPicturePaste', 'pipRest', 'pipImageUtils', function($scope, $element, $attrs, $http, $upload, $rootScope, pipPicturePaste, pipRest, pipImageUtils) {\r\n            var \r\n                $control = $element.children('.pip-picture-upload'),\r\n                $input = $control.children('input[type=file]'),\r\n                entityTypes = pipImageUtils.getEntityTypes(),\r\n                serverUrl = pipRest.serverUrl();\r\n            \r\n            $scope.text = $attrs.pipDefaultText || 'PICTURE_EDIT_TEXT'; \r\n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\r\n            $scope.control = {\r\n                url: '',\r\n                progress: 0,\r\n                uploaded: false,\r\n                uploading: false,\r\n                loaded: false,\r\n\r\n                file: null,\r\n                state: 'original'\r\n            };\r\n\r\n            $scope.control.reset = reset;\r\n            $scope.control.save = save;\r\n            $scope.empty = empty;\r\n            $scope.isUpdated = isUpdated;\r\n            $scope.readItemLocally = readItemLocally;\r\n            $scope.onDeleteClick = onDeleteClick;\r\n            $scope.onKeyDown = onKeyDown;\r\n            $scope.onImageError = onImageError;\r\n            $scope.onImageLoad = onImageLoad;\r\n            $scope.onChange = onChange;\r\n\r\n            // Watching for changes\r\n            $scope.$watch($scope.pipId, function(newValue) {\r\n                if ($scope.pipReset() !== false)\r\n                    $scope.control.reset();\r\n            });\r\n\r\n            $scope.$watch($scope.pipPartyId, function(newValue) {\r\n                if ($scope.pipReset() !== false)\r\n                    $scope.control.reset();\r\n            });\r\n\r\n            $scope.$watch($scope.ngDisabled, function(newValue) {\r\n                $input.attr('disabled', $scope.control.disabled);\r\n            });\r\n\r\n            // Add paste listener\r\n            $element.children('.pip-picture-upload').focus(function () {\r\n                pipPicturePaste.addPasteListener(function (item) {\r\n                    $scope.readItemLocally(item.url, item.file);\r\n                });\r\n            });\r\n\r\n            $element.children('.pip-picture-upload').blur(function () {\r\n                pipPicturePaste.removePasteListener();\r\n            });\r\n\r\n            // Add class\r\n            $element.addClass('pip-picture-edit');\r\n\r\n            // Execute callback\r\n            if ($scope.pipCreated) {\r\n                $scope.pipCreated({\r\n                    $event: { sender: $scope.control },\r\n                    $control: $scope.control\r\n                });\r\n            }\r\n\r\n            // Initialize control\r\n            $scope.control.reset();\r\n\r\n            return;\r\n\r\n            // --------------------------------\r\n\r\n            // Utility functions\r\n\r\n            function reset(afterDeleting) {\r\n                $scope.control.progress = 0;\r\n                $scope.control.uploading = false;\r\n                $scope.control.uploaded = false;\r\n\r\n                $scope.control.file = null;\r\n                $scope.control.state = 'original';\r\n                $scope.control.url = '';\r\n\r\n                if (!afterDeleting) {\r\n                    var url = pipImageUtils.getAvatarUrl($scope.pipPartyId(), '',\r\n                        $scope.pipId(), $scope.pipEntityType(), false, true);\r\n\r\n                    if (!url) return;\r\n\r\n                    //pipImageUtils.addHttpHeaders();\r\n                    $scope.control.progress = 0;\r\n\r\n                    $scope.control.url = url;\r\n                    $scope.control.uploaded = $scope.control.url != '';\r\n                    $scope.onChange();\r\n\r\n                } else $scope.onChange();\r\n            };\r\n\r\n            function generateUrl() {\r\n                if ($scope.pipEntityType() && $scope.pipId() && $scope.pipPartyId()) {\r\n                    return serverUrl + '/api/parties/' + $scope.pipPartyId() + '/'\r\n                        + entityTypes[$scope.pipEntityType()] + '/' + $scope.pipId() + '/avatar';\r\n                } else {\r\n                    if ($scope.pipPartyId() && !$scope.pipEntityType()) {\r\n                        if ($attrs.pipEntityType || $attrs.pipId)\r\n                            return '';\r\n                        return serverUrl + '/api/parties/' + $scope.pipPartyId()\r\n                            + '/avatar';\r\n                    }\r\n                }\r\n\r\n                return '';\r\n            }\r\n\r\n            function saveItemUrl() {\r\n                var url = $scope.control.url,\r\n                    FILE_URL = generateUrl();\r\n                var name = url.slice(url.lastIndexOf('/') + 1, url.length).split('?')[0];\r\n\r\n                return FILE_URL + '?name=' + name + '&url=' + url\r\n            };\r\n\r\n            function savePicture(successCallback, errorCallback) {\r\n                var\r\n                    control = $scope.control,\r\n                    file = control.file;\r\n\r\n                if ($scope.control.file !== null) {\r\n                    var \r\n                        fileReader = new FileReader(),\r\n                        FILE_URL = generateUrl();\r\n                        \r\n                    fileReader.onload = function (e) {\r\n                        control.uploading = true;\r\n                        var upload = $upload.http({\r\n                                url: FILE_URL + '?name=' + file.name,\r\n                                headers: { 'Content-Type': file.type },\r\n                                data: e.target.result\r\n                            })\r\n                            .then(\r\n                            function (response) {\r\n                                control.reset();\r\n                                if (successCallback) successCallback(response);\r\n                            },\r\n                            function (error) {\r\n                                control.uploading = false;\r\n                                control.upload = false;\r\n                                control.progress = 0;\r\n\r\n                                if (errorCallback) errorCallback(error);\r\n                                else console.error(error);\r\n                            },\r\n                            function (e) {\r\n                                // Math.min is to fix IE which reports 200% sometimes\r\n                                control.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\r\n                            }\r\n                        );\r\n                    };\r\n\r\n                    fileReader.readAsArrayBuffer(file);\r\n                } else {\r\n                     var url = saveItemUrl();\r\n                     control.uploading = true;\r\n\r\n                     $http['post'](url)\r\n                         .success(function (response) {\r\n                             control.reset();\r\n \r\n                             if (successCallback) successCallback(response);\r\n                         })\r\n                         .error(function (error) {\r\n                             control.uploading = false;\r\n                             control.upload = false;\r\n\r\n                             if (errorCallback) errorCallback(error);\r\n                             else console.error(error);\r\n                         });\r\n                }\r\n            };\r\n\r\n            function deletePicture(successCallback, errorCallback) {\r\n                var control = $scope.control;\r\n                $http['delete'](generateUrl())\r\n                .success(function (data) {\r\n                    control.reset(true);\r\n\r\n                    if (successCallback) successCallback();\r\n                })\r\n                .error(function (error) {\r\n                    control.uploading = false;\r\n                    control.upload = false;\r\n                    control.progress = 0;\r\n                    //$scope.$apply();\r\n\r\n                    if (errorCallback) errorCallback(error);\r\n                    else console.error(error);\r\n                });\r\n            };\r\n\r\n            function save(successCallback, errorCallback) {\r\n                // Process changes of the image\r\n                if ($scope.control.state == 'changed') {\r\n                    savePicture(successCallback, errorCallback);\r\n                } \r\n                // Process deletion of the image\r\n                else if ($scope.control.state == 'deleted') {\r\n                    deletePicture(successCallback, errorCallback);\r\n                }\r\n                // Process if no changes were made \r\n                else {\r\n                    if (successCallback) successCallback();                            \r\n                }\r\n            };\r\n\r\n\r\n            // Visual functions\r\n            function empty() {\r\n                return $scope.control.url == '' && !$scope.control.uploading;\r\n            };\r\n\r\n            function isUpdated() {\r\n                return $scope.control.state != 'original';\r\n            };\r\n\r\n            // Process user events\r\n\r\n            function readItemLocally(url, file) {\r\n                $scope.control.file = file;\r\n                $scope.control.url = url;\r\n                $scope.control.state = 'changed';\r\n                $scope.onChange();\r\n            };\r\n\r\n            function onDeleteClick($event) {\r\n                $event.stopPropagation();\r\n\r\n                $control.focus();\r\n\r\n                $scope.control.file = null;\r\n                $scope.control.url = '';\r\n                $scope.control.state = 'deleted';\r\n\r\n                $scope.onChange();\r\n            };\r\n\r\n            function onKeyDown($event) {\r\n                if ($event.keyCode == 13 || $event.keyCode == 32) {\r\n                    setTimeout(function() {\r\n                        $control.trigger('click');\r\n                    }, 0);\r\n                } else if ($event.keyCode == 46 || $event.keyCode == 8) {\r\n                    $scope.control.file = null;\r\n                    $scope.control.url = '';\r\n\r\n                    $scope.control.state = 'deleted';\r\n\r\n                    $scope.onChange();\r\n                } else if ($event.keyCode == 27) {\r\n                    $scope.control.reset();\r\n                }\r\n            };\r\n\r\n            // Clean up url to remove broken icon\r\n            function onImageError($event) {\r\n                $scope.$apply(function() {\r\n                    $scope.control.url = '';\r\n                    var image = $($event.target);\r\n\r\n                    pipImageUtils.setErrorImageCSS(image, {width: 'auto', height: '100%'});\r\n                });\r\n            };\r\n\r\n            // When image is loaded resize/reposition it\r\n            function onImageLoad($event) {\r\n                var image = $($event.target);\r\n                pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\r\n                $scope.control.uploading = false;\r\n            };\r\n\r\n            // On change event\r\n            function onChange() {\r\n                if ($scope.pipChanged) {\r\n                    $scope.pipChanged({\r\n                        $event: { sender: $scope.control },\r\n                        $control: $scope.control\r\n                    });\r\n                }\r\n            };\r\n        }]        \r\n    );\r\n    \r\n})();\r\n\r\n","/**\r\n * @file Camera dialog\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Add sample to sampler app\r\n */\r\n\r\n/* global angular, Webcam */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipCameraDialog',\r\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'TAKE_PICTURE': 'Take a picture',\r\n            'WEB_CAM_ERROR': 'Webcam is missing or was not found'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'TAKE_PICTURE': 'Сделать фото',\r\n            'WEB_CAM_ERROR': 'Web-камера отсутствует или не найдена'\r\n        });\r\n    }]);\r\n\r\n    thisModule.factory('pipCameraDialog',\r\n        ['$mdDialog', function ($mdDialog) {\r\n            return {\r\n                show: function (successCallback) {\r\n                    $mdDialog.show({\r\n                        templateUrl: 'camera_dialog/camera_dialog.html',\r\n                        clickOutsideToClose: true,\r\n                        controller: 'pipCameraController'\r\n                    }).then(function (result) {\r\n                        Webcam.reset();\r\n                        console.log(result);\r\n                        if (successCallback) {\r\n                            successCallback(result);\r\n                        }\r\n                    }, function () {\r\n                        Webcam.reset();\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n\r\n    thisModule.controller('pipCameraController',\r\n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', 'pipUtils', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, pipUtils) { // $cordovaCamera\r\n            $scope.browser = pipUtils.getBrowser().os;\r\n            $scope.theme = $rootScope.$theme;\r\n\r\n            if ($scope.browser !== 'android') {\r\n                console.log('webcam');\r\n                Webcam.init();\r\n\r\n                setTimeout(function () {\r\n                    Webcam.attach('.camera-stream');\r\n                }, 0);\r\n\r\n                Webcam.on('error', function (err) {\r\n                    $scope.webCamError = true;\r\n                    console.error(err);\r\n                });\r\n\r\n                Webcam.set({\r\n                    width: 400,\r\n                    height: 300,\r\n\r\n                    dest_width: 400,\r\n                    dest_height: 300,\r\n\r\n                    crop_width: 400,\r\n                    crop_height: 300,\r\n\r\n                    image_format: 'jpeg',\r\n                    jpeg_quality: 90\r\n                });\r\n\r\n                //Webcam.setSWFLocation('../../../dist/webcam.swf');\r\n                Webcam.setSWFLocation('webcam.swf');\r\n\r\n            } else {\r\n                document.addEventListener(\"deviceready\",onDeviceReady,false);\r\n\r\n            }\r\n            // todo add logic in callbacks\r\n            function onDeviceReady() {\r\n                navigator.camera.getPicture(onSuccess, onFail,\r\n                    {\r\n                        sourceType: Camera.PictureSourceType.CAMERA,\r\n                        correctOrientation: true,\r\n                        quality: 75,\r\n                        targetWidth: 200,\r\n                        destinationType: Camera.DestinationType.DATA_URL\r\n                    });\r\n            }\r\n\r\n\r\n            function onSuccess(imageData) {\r\n                var picture = imageData;\r\n                var picture = 'data:image/jpeg;base64,' + imageData;\r\n                $mdDialog.hide(picture);\r\n            }\r\n\r\n            function onFail(message) {\r\n                alert('Failed because: ' + message);\r\n                $mdDialog.hide();\r\n            }\r\n\r\n            $scope.$freeze = false;\r\n\r\n            $scope.onTakePictureClick = onTakePictureClick;\r\n            $scope.onResetPicture = onResetPicture;\r\n            $scope.onCancelClick = onCancelClick;\r\n\r\n            return;\r\n\r\n            function onTakePictureClick() {\r\n                if (Webcam) {\r\n                    if ($scope.$freeze) {\r\n                        Webcam.snap(function (dataUri) {\r\n                            $scope.$freeze = false;\r\n                            $mdDialog.hide(dataUri);\r\n                        });\r\n                    } else {\r\n                        $scope.$freeze = true;\r\n                        Webcam.freeze();\r\n                    }\r\n                }\r\n            };\r\n\r\n            function onResetPicture() {\r\n                $scope.$freeze = false;\r\n                Webcam.unfreeze();\r\n            };\r\n\r\n            function onCancelClick() {\r\n                $mdDialog.cancel();\r\n            };\r\n        }]\r\n    );\r\n\r\n})();","/**\r\n * @file Collage control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Improve samples in sampler app\r\n * - Replace placeholder with default image generated on server\r\n * - Fix resizing problem\r\n */\r\n \r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipCollage\", ['pipCore', 'pipRest']);\r\n\r\n    thisModule.directive('pipCollage',\r\n        function () {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: false,\r\n                controller: 'pipCollageController' \r\n            }\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipCollageController',\r\n        ['$scope', '$element', '$attrs', '$parse', '$rootScope', 'pipUtils', 'pipStrings', 'pipRest', 'pipImageUtils', function ($scope, $element, $attrs, $parse, $rootScope, pipUtils, pipStrings, pipRest, pipImageUtils) {\r\n            var                         \r\n                pictureIdsGetter = $attrs.pipPictureIds ? $parse($attrs.pipPictureIds) : null,\r\n                srcsGetter = $attrs.pipSrcs ? $parse($attrs.pipSrcs) : null,\r\n                uniqueCodeGetter = $attrs.pipUniqueCode ? $parse($attrs.pipUniqueCode) : null,\r\n                multipleGetter = $attrs.pipMultiple ? $parse($attrs.pipMultiple) : null,\r\n                allowOpen = pipUtils.toBoolean($attrs.pipOpen),\r\n                collageSchemes = pipImageUtils.getCollageSchemes(),\r\n                resized = 0,\r\n                $svgData = '<?xml version=\"1.0\" encoding=\"utf-8\"?>'+\r\n                    '<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">'+\r\n                    '<svg version=\"1.1\"'+\r\n                    'xmlns=\"http://www.w3.org/2000/svg\"'+\r\n                    'xmlns:xlink=\"http://www.w3.org/1999/xlink\"'+\r\n                    'x=\"0px\" y=\"0px\"'+\r\n                    'viewBox=\"0 0 510 510\"'+\r\n                    'style=\"enable-background:new 0 0 515 515;\"'+\r\n                    'xml:space=\"preserve\">'+\r\n                    '<defs>'+\r\n                    '<style type=\"text/css\"><![CDATA['+\r\n                    '#symbol-picture-no-border {'+\r\n                    '        transform-origin: 50% 50%;'+\r\n                    '        transform: scale(0.6, -0.6);'+\r\n                    '    }'+\r\n                    '        ]]></style>'+\r\n                    '        </defs>'+\r\n                    '<rect x=\"0\" width=\"515\" height=\"515\"/>'+\r\n                    '<path id=\"symbol-picture-no-border\" d=\"M120 325l136-102 69 33 136-82 0-54-410 0 0 136z m341 15c0-28-23-51-51-51-29 0-52 23-52 51 0 29 23 52 52 52 28 0 51-23 51-52z\" />'+\r\n                    '</svg>';\r\n\r\n            // Add class\r\n            $element.addClass('pip-collage');\r\n\r\n            // Also optimization to avoid watch if it is unnecessary\r\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\r\n                if (srcsGetter) {\r\n                    $scope.$watch(srcsGetter, function (newValue) {\r\n                        //getImageUrls();\r\n                        generateContent();\r\n                    });\r\n                    $scope.$watchCollection(srcsGetter, function (newValue) {\r\n                        //getImageUrls();\r\n                        generateContent();\r\n                    });\r\n                }\r\n                else if (pictureIdsGetter) {\r\n                    $scope.$watch(pictureIdsGetter, function (newValue) {\r\n                        //getImageUrls();\r\n                        generateContent();\r\n                    });\r\n                }\r\n            }\r\n\r\n            $scope.getElementDimensions = getElementDimensions;\r\n\r\n            var update = _.debounce(calculateResize, 50);\r\n\r\n            function calculateResize() {\r\n                var ims = $element.find('img');\r\n                var i = 0;\r\n                for ( i; i < ims.length; i++ ) {\r\n                    var container = angular.element(ims[i].parentElement),\r\n                        image = angular.element(ims[i]);\r\n\r\n                    if (image.css('display') != 'none')\r\n                        pipImageUtils.setImageMarginCSS(container, image);\r\n                }\r\n\r\n                var icns = $element.find('md-icon');\r\n\r\n                var i = 0;\r\n                for ( i; i < icns.length; i++ ) {\r\n                    var container = angular.element(icns[i].parentElement),\r\n                        icn = angular.element(icns[i]);\r\n                    if (container.css('display') != 'none') {\r\n                        pipImageUtils.setIconMarginCSS(container[0], icn);\r\n                    }\r\n\r\n                }\r\n            };\r\n\r\n            $scope.$watch($scope.getElementDimensions, function (newValue, oldValue) {\r\n                if (newValue && oldValue && oldValue.h == newValue.h && oldValue.w == newValue.w) return;\r\n                calculateResize();\r\n            }, true);\r\n\r\n            generateContent();\r\n            //getImageUrls();\r\n\r\n            return;\r\n\r\n            function getElementDimensions() {\r\n                var dimension = {\r\n                    'h': $element.height(),\r\n                    'w': $element.width()\r\n                };\r\n\r\n                return dimension;\r\n            };\r\n\r\n            // Clean up url to remove broken icon\r\n            function onImageError(event) {\r\n                var \r\n                    image = $(event.target),\r\n                    container = image.parent(),\r\n                    defaultBlock = container.children('div'),\r\n                    defaultIcon = image.parent().find('md-icon');\r\n\r\n                defaultBlock.css('display', 'block');\r\n                image.css('display', 'none');\r\n                pipImageUtils.setIconMarginCSS(container[0], defaultIcon);\r\n                defaultIcon.empty().append($svgData);\r\n            };\r\n\r\n            // When image is loaded resize/reposition it\r\n            function onImageLoad($event) {\r\n                var image = $($event.target),\r\n                    container =  image.parent(),\r\n                    defaultBlock = container.children('div');\r\n\r\n                pipImageUtils.setImageMarginCSS(container, image);\r\n\r\n                defaultBlock.css('display', 'none');\r\n            };\r\n\r\n            function getScheme(count) {\r\n                var schemes = collageSchemes[count - 1];\r\n\r\n                // If nothing to choose from then return\r\n                if (schemes.length == 1) return schemes[0];\r\n\r\n                // Calculate unique had code\r\n                var uniqueCode = uniqueCodeGetter ? '' + uniqueCodeGetter($scope) : '';\r\n                var hash = pipStrings.hashCode(uniqueCode);\r\n\r\n                // Return reproducable scheme by hashcode\r\n                return schemes[hash % schemes.length];\r\n            };\r\n\r\n            function getImageUrls() {\r\n                // Simply return sources\r\n                if (srcsGetter) {\r\n                    var srcs = srcsGetter($scope);\r\n                    //generateContent();\r\n                    return _.clone(srcs);\r\n                }\r\n\r\n                // Calculate urls if picture ids are specified\r\n                if (pictureIdsGetter) {\r\n                    var\r\n                        ids = pictureIdsGetter($scope) || [],\r\n                        serverUrl = pipRest.serverUrl(),\r\n                        userId = ($rootScope.$user || {}).id,\r\n                        partyId = ($rootScope.$party || {}).id || userId,\r\n                        result = [];\r\n\r\n                    for (var i = 0; i < ids.length; i++) {\r\n                        result.push(\r\n                            serverUrl + '/api/parties/' + partyId + '/files/' + ids[i] + '/content'\r\n                        );\r\n                    }\r\n\r\n                    return result;\r\n                }\r\n\r\n                // Return an empty array otherwise\r\n                return [];\r\n            };\r\n\r\n            function generatePicture(urls, scheme) {\r\n                var \r\n                    url = urls[0],\r\n                    containerClasses = '',\r\n                    pictureClasses = '';\r\n\r\n                urls.splice(0, 1);\r\n\r\n                containerClasses += scheme.fullWidth ? ' pip-full-width' : '';\r\n                containerClasses += scheme.fullHeight ? ' pip-full-height' : '';\r\n                containerClasses += ' flex-' + scheme.flex;\r\n\r\n                pictureClasses += scheme.leftPadding ? ' pip-left' : '';\r\n                pictureClasses += scheme.rightPadding ? ' pip-right' : '';\r\n                pictureClasses += scheme.topPadding ? ' pip-top' : '';\r\n                pictureClasses += scheme.bottomPadding ? ' pip-bottom' : '';\r\n\r\n                if (allowOpen) {\r\n                    return '<a class=\"pip-picture-container' + containerClasses + '\" flex=\"' + scheme.flex + '\" '\r\n                        + 'href=\"' + url + '\"  target=\"_blank\">'\r\n                        + '<div class=\"pip-picture' + pictureClasses + '\"><img src=\"' + url + '\"/>'\r\n                        + '<div><md-icon></md-icon></div></div></a>';\r\n                }\r\n\r\n                return '<div class=\"pip-picture-container' + containerClasses + '\" flex=\"' + scheme.flex + '\">'\r\n                    + '<div class=\"pip-picture' + pictureClasses + '\"><img src=\"' + url + '\"/>'\r\n                    + '<div><md-icon></md-icon></div></div></div>';\r\n            };\r\n\r\n            function generatePictureGroup(urls, scheme) {\r\n                var classes = '', result;\r\n\r\n                classes += scheme.fullWidth ? ' pip-full-width' : '';\r\n                classes += scheme.fullHeight ? ' pip-full-height' : '';\r\n                classes += ' flex-' + scheme.flex;\r\n                classes += ' layout-' + scheme.layout;\r\n\r\n                result = '<div class=\"pip-picture-group layout' + classes + '\" flex=\"'\r\n                    + scheme.flex + '\" layout=\"' + scheme.layout + '\">';\r\n\r\n                // Generate content for children recursively\r\n                for (var i = 0; i < scheme.children.length; i++) {\r\n                    result += generate(urls, scheme.children[i]);\r\n                }\r\n\r\n                result += '</div>';\r\n                return result;\r\n            };\r\n\r\n            function generate(urls, scheme) {\r\n                if (scheme.group)\r\n                    return generatePictureGroup(urls, scheme);\r\n                return generatePicture(urls, scheme);\r\n            };\r\n\r\n            function generateContent(urls) {\r\n                // Unbind previously defined actions handlers\r\n                $element.find('img')\r\n                    .unbind('error')\r\n                    .unbind('load');\r\n\r\n                // Clean up content\r\n                $element.empty();\r\n\r\n                // Calculate list of image urls\r\n                var urls = getImageUrls();\r\n\r\n                // And exit if nothing to show\r\n                if (urls.length == 0) {\r\n                    $element.hide();\r\n                    return;\r\n                }\r\n\r\n                // Limit collage only to one element if not specified otherwise\r\n                if (urls.length > 8) {\r\n                    var multiple = multipleGetter ? multipleGetter($scope) : false;\r\n\r\n                    if (!multiple) {\r\n                        urls.length = 8;\r\n                    }\r\n                }\r\n\r\n                if (urls.length <= 8) {\r\n                    // Get scheme for visualization\r\n                    var scheme = getScheme(urls.length);\r\n\r\n                    // Generate and add content\r\n                    var html = '<div class=\"pip-collage-section\">' + generate(urls, scheme) + '</div>';\r\n                    html += '<div class=\"clearfix\"></div>';\r\n                    $element.html(html);\r\n                } else {\r\n                    var html = '';\r\n\r\n                    while (urls.length > 0) {\r\n                        var partialUrls = urls.splice(0, 8);\r\n\r\n                        // Get scheme for visualization\r\n                        var scheme = getScheme(partialUrls.length);\r\n\r\n                        // Generate and add content\r\n                        html += '<div class=\"pip-collage-section\">' + generate(partialUrls, scheme) + '</div>';\r\n                    }\r\n\r\n                    html += '<div class=\"clearfix\"></div>';\r\n                    $element.html(html);\r\n                }\r\n\r\n                // Bind events to images...\r\n                $element.find('img')\r\n                    .bind('error', onImageError)\r\n                    .bind('load', onImageLoad);\r\n\r\n                // Show the new element\r\n                $element.show();\r\n            };\r\n\r\n        }]\r\n\r\n    );\r\n\r\n})();\r\n\r\n","/**\r\n * @file Camera dialog\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Add sample to sampler app\r\n */\r\n\r\n/* global angular, Webcam */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipGallerySearchDialog',\r\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates', 'pipRest']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'IMAGE_GALLERY': 'Add from image gallery',\r\n            'SEARCH_PICTURES': 'Search for pictures...',\r\n            'IMAGE_START_SEARCH': 'Images will appear here once you start searching'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'IMAGE_GALLERY': 'Добавить из галереи изображений',\r\n            'SEARCH_PICTURES': 'Поиск изображений...',\r\n            'IMAGE_START_SEARCH': 'Картинки появятся после начала поиска'\r\n        });\r\n    }]);\r\n\r\n    thisModule.factory('pipGallerySearchDialog',\r\n        ['$mdDialog', function ($mdDialog) {\r\n            return {\r\n                show: function (successCallback, multiple) {\r\n                    $mdDialog.show({\r\n                        templateUrl: 'gallery_search_dialog/gallery_search_dialog.html',\r\n                        clickOutsideToClose: true,\r\n                        controller: 'pipGallerySearchController',\r\n                        locals: {\r\n                            multiple: multiple\r\n                        }\r\n                    }).then(function (result) {\r\n                        if (successCallback) {\r\n                            successCallback(result);\r\n                        }\r\n                    }, function () {\r\n\r\n                    });\r\n                }\r\n            };\r\n        }]);\r\n\r\n    thisModule.controller('pipGallerySearchController',\r\n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', '$http', 'pipRest', 'multiple', 'pipTransaction', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, $http, pipRest, multiple, pipTransaction) {\r\n\r\n            var prevSearch = '',\r\n                url = pipRest.serverUrl() + '/api/images/search',\r\n                images = [];\r\n\r\n            $scope.theme = $rootScope.$theme;\r\n            $scope.$serverUrl = pipRest.serverUrl();\r\n            $scope.$search = '';\r\n            $scope.$images = [];\r\n            $scope.transaction = pipTransaction('search', $scope);\r\n\r\n            $scope.onSearchClick = onSearchClick;\r\n            $scope.onKeyPress = onKeyPress;\r\n            $scope.onImageClick = onImageClick;\r\n            $scope.onAddClick = onAddClick;\r\n            $scope.onCancelClick = onCancelClick;\r\n            $scope.addButtonDisabled = addButtonDisabled;\r\n            $scope.onStopSearchClick = onStopSearchClick;\r\n\r\n            focusSearchText();\r\n\r\n            return;\r\n\r\n            function onSearchClick() {\r\n                if ($scope.transaction.busy()) return;\r\n\r\n                if ($scope.$search == '' || $scope.$search == prevSearch) return;\r\n\r\n                prevSearch = $scope.$search;\r\n                $scope.$images = [];\r\n                $scope.stop = null;\r\n                var requestUrl = url + '?q=' + $scope.$search;\r\n\r\n                var transactionId = $scope.transaction.begin('ENTERING');\r\n                if (!transactionId) return;\r\n\r\n                $http['get'](requestUrl)\r\n                    .success(function (results) {\r\n                        if ($scope.transaction.aborted(transactionId))return;\r\n\r\n\r\n                        for (var i = 0; i < results.length; i++) {\r\n                            $scope.$images.push({\r\n                                checked: false,\r\n                                url: results[i].link,\r\n                                thumbnail: results[i].thumbnail\r\n                            });\r\n                        }\r\n                        $scope.transaction.end();\r\n\r\n\r\n                    }).\r\n                    error(function (error) {\r\n                        console.error(error)\r\n                    });\r\n            }\r\n\r\n            function onStopSearchClick() {\r\n                $scope.transaction.abort();\r\n                prevSearch = '';\r\n            }\r\n\r\n            function onKeyPress($event) {\r\n                if ($event.keyCode === 13)\r\n                    $scope.onSearchClick();\r\n            }\r\n\r\n            function onImageClick(image) {\r\n                if ($scope.transaction.busy()) return;\r\n\r\n                image.checked = !image.checked;\r\n\r\n                if (multiple) {\r\n                    if (image.checked) {\r\n                        images.push(image);\r\n                    } else {\r\n                        _.remove(images, {url: image.url});\r\n                    }\r\n                } else {\r\n                    if (image.checked) {\r\n                        if (images.length > 0) {\r\n                            images[0].checked = false;\r\n                            images[0] = image;\r\n                        } else {\r\n                            images.push(image);\r\n                        }\r\n                    } else {\r\n                        images = [];\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onAddClick() {\r\n                if ($scope.transaction.busy()) return;\r\n\r\n                var result = [];\r\n                images.forEach(function (image) {\r\n                    if (image.checked)\r\n                        result.push(image.url);\r\n                });\r\n                $mdDialog.hide(result);\r\n            }\r\n\r\n            function onCancelClick() {\r\n                $mdDialog.cancel();\r\n            }\r\n\r\n            function addButtonDisabled() {\r\n                return images.length == 0 || $scope.transaction.busy();\r\n            }\r\n\r\n            function focusSearchText() {\r\n                setTimeout(function () {\r\n                    var element = $('.pip-gallery-search-dialog .search-images');\r\n                    if (element.length > 0)\r\n                        element.focus();\r\n                }, 0);\r\n            }\r\n\r\n        }]\r\n    );\r\n\r\n})();","/**\r\n * @file Picture control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Improve samples in sampler app\r\n * - Replace placeholder with default image generated on server\r\n * - Fix resizing problem\r\n */\r\n \r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipPicture\", ['pipCore']);\r\n\r\n    thisModule.directive('pipPicture', \r\n        function() {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: {\r\n                    src: '&pipSrc',\r\n                    pictureId: '=pipPictureId',\r\n                    defaultIcon: '=pipDefaultIcon'\r\n                },\r\n                template: '<img ui-event=\"{ error: \\'onImageError($event)\\', load: \\'onImageLoad($event)\\' }\"/>'\r\n                          + '<div><span></span></div>',\r\n                controller: 'pipPictureController' \r\n            }\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipPictureController',\r\n        ['$scope', '$element', '$attrs', '$rootScope', 'pipUtils', 'pipImageUtils', 'pipRest', function ($scope, $element, $attrs, $rootScope, pipUtils, pipImageUtils, pipRest) {\r\n            var \r\n                image = $element.children('img'),\r\n                defaultBlock = $element.children('div');\r\n\r\n            $scope.onImageError = onImageError;\r\n            $scope.onImageLoad = onImageLoad;\r\n\r\n            // Add class\r\n            $element.addClass('pip-picture');\r\n\r\n            bindControl();\r\n\r\n            // Also optimization to avoid watch if it is unnecessary\r\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\r\n                $scope.$watch($scope.pictureId, function(newValue) {\r\n                    if ($scope.pictureId != newValue) bindControl();\r\n                });\r\n            }\r\n\r\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\r\n                $scope.$watch($scope.src, function(newValue) {\r\n                    if ($scope.src != newValue)\r\n                      bindControl();\r\n                });\r\n            }\r\n\r\n            return;\r\n\r\n            // Clean up url to remove broken icon\r\n            function onImageError($event) {\r\n                $scope.$apply(function() {\r\n                    var image = $($event.target);\r\n\r\n                    pipImageUtils.setErrorImageCSS(image);\r\n                    defaultBlock.css('display', 'block');\r\n                });\r\n            };\r\n\r\n            // When image is loaded resize/reposition it\r\n            function onImageLoad($event) {\r\n                var image = $($event.target);\r\n                pipImageUtils.setImageMarginCSS($element, image);\r\n                defaultBlock.css('display', 'none');\r\n            };\r\n\r\n            function bindControl() {\r\n                if ($scope.pictureId) {\r\n                    var serverUrl = pipRest.serverUrl(),\r\n                        userId = ($rootScope.$user || {}).id,\r\n                        partyId = ($rootScope.$party || {}).id || userId,\r\n                        url = serverUrl + '/api/parties/' + partyId + '/files/' + $scope.pictureId + '/content';\r\n\r\n                    image.attr('src', url);\r\n                } else {\r\n                    if ($scope.src) image.attr('src', $scope.src());\r\n                    else image.attr('src', '');\r\n                }\r\n            };\r\n        }]        \r\n    ); \r\n\r\n})();\r\n\r\n","/**\r\n * @file Picture control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipPictureEdit', ['ui.event', 'angularFileUpload', 'pipRest', 'pipPicturePaste',\r\n        'pipTranslate', 'pipPictures.Templates']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function (pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            ERROR_WRONG_IMAGE_FILE: 'Incorrect image file. Please, choose another one',\r\n            PICTURE_EDIT_TEXT: 'Click here to upload a picture'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            ERROR_WRONG_IMAGE_FILE: 'Неправильный файл с изображением. Выберете другой файл',\r\n            PICTURE_EDIT_TEXT: 'Нажмите сюда для загрузки картинки'\r\n        });\r\n    }]);\r\n\r\n    thisModule.directive('pipPictureEdit',\r\n        function () {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: {\r\n                    ngDisabled: '&',\r\n                    pipCreated: '&',\r\n                    pipChanged: '&',\r\n                    pipReset: '&',\r\n                    pipPictureId: '=',\r\n                    pipPartyId: '=',\r\n                    pipAddedPicture: '='\r\n                },\r\n                templateUrl: 'picture_edit/picture_edit.html',\r\n                controller: 'pipPictureEditController'\r\n            };\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipPictureEditController',\r\n        ['$scope', '$element', '$attrs', '$http', '$upload', '$timeout', '$rootScope', '$parse', 'pipRest', 'pipPicturePaste', 'pipImageUtils', 'pipUtils', function ($scope, $element, $attrs, $http, $upload, $timeout, $rootScope, $parse, pipRest, pipPicturePaste,\r\n                  pipImageUtils, pipUtils) {\r\n            var\r\n                $control = $element.children('.pip-picture-upload'),\r\n                $input = $control.children('input[type=file]'),\r\n                serverUrl = pipRest.serverUrl(),\r\n                fileUrl = serverUrl + '/api/parties/' + $scope.pipPartyId + '/files';\r\n\r\n            $scope.text = $attrs.pipDefaultText || 'PICTURE_EDIT_TEXT';\r\n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\r\n            $scope.pictureStartState = pipUtils.toBoolean($scope.pipAddedPicture) ? 'copied' : 'original';\r\n\r\n            $scope.control = {\r\n                url: '',\r\n                progress: 0,\r\n                uploaded: false,\r\n                uploading: false,\r\n                loaded: false,\r\n                file: null,\r\n                state: $scope.pictureStartState //'original'\r\n            };\r\n\r\n            $scope.control.reset = resetImage;\r\n            $scope.control.save = saveImage;\r\n            $scope.empty = empty;\r\n            $scope.isUpdated = isUpdated;\r\n            $scope.readItemLocally = readItemLocally;\r\n            $scope.onDeleteClick = onDeleteClick;\r\n            $scope.onKeyDown = onKeyDown;\r\n            $scope.onImageError = onImageError;\r\n            $scope.onImageLoad = onImageLoad;\r\n            $scope.onChange = onChange;\r\n            $scope.onBlur = onBlur;\r\n            $scope.onFocus = onFocus;\r\n\r\n            // Also optimization to avoid watch if it is unnecessary\r\n            if (pipUtils.toBoolean($attrs.pipRebind)) {\r\n                $scope.$watch('pipPictureId', function (newValue) {\r\n                    $scope.control.reset();\r\n                });\r\n            }\r\n\r\n            $scope.$watch($scope.ngDisabled, function (newValue) {\r\n                $input.attr('disabled', $scope.control.disabled);\r\n            });\r\n\r\n            //// Add paste listener\r\n            //$element.children('.pip-picture-upload').focus(function () {\r\n            //    console.log('addPasteListener');\r\n            //    pipPicturePaste.addPasteListener(function (item) {\r\n            //        $scope.readItemLocally(item.url, item.file);\r\n            //    });\r\n            //});\r\n\r\n            //$element.children('.pip-picture-upload').blur(function () {\r\n            //    pipPicturePaste.removePasteListener();\r\n            //});\r\n\r\n            // Add class\r\n            $element.addClass('pip-picture-edit');\r\n\r\n            // Initialize control\r\n            $scope.control.reset();\r\n\r\n            // Execute callback\r\n            if ($scope.pipCreated) {\r\n                $scope.pipCreated({\r\n                    $event: {sender: $scope.control},\r\n                    $control: $scope.control\r\n                });\r\n            }\r\n\r\n            return;\r\n\r\n            function resetImage(afterDeleting) {\r\n                $scope.control.progress = 0;\r\n                $scope.control.uploading = false;\r\n                $scope.control.uploaded = false;\r\n                $scope.control.file = null;\r\n                $scope.control.state = $scope.pictureStartState; //'original';\r\n                $scope.control.url = '';\r\n                var url = '';\r\n\r\n                if (!afterDeleting) {\r\n                    if ($rootScope.$party && $rootScope.$party.id && $scope.pipPictureId) {\r\n                        url = fileUrl + '/' + $scope.pipPictureId + '/content';\r\n                    }\r\n                    if (!url) return;\r\n\r\n                    $scope.control.url = url;\r\n                    $scope.control.uploaded = true;\r\n                    $scope.onChange();\r\n                } else $scope.onChange();\r\n            };\r\n\r\n            function saveItemUrl() {\r\n                var\r\n                    url = $scope.control.url,\r\n                    name = url.slice(url.lastIndexOf('/') + 1, url.length).split('?')[0];\r\n                return fileUrl + '?name=' + name + '&url=' + url;\r\n            };\r\n\r\n            function onFocus() {\r\n                pipPicturePaste.addPasteListener(function (item) {\r\n                    $scope.readItemLocally(item.url, item.file);\r\n                });\r\n            };\r\n\r\n            function onBlur() {\r\n                pipPicturePaste.removePasteListener();\r\n            };\r\n\r\n            function savePicture(successCallback, errorCallback) {\r\n                var\r\n                    control = $scope.control,\r\n                    file = control.file;\r\n\r\n                if ($scope.control.file !== null) {\r\n                    var fileReader = new FileReader();\r\n\r\n                    fileReader.onload = function (e) {\r\n                        control.uploading = true;\r\n                        //        pipImageUtils.addHttpHeaders();\r\n                        var upload = $upload.http({\r\n                            url: fileUrl + '?name=' + file.name,\r\n                            headers: {'Content-Type': file.type},\r\n                            data: e.target.result\r\n                        })\r\n                            .then(\r\n                                function (response) {\r\n                                    $scope.pipPictureId = response.data.id;\r\n                                    control.reset();\r\n                                    if (successCallback) successCallback(response);\r\n                                },\r\n                                function (error) {\r\n                                    control.uploading = false;\r\n                                    control.upload = false;\r\n                                    control.progress = 0;\r\n\r\n                                    if (errorCallback) errorCallback(error);\r\n                                    else console.error(error);\r\n                                },\r\n                                function (e) {\r\n                                    // Math.min is to fix IE which reports 200% sometimes\r\n                                    control.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\r\n                                }\r\n                            );\r\n                    };\r\n\r\n                    fileReader.readAsArrayBuffer(file);\r\n                } else {\r\n                    var url = saveItemUrl();\r\n                    control.uploading = true;\r\n\r\n                    //               pipImageUtils.addHttpHeaders();\r\n                    $http['post'](url)\r\n                        .success(function (response) {\r\n                            $scope.pipPictureId = response.id;\r\n                            control.reset();\r\n\r\n                            if (successCallback) successCallback(response);\r\n                        })\r\n                        .error(function (error) {\r\n                            control.uploading = false;\r\n                            control.upload = false;\r\n\r\n                            if (errorCallback) errorCallback(error);\r\n                            else console.error(error);\r\n                        });\r\n                }\r\n\r\n            };\r\n\r\n            function deletePicture(successCallback, errorCallback) {\r\n                var control = $scope.control;\r\n                $http['delete'](fileUrl + '/' + $scope.pipPictureId)\r\n                    .success(function (data) {\r\n                        $scope.pipPictureId = null;\r\n                        control.reset(true);\r\n\r\n                        if (successCallback) successCallback();\r\n                    })\r\n                    .error(function (error) {\r\n                        control.uploading = false;\r\n                        control.upload = false;\r\n                        control.progress = 0;\r\n\r\n                        if (errorCallback) errorCallback(error);\r\n                        else console.error(error);\r\n                    });\r\n            };\r\n\r\n            function saveImage(successCallback, errorCallback) {\r\n                // Process changes of the image\r\n                if ($scope.control.state == 'changed') {\r\n                    savePicture(successCallback, errorCallback);\r\n                }\r\n                // Process deletion of the image\r\n                else if ($scope.control.state == 'deleted') {\r\n                    deletePicture(successCallback, errorCallback);\r\n                }\r\n                // Process if no changes were made\r\n                else {\r\n                    if (successCallback) successCallback();\r\n                }\r\n            };\r\n\r\n            // Visual functions\r\n            function empty() {\r\n                return $scope.control.url == '' && !$scope.control.uploading;\r\n            };\r\n\r\n            function isUpdated() {\r\n                return $scope.control.state != 'original';\r\n            };\r\n\r\n            // Process user events\r\n            function readItemLocally(url, file) {\r\n                $scope.control.file = file;\r\n                $scope.control.url = url;\r\n                $scope.control.state = 'changed';\r\n                $scope.onChange();\r\n            };\r\n\r\n            function onDeleteClick($event) {\r\n                $event.stopPropagation();\r\n\r\n                $control.focus();\r\n\r\n                $scope.control.file = null;\r\n                $scope.control.url = '';\r\n                if ($scope.control.state != 'copied') $scope.control.state = 'deleted';\r\n\r\n                $scope.onChange();\r\n            };\r\n\r\n            function onKeyDown($event) {\r\n                if ($event.keyCode == 13 || $event.keyCode == 32) {\r\n                    // !! Avoid clash with $apply()\r\n                    setTimeout(function () {\r\n                        $control.trigger('click');\r\n                    }, 0);\r\n                } else if ($event.keyCode == 46 || $event.keyCode == 8) {\r\n                    $scope.control.file = null;\r\n                    $scope.control.url = '';\r\n\r\n                    $scope.control.state = 'deleted';\r\n\r\n                    $scope.onChange();\r\n                } else if ($event.keyCode == 27) {\r\n                    $scope.control.reset();\r\n                }\r\n            };\r\n\r\n            // Clean up url to remove broken icon\r\n            function onImageError($event) {\r\n                $scope.$apply(function () {\r\n                    $scope.control.url = '';\r\n\r\n                    var image = $($event.target);\r\n\r\n                    pipImageUtils.setErrorImageCSS(image, {width: 'auto', height: '100%'});\r\n                });\r\n            };\r\n\r\n            // When image is loaded resize/reposition it\r\n            function onImageLoad($event) {\r\n                var image = $($event.target);\r\n                pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\r\n                $scope.control.uploading = false;\r\n            };\r\n\r\n            // On change event\r\n            function onChange() {\r\n                if ($scope.pipChanged) {\r\n                    $scope.pipChanged({\r\n                        $event: {sender: $scope.control},\r\n                        $control: $scope.control\r\n                    });\r\n                }\r\n            };\r\n\r\n        }]\r\n    );\r\n\r\n})();\r\n\r\n","/**\r\n * @file Picture list edit control\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n * @todo\r\n * - Improve samples in sampler app\r\n * - Add animations to add/remove pictures\r\n * - ?? Replace placeholder with default image generated on server?\r\n */\r\n \r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module(\"pipPictureListEdit\", \r\n        ['ui.event', 'angularFileUpload', 'pipCore', 'pipFocused', 'pipRest', 'pipPicturePaste']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'PICTURE_LIST_EDIT_TEXT': 'Click here to add a picture',\r\n            'ERROR_TRANSACTION_IN_PROGRESS': 'Transaction is in progress. Please, wait until it is finished or abort',\r\n            'ERROR_IMAGE_PRELOADING': 'Image loading error. The picture can not be saved'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'PICTURE_LIST_EDIT_TEXT': 'Нажмите сюда чтобы добавить картинку',\r\n            'ERROR_TRANSACTION_IN_PROGRESS': 'Транзакция еще не завершена. Подождите окончания или прервите её',\r\n            'ERROR_IMAGE_PRELOADING': 'Ошибка при загрузки картинки. Картинка не сохранена.'\r\n        });\r\n    }]);\r\n\r\n    thisModule.directive('pipPictureListEdit', \r\n        function() {\r\n            return {\r\n                restrict: 'EA',\r\n                scope: {\r\n                    pipPictureIds: '=',\r\n                    pipAddedPicture: '=',\r\n                    ngDisabled: '&',\r\n                    pipCreated: '&',\r\n                    pipChanged: '&'\r\n                },\r\n                templateUrl: 'picture_list_edit/picture_list_edit.html',\r\n                controller: 'pipPictureListEditController' \r\n            };\r\n        }\r\n    );\r\n\r\n    thisModule.controller('pipPictureListEditController',\r\n        ['$scope', '$rootScope', '$element', '$attrs', '$parse', '$http', '$upload', '$timeout', 'pipUtils', 'pipRest', 'pipPicturePaste', 'pipImageUtils', function($scope, $rootScope, $element, $attrs, $parse, $http, $upload, $timeout, pipUtils,\r\n                 pipRest, pipPicturePaste, pipImageUtils) {\r\n                \r\n            var\r\n                $control = $element.children('.pip-picture-drop'),\r\n                itemPin = 0;\r\n\r\n            $scope.text = $attrs.pipDefaultText || 'PICTURE_LIST_EDIT_TEXT';\r\n            $scope.icon = $attrs.pipDefaultIcon || 'picture-no-border';\r\n            $scope.pipRebind = pipUtils.toBoolean($attrs.pipRebind);\r\n            $scope.pictureStartState = pipUtils.toBoolean($scope.pipAddedPicture) ? 'copied' : 'original';\r\n\r\n            $scope.control = {\r\n                uploading: 0,\r\n                items: []\r\n            };\r\n\r\n            $scope.control.reset = reset;\r\n            $scope.control.save = save;\r\n            $scope.control.abort = abort;\r\n            $scope.filterItem = function(item) {\r\n                return item.state != 'deleted';\r\n            };\r\n            $scope.readItemLocally = readItemLocally;\r\n            $scope.onSelectClick = onSelectClick;\r\n            $scope.onDeleteClick = onDeleteClick;\r\n            $scope.onKeyDown = onKeyDown;\r\n            $scope.onImageError = onImageError;\r\n            $scope.onImageLoad = onImageLoad;\r\n            $scope.onChange = onChange;\r\n            $scope.onBlur = onBlur;\r\n            $scope.onFocus = onFocus;\r\n            \r\n            // Watch for changes\r\n            if ($scope.pipRebind) {\r\n                $scope.$watch(\r\n                    function () {\r\n                        // Todo: Optimize change tracking\r\n                        return $scope.pipPictureIds;\r\n                    },\r\n                    function (newValue) {\r\n                        $scope.control.reset();\r\n                    }\r\n                );\r\n            }\r\n\r\n            // // Add paste listeners\r\n            // $element.find('.pip-picture-upload').focus(function () {\r\n            //     pipPicturePaste.addPasteListener(function (item) {\r\n            //         $scope.readItemLocally(item.url, item.file);\r\n            //     });\r\n            // });\r\n            // $element.find('.pip-picture-upload').blur(function () {\r\n            //     pipPicturePaste.removePasteListener();\r\n            // });\r\n\r\n            // Add class\r\n            $element.addClass('pip-picture-list-edit');\r\n\r\n            // Initialize control\r\n            $scope.control.reset();\r\n\r\n            // Execute callback\r\n            if ($scope.pipCreated) {\r\n                $scope.pipCreated({\r\n                    $event: { sender: $scope.control },\r\n                    $control: $scope.control\r\n                });\r\n            }\r\n\r\n            return;\r\n\r\n            function contentUrl(id) {\r\n                var\r\n                    serverUrl = pipRest.serverUrl(),\r\n                    partyId = $scope.$party ? $scope.$party.id : pipRest.userId();\r\n\r\n                return serverUrl + '/api/parties/' + partyId + '/files/' + id + '/content';\r\n            }\r\n\r\n            function onImageError($event, item) {\r\n                item.error = true;\r\n            };\r\n            \r\n            function onFocus(a) {\r\n                pipPicturePaste.addPasteListener(function (item) {\r\n                    $scope.readItemLocally(item.url, item.file);\r\n                });\r\n            };\r\n\r\n            function onBlur () {\r\n                pipPicturePaste.removePasteListener();\r\n            };\r\n\r\n            function getItems() {\r\n                var\r\n                    pictureIds = $scope.pipPictureIds,\r\n                    items = [];\r\n\r\n                if (pictureIds == null || pictureIds.length == 0)\r\n                    return items;\r\n\r\n                for (var i = 0; i < pictureIds.length; i++) {\r\n                    items.push({\r\n                        pin: itemPin++,\r\n                        id: pictureIds[i],\r\n                        uploading: false,\r\n                        uploaded: false,\r\n                        progress: 0,\r\n                        file: null,\r\n                        url: contentUrl(pictureIds[i]),\r\n                        state: $scope.pictureStartState //'original'\r\n                    });\r\n                }\r\n\r\n                return items;\r\n            }\r\n\r\n            function setItems() {\r\n                // Clean the array\r\n                if ($scope.pipPictureIds && $scope.pipPictureIds.length > 0)\r\n                    $scope.pipPictureIds.splice(0, $scope.pipPictureIds.length);\r\n\r\n                for (var i = 0; i < $scope.control.items.length; i++) {\r\n                    var item = $scope.control.items[i];\r\n                    if (item.id)\r\n                        $scope.pipPictureIds.push(item.id);\r\n                }\r\n            }\r\n\r\n            function reset() {\r\n                $scope.control.uploading = 0;\r\n                $scope.control.items = getItems();\r\n\r\n            }\r\n\r\n            function addItemUrl(item) {\r\n                var name = item.url.slice(item.url.lastIndexOf('/') + 1, item.url.length).split('?')[0];\r\n                var\r\n                    serverUrl = pipRest.serverUrl(),\r\n                    partyId = $scope.$party ? $scope.$party.id : pipRest.userId();\r\n\r\n                return serverUrl + '/api/parties/' + partyId + '/files?name=' + name + '&url=' + item.url\r\n            }\r\n\r\n            function addItemUrlWithFile(item) {\r\n                var\r\n                    serverUrl = pipRest.serverUrl(),\r\n                    partyId = $scope.$party ? $scope.$party.id : pipRest.userId();\r\n\r\n                return serverUrl + '/api/parties/' + partyId + '/files?name=' + item.file.name\r\n            }\r\n\r\n            function addItem(item, callback) {\r\n                if (item.file !== null) {\r\n                    var file = item.file;\r\n\r\n                    var fileReader = new FileReader();\r\n                    fileReader.onload = function (e) {\r\n                        if (item.uploading) return;\r\n                        item.uploading = true;\r\n                        item.upload = $upload.http({\r\n                            url: addItemUrlWithFile(item),\r\n                            headers: {'Content-Type': file.type},\r\n                            data: e.target.result\r\n                        })\r\n                            .then(\r\n                            function (response) {\r\n                                item.id = response.data ? response.data.id : null;\r\n                                item.uploaded = true;\r\n                                item.uploading = false;\r\n                                item.progress = 0;\r\n                                item.upload = null;\r\n                                item.file = null;\r\n                                item.url = contentUrl(item.id);\r\n                                item.state = 'original';\r\n\r\n                                callback();\r\n                            },\r\n                            function (error) {\r\n                                item.uploaded = false;\r\n                                item.uploading = false;\r\n                                item.progress = 0;\r\n                                item.upload = null;\r\n                                //$scope.$apply();\r\n//\r\n                                callback(error);\r\n                            },\r\n                            function (e) {\r\n                                // Math.min is to fix IE which reports 200% sometimes\r\n                                item.progress = Math.min(100, parseInt(100.0 * e.loaded / e.total));\r\n                            }\r\n                        );\r\n                    };\r\n\r\n                    fileReader.readAsArrayBuffer(file);\r\n                } else {\r\n                    var url = addItemUrl(item);\r\n                    item.uploading = true;\r\n                    $http['post'](url)\r\n                        .success(function (response) {\r\n                            item.id = response.data ? response.data.id : response.id || null;\r\n                            item.uploaded = true;\r\n                            item.uploading = false;\r\n                            item.progress = 0;\r\n                            item.upload = null;\r\n                            item.file = null;\r\n                            item.url = contentUrl(item.id);\r\n                            item.state = 'original';\r\n\r\n                            callback();\r\n                        })\r\n                        .error(function (error) {\r\n                            item.uploaded = false;\r\n                            item.uploading = false;\r\n                            item.progress = 0;\r\n                            item.upload = null;\r\n\r\n                            callback();\r\n                        });\r\n                }\r\n            }\r\n\r\n            function deleteItemUrl(item) {\r\n                var\r\n                    serverUrl = pipRest.serverUrl(),\r\n                    partyId = $scope.$party ? $scope.$party.id : pipRest.userId();\r\n\r\n                return serverUrl + '/api/parties/' + partyId + '/files/' + item.id;\r\n            }\r\n\r\n            function deleteItem(item, callback) {\r\n                var control = $scope.control;\r\n\r\n                // Avoid double transactions\r\n                if (item.upload) {\r\n                    item.upload.abort();\r\n                    item.upload = null;\r\n                }\r\n\r\n                if (item.state != 'deleted')\r\n                    return;\r\n\r\n                //pipImageUtils.addHttpHeaders();\r\n                $http['delete'](deleteItemUrl(item))\r\n                .success(function (data) {\r\n                    _.remove(control.items, {pin: item.pin});\r\n                    callback();\r\n                })\r\n                .error(function (data, status) {\r\n                    // Todo: perform a better processing\r\n                    if (data == null) {\r\n                        _.remove(control.items, {pin: item.pin});\r\n                    } else {\r\n                        item.uploaded = false;\r\n                        item.uploading = false;\r\n                        item.progress = 0;\r\n                        item.upload = null;\r\n                    }\r\n\r\n                    callback(data);\r\n                });\r\n            }\r\n\r\n            function save(successCallback, errorCallback) {\r\n                var control = $scope.control;\r\n\r\n                if (control.uploading) {\r\n                    if (errorCallback) errorCallback('ERROR_TRANSACTION_IN_PROGRESS');\r\n                    return;\r\n                }\r\n\r\n                control.error = null;\r\n                control.uploading = 0;\r\n\r\n                var onItemCallback = function(error) {\r\n                    // Storing only the first error\r\n                    if (error && !control.error) {\r\n                        control.error = error;\r\n                    }\r\n\r\n                    control.uploading--;\r\n\r\n                    // Finished uploading\r\n                    if (control.uploading == 0) {\r\n                        if (control.error) {\r\n                            if (errorCallback) errorCallback(control.error);\r\n                            else console.error(control.error);\r\n                        } else {\r\n                            setItems();\r\n                            if (successCallback) successCallback();\r\n                        }\r\n                    }\r\n                };\r\n\r\n                for (var i = 0; i < control.items.length; i++) {\r\n                    var item = control.items[i];\r\n                    if (item.state == 'added' && !item.error) {\r\n                        control.uploading++;\r\n                        addItem(item, onItemCallback);\r\n                    } else if (item.state == 'deleted') {\r\n                        control.uploading++;\r\n                        deleteItem(item, onItemCallback);\r\n                    }\r\n                }\r\n\r\n                // Nothing was uploaded\r\n                if (control.uploading == 0) {\r\n                    if (successCallback) successCallback();\r\n                }\r\n            }\r\n\r\n            function abort() {\r\n                var control = $scope.control;\r\n\r\n                for (var i = 0; i < control.items.length; i++) {\r\n                    var item = control.items[i];\r\n\r\n                    if (item.uploading) {\r\n                        if (item.upload) item.upload.abort();\r\n\r\n                        item.uploaded = false;\r\n                        item.uploading = false;\r\n                        item.progress = 0;\r\n                        item.upload = null;\r\n                    }\r\n                }\r\n\r\n                // Abort transaction\r\n                control.uploading = 0;\r\n            }\r\n\r\n            function readItemLocally(url, file) {\r\n                $scope.control.items.push({\r\n                    pin: itemPin++,\r\n                    id: null,\r\n                    uploading: false,\r\n                    uploaded: false,\r\n                    progress: 0,\r\n                    file: file,\r\n                    url: url,\r\n                    state: 'added'\r\n                });\r\n\r\n                $scope.onChange();\r\n            }\r\n\r\n            function onSelectClick($files) {\r\n                $control.focus();\r\n\r\n                if ($files == null || $files.length == 0)\r\n                    return;\r\n                for (var i = 0; i < $files.length; i++) {\r\n                    var file = $files[i];\r\n\r\n                    if (file.type.indexOf('image') > -1) {\r\n                        readItemLocally(file);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onDeleteClick(item) {\r\n                if (item.state == 'added' || item.state == 'copied') {\r\n                    _.remove($scope.control.items, {pin: item.pin});\r\n                } else {\r\n                    item.state = 'deleted';\r\n                }\r\n\r\n                $scope.onChange();\r\n            }\r\n\r\n            function onKeyDown($event, item) {\r\n                if (item) {\r\n                    if ($event.keyCode == 46 || $event.keyCode == 8) {\r\n                        if (item.state == 'added') {\r\n                            _.remove($scope.control.items, {pin: item.pin});\r\n                        } else {\r\n                            item.state = 'deleted';\r\n                        }\r\n\r\n                        $scope.onChange();\r\n                    }\r\n                } else {\r\n                    if ($event.keyCode == 13 || $event.keyCode == 32) {\r\n                        // !! Avoid clash with $apply()\r\n                        setTimeout(function() {\r\n                            $control.trigger('click');\r\n                        }, 0);\r\n                    }\r\n                }\r\n            }\r\n\r\n            function onImageLoad($event, item) {\r\n                item.error = false;\r\n                setTimeout(function () {\r\n                    var image = $($event.target);\r\n                    pipImageUtils.setImageMarginCSS({clientWidth: 80, clientHeight: 80}, image);\r\n                }, 250);\r\n\r\n                item.loaded = true;\r\n            }\r\n\r\n            // On change event\r\n            function onChange() {\r\n                if ($scope.pipChanged) {\r\n                    $scope.pipChanged({\r\n                        $event: { sender: $scope.control },\r\n                        $control: $scope.control\r\n                    });\r\n                }\r\n            }\r\n        }]\r\n        \r\n    ); \r\n\r\n})();\r\n\r\n","/**\r\n * @file Picture URL dialog\r\n * @copyright Digital Living Software Corp. 2014-2016\r\n * @todo\r\n * - Add sample to sampler app\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipPictureUrlDialog',\r\n        ['ngMaterial', 'pipCore', 'pipPictures.Templates']);\r\n\r\n    thisModule.config(['pipTranslateProvider', function(pipTranslateProvider) {\r\n        pipTranslateProvider.translations('en', {\r\n            'PICTURE_FROM_WEBLINK': 'Add from web link',\r\n            'LINK_PICTURE': 'Link to the picture...'\r\n        });\r\n        pipTranslateProvider.translations('ru', {\r\n            'PICTURE_FROM_WEBLINK': 'Добавить из веб ссылки',\r\n            'LINK_PICTURE': 'Ссылка на изображение...'\r\n        });\r\n    }]);\r\n\r\n    thisModule.factory('pipPictureUrlDialog',\r\n        ['$mdDialog', function ($mdDialog) {\r\n            return {\r\n                show: function (successCallback) {\r\n                    $mdDialog.show({\r\n                        templateUrl: 'picture_url_dialog/picture_url_dialog.html',\r\n                        clickOutsideToClose: true,\r\n                        controller: 'pipPictureUrlDialogController'\r\n                    }).then(function (result) {\r\n                        if (successCallback) {\r\n                            successCallback(result);\r\n                        }\r\n                    });\r\n                }\r\n            };\r\n    }]);\r\n\r\n    thisModule.controller('pipPictureUrlDialogController', \r\n        ['$scope', '$rootScope', '$timeout', '$mdMenu', '$mdDialog', 'pipImageUtils', function ($scope, $rootScope, $timeout, $mdMenu, $mdDialog, pipImageUtils) {\r\n            $scope.url = '';\r\n            $scope.invalid = true;\r\n            $scope.theme = $rootScope.$theme;\r\n            $scope.checkUrl = checkUrl;\r\n            $scope.onCancelClick = onCancelClick;\r\n            $scope.onAddClick = onAddClick;\r\n\r\n            return;\r\n\r\n            function setImageSize(img) {\r\n                var imageWidth = img.width(),\r\n                    imageHeight = img.height();\r\n\r\n                var cssParams = {};\r\n\r\n                if ((imageWidth) > (imageHeight)) {\r\n                    cssParams['width'] = '250px';\r\n                    cssParams['height'] = 'auto';\r\n                } else {\r\n                    cssParams['width'] = 'auto';\r\n                    cssParams['height'] = '250px';\r\n                }\r\n\r\n                img.css(cssParams);\r\n            }\r\n\r\n            function checkUrl() {\r\n                var img = $(\"img#url_image\")\r\n                    .on('error', function () {\r\n                        $scope.invalid = true;\r\n                        $scope.$apply();\r\n                    })\r\n                    .on('load', function () {\r\n                        $scope.invalid = false;\r\n                        setImageSize(img);\r\n                        $scope.$apply();\r\n                    })\r\n                    .attr(\"src\", $scope.url);\r\n            };\r\n            \r\n            function onCancelClick() {\r\n                $mdDialog.cancel();\r\n            };\r\n            \r\n            function onAddClick() {\r\n                $mdDialog.hide($scope.url);\r\n            };\r\n        }]\r\n    );\r\n\r\n})();","/**\r\n * @file Picture paste service\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n */\r\n\r\n/* global $, angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipPicturePaste', []);\r\n\r\n    thisModule.factory('pipPicturePaste', ['$timeout', function ($timeout) {\r\n        var paste = {};\r\n        var pasteCatcher = null;\r\n\r\n        paste.addPasteListener = function (onPaste) {\r\n            if (!window.Clipboard) {\r\n                if (pasteCatcher !== null) this.removePasteElement();\r\n\r\n                pasteCatcher = document.createElement(\"div\");\r\n\r\n                // Firefox allows images to be pasted into contenteditable elements\r\n                pasteCatcher.setAttribute(\"contenteditable\", \"true\");\r\n\r\n                // We can hide the element and append it to the body,\r\n                //pasteCatcher.style.opacity = 0;\r\n                $(pasteCatcher).css({\r\n                    \"position\": \"absolute\",\r\n                    \"left\": \"-999\",\r\n                    width: \"0\",\r\n                    height: \"0\",\r\n                    \"overflow\": \"hidden\",\r\n                    outline: 0\r\n                });\r\n\r\n                document.body.appendChild(pasteCatcher);\r\n            }\r\n\r\n            $(document).on('paste', function (event) {\r\n                if (event.clipboardData == null && event.originalEvent) {\r\n                    event = event.originalEvent;\r\n                }\r\n\r\n                // Paste for chrome\r\n                if (event.clipboardData) {\r\n                    var items = event.clipboardData.items;\r\n\r\n                    _.each(items, function (item) {\r\n                        if (item.type.indexOf(\"image\") != -1) {\r\n                            var file = item.getAsFile();\r\n\r\n                            var fileReader = new FileReader();\r\n                            fileReader.onload = function (e) {\r\n                                $timeout(function () {\r\n                                    onPaste({url: e.target.result, file: file});\r\n                                });\r\n                            };\r\n                            fileReader.readAsDataURL(file);\r\n                        }\r\n                    });\r\n                }\r\n                // Paste for IE\r\n                else if (window.clipboardData && window.clipboardData.files) {\r\n                    _.each(window.clipboardData.files, function (file) {\r\n                        var fileReader = new FileReader();\r\n                        fileReader.onload = function (e) {\r\n                            $timeout(function () {\r\n                                onPaste({url: e.target.result, file: file});\r\n                            });\r\n                        };\r\n                        fileReader.readAsDataURL(file);\r\n                    });\r\n                }\r\n            });\r\n        };\r\n\r\n        paste.removePasteListener = function () {\r\n            if (!window.Clipboard) {\r\n                if (pasteCatcher !== null) {\r\n                    document.body.removeChild(pasteCatcher);\r\n                    pasteCatcher = null;\r\n                }\r\n            }\r\n            $(document).off('paste');\r\n        };\r\n\r\n        return paste;\r\n    }]);\r\n\r\n})();\r\n","/**\r\n * @file Areas data cache\r\n * @copyright Digital Living Software Corp. 2014-2015\r\n */\r\n\r\n/* global angular */\r\n\r\n(function () {\r\n    'use strict';\r\n\r\n    var thisModule = angular.module('pipImageUtils', []);\r\n\r\n    thisModule.service('pipImageUtils',\r\n        ['$http', 'pipStrings', '$rootScope', 'pipRest', function($http, pipStrings, $rootScope, pipRest) {\r\n\r\n            var\r\n                colorClasses = [\r\n                    'pip-avatar-color-0', 'pip-avatar-color-1', 'pip-avatar-color-2', 'pip-avatar-color-3',\r\n                    'pip-avatar-color-4', 'pip-avatar-color-5', 'pip-avatar-color-6', 'pip-avatar-color-7',\r\n                    'pip-avatar-color-8', 'pip-avatar-color-9', 'pip-avatar-color-10', 'pip-avatar-color-11',\r\n                    'pip-avatar-color-12', 'pip-avatar-color-13', 'pip-avatar-color-14', 'pip-avatar-color-15'\r\n                ],\r\n\r\n                colors = [\r\n                    'rgba(239,83,80,1)', 'rgba(236,64,122,1)', 'rgba(171,71,188,1)',\r\n                    'rgba(126,87,194,1)', 'rgba(92,107,192,1)', 'rgba(3,169,244,1)',\r\n                    'rgba(0,188,212,1)', 'rgba(0,150,136,1)', 'rgba(76,175,80,1)',\r\n                    'rgba(139,195,74,1)', 'rgba(205,220,57,1)', 'rgba(255,193,7,1)',\r\n                    'rgba(255,152,0,1)', 'rgba(255,87,34,1)', 'rgba(121,85,72,1)',\r\n                    'rgba(96,125,139,1)'\r\n                ],\r\n\r\n                entityTypes = {\r\n                    goal: 'goals',\r\n                    objective: 'goals',\r\n                    dream: 'goals',\r\n                    accomplishment: 'goals',\r\n                    area: 'areas',\r\n                    overall: 'visions',\r\n                    vision: 'visions',\r\n                    event: 'events',\r\n                    instance: 'events'\r\n                },\r\n\r\n                collageSchemes = [\r\n                    // 1\r\n                    [\r\n                        { flex: 100, fullWidth: true, fullHeight: true }\r\n                    ],\r\n                    // 2\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 50, fullHeight: true, rightPadding: true },\r\n                                { flex: 50, fullHeight: true, leftPadding: true }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 3\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 33, fullHeight: true, rightPadding: true },\r\n                                { flex: 33, fullHeight: true, leftPadding: true, rightPadding: true },\r\n                                { flex: 33, fullHeight: true, leftPadding: true }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 50, fullHeight: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, leftPadding: true, bottomPadding: true },\r\n                                        { flex: 50, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 70, fullHeight: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 30,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, leftPadding: true, bottomPadding: true },\r\n                                        { flex: 50, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 50, fullWidth: true, bottomPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, rightPadding: true, topPadding: true },\r\n                                        { flex: 50, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 4\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 50, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 30, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 70,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 100, fullWidth: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 5\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 50, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                            ]\r\n                                        },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 33, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 67,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                            ]\r\n                                        },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 100, fullWidth: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 6\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 33, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 33, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 33, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 67,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                                { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                            ]\r\n                                        },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 50, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 7\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 33, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 50, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        },\r\n                        {\r\n                            group: true,\r\n                            layout: 'row',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            children: [\r\n                                { flex: 25, fullWidth: true, rightPadding: true },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'column',\r\n                                    flex: 75,\r\n                                    fullHeight: true,\r\n                                    children: [\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                            ]\r\n                                        },\r\n                                        {\r\n                                            group: true,\r\n                                            layout: 'row',\r\n                                            flex: 50,\r\n                                            fullHeight: true,\r\n                                            children: [\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                                { flex: 33, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                            ]\r\n                                        }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ],\r\n                    // 8\r\n                    [\r\n                        {\r\n                            group: true,\r\n                            layout: 'column',\r\n                            flex: 100,\r\n                            fullHeight: true,\r\n                            fullWidth: true,\r\n                            children: [\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullWidth: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, bottomPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, bottomPadding: true }\r\n                                    ]\r\n                                },\r\n                                {\r\n                                    group: true,\r\n                                    layout: 'row',\r\n                                    flex: 50,\r\n                                    fullWidth: true,\r\n                                    children: [\r\n                                        { flex: 25, fullWidth: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, rightPadding: true, topPadding: true },\r\n                                        { flex: 25, fullWidth: true, leftPadding: true, topPadding: true }\r\n                                    ]\r\n                                }\r\n                            ]\r\n                        }\r\n                    ]\r\n                ];\r\n\r\n\r\n            return {\r\n                getColorClasses: getColorClasses,\r\n                getAvatarColors: getAvatarColors,\r\n                getEntityTypes: getEntityTypes,\r\n                setErrorImageCSS: setErrorImageCSS,\r\n                setImageMarginCSS: setImageMarginCSS,\r\n                setIconMarginCSS: setIconMarginCSS,\r\n                getAvatarUrl: getAvatarUrl,\r\n                bindFile: bindFile,\r\n                getCollageSchemes: getCollageSchemes\r\n            };\r\n\r\n            function getEntityTypes() {\r\n                return entityTypes;\r\n            };\r\n\r\n            function getColorClasses() {\r\n                return colorClasses;\r\n            };\r\n\r\n            function getAvatarColors() {\r\n                return colors;\r\n            };\r\n\r\n            function getCollageSchemes() {\r\n                return collageSchemes;\r\n            };\r\n\r\n            function getAvatarUrl(partyId, partyName, id, type, noRedirect, noDefault) {\r\n                var\r\n                    timestamp = Math.floor(new Date().getTime() / 1000) * 1000,\r\n                    colorClassIndex = pipStrings.hashCode(id) % colors.length,\r\n                    chr = null,\r\n                    url = null, default_template = '',\r\n                    serverUrl = pipRest.serverUrl();\r\n\r\n                noRedirect = noRedirect && noRedirect === true ? '&no_redirect=true' : '';\r\n                if ((type && id && partyId) || (partyId)) {\r\n                    if (type && id && partyId) {\r\n                        if (type == 'category') return;\r\n                        if (!noDefault) default_template = 'default_template='\r\n                        + type + '&bg=' + colors[colorClassIndex]\r\n                        + '&fg=white&';\r\n                        if (entityTypes[type] == 'goals' || entityTypes[type] == 'areas' ) {\r\n                            url = serverUrl + '/api/parties/' + partyId + '/' + entityTypes[type]\r\n                            + '/' + id + '/avatar?' + default_template + 'timestamp=' + timestamp\r\n                            + '&obj_id=' + id + noRedirect;\r\n                        }\r\n                    } else if (partyId && partyName) {\r\n                        colorClassIndex = pipStrings.hashCode(partyId) % colors.length;\r\n                        chr = (partyName[0] || '?').toUpperCase();\r\n                        if (!noDefault) default_template = 'default_template=letter&bg=' + colors[colorClassIndex]\r\n                        + '&fg=white&chr=' + chr + '&';\r\n                        url = serverUrl + '/api/parties/' + partyId\r\n                        + '/avatar?' + default_template + 'timestamp=' + timestamp + '&obj_id=' + partyId + noRedirect;\r\n                    } else if (partyId && (!type && !id)) {\r\n                        url = serverUrl + '/api/parties/' + partyId\r\n                        + '/avatar?timestamp=' + timestamp + '&obj_id=' + partyId + noRedirect;\r\n                    }\r\n                }\r\n\r\n                return url;\r\n            };\r\n\r\n            function bindFile(imageId, successCallback, errorCallback) {\r\n                var url,\r\n                    userId = ($rootScope.$user || {}).id,\r\n                    partyId = ($rootScope.$party || {}).id || userId,\r\n                    fileUrl = pipRest.serverUrl() + \"/api/parties/\" + partyId + \"/files/\" + imageId;\r\n\r\n                //if (addHttpHeaders() && fileUrl)\r\n                if (fileUrl)\r\n                    $http.get(fileUrl)\r\n                        .success(function (response) {\r\n                            url = response && response.url ? response.url : '';\r\n\r\n                            if (successCallback) successCallback(url);\r\n                        })\r\n                        .error(function (error) {\r\n                            if (errorCallback) errorCallback(error);\r\n                        });\r\n            };\r\n\r\n            function setErrorImageCSS(image, params) {\r\n                var cssParams = {\r\n                    'width': '',\r\n                    'margin-left': '',\r\n                    'height': '',\r\n                    'margin-top': ''\r\n                };\r\n\r\n                if (params) cssParams = _.assign(cssParams, params);\r\n\r\n                if (image)  image.css(cssParams);\r\n            };\r\n\r\n            function setImageMarginCSS($element, image, params) {\r\n                var\r\n                    containerWidth = $element.width ? $element.width() : $element.clientWidth, // || 80,\r\n                    //containerWidth = $element.clientWidth ? $element.clientWidth : $element.width, // || 80,\r\n                    //containerHeight = $element.clientHeight ? $element.clientHeight : $element.height, // || 80,\r\n                    containerHeight = $element.height ? $element.height() : $element.clientHeight, // || 80,\r\n                    imageWidth = image[0].naturalWidth || image.width,\r\n                    imageHeight = image[0].naturalHeight || image.height,\r\n                    margin = 0;\r\n                var cssParams = {};\r\n\r\n                if ((imageWidth / containerWidth) > (imageHeight / containerHeight)) {\r\n                    margin = -((imageWidth / imageHeight * containerHeight - containerWidth) / 2);\r\n                    cssParams['margin-left'] = '' + margin + 'px';\r\n                    cssParams['height'] = '' + containerHeight + 'px';//'100%';\r\n                    cssParams['width'] = '' + imageWidth * containerHeight/imageHeight + 'px';//'100%';\r\n                    cssParams['margin-top'] = '';\r\n                } else {\r\n                    margin = -((imageHeight / imageWidth * containerWidth - containerHeight) / 2);\r\n                    cssParams['margin-top'] = '' + margin + 'px';\r\n                    cssParams['height'] = '' + imageHeight * containerWidth/imageWidth + 'px';//'100%';\r\n                    cssParams['width'] = '' + containerWidth + 'px';//'100%';\r\n                    cssParams['margin-left'] = '';\r\n                }\r\n\r\n                if (params) cssParams = _.assign(cssParams, params);\r\n\r\n                image.css(cssParams);\r\n            };\r\n\r\n            function setIconMarginCSS(container, icon) {\r\n                var\r\n                    containerWidth = container.clientWidth ? container.clientWidth : container.width,\r\n                    containerHeight = container.clientHeight ? container.clientHeight : container.height,\r\n                    margin = 0,\r\n                    iconSize = containerWidth > containerHeight ? containerHeight : containerWidth;\r\n\r\n                var cssParams = {\r\n                    'width': '' + iconSize + 'px',\r\n                    'margin-left': '',\r\n                    'height': '' + iconSize + 'px',\r\n                    'margin-top': ''\r\n                };\r\n\r\n                if ((containerWidth) > (containerHeight)) {\r\n                    margin = ((containerWidth - containerHeight) / 2);\r\n                    cssParams['margin-left'] = '' + margin + 'px';\r\n                } else {\r\n                    margin = ((containerHeight - containerWidth) / 2);\r\n                    cssParams['margin-top'] = '' + margin + 'px';\r\n                }\r\n\r\n                icon.css(cssParams);\r\n            };\r\n\r\n        }]\r\n    );\r\n\r\n})();\r\n\r\n"],"sourceRoot":"/source/"}